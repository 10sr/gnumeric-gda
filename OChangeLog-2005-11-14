2000-12-04  Zbigniew Chyla  <cyba@gnome.pl>

	* src/sheet-object-widget.c (sheet_widget_checkbox_toggled): calling
	workbook_recalc() after setting cell value based on checkbox state.

2000-12-04  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_relocate_objects) : Remember to move the
	  object to the new sheet, not just the views.
	(sheet_object_position) : Off by one.  Use < not <=

2000-12-04  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_{insert,delete}_{cols,rows}) : Call
	  sheet_relocate_objects.
	(sheet_move_range) : Ditto.

	* src/sheet-object.c (sheet_object_unrealize) : restore this routine.
	(sheet_object_destroy) : Use it here.
	(sheet_object_position) : renamed from sheet_object_reposition.
	(sheet_relocate_objects) : new routine.  Only handles current anchor
	  format.  Will need to extend this.

	* src/item-bar.c (item_bar_event) : Exit object edit mode when a
	  button presses on the itembar.

2000-12-02  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (cellrange_relocate) : Still not doing the 'right' thing
	  in all cases.   However at least it will no longer create broken
	  references.
	(cellref_relocate) : tweak a bit.

2000-12-01  Michael Meeks  <michael@helixcode.com>

	* configure.in: check for gb >= 0.0.17

2000-12-02  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (cellrange_relocate) : fix the logic that was broken when
	  supporting the partial ranges.
	(cellref_relocate) : move some of the code here, to decrease
	  replication.

2000-12-02  Jody Goldberg <jgoldberg@home.com>

	* src/item-bar.c : Add some debug macros to catch the magic helix
	  cursor grab.
	* src/item-cursor.c : Ditto.
	* src/item-grid.c : Ditto.
	* src/sheet-control-gui.c : Ditto.

2000-12-01  Jody Goldberg <jgoldberg@home.com>

	* src/functions/fn-lookup.c (gnumeric_hlookup) : fix cut-n-paste-o.

2000-12-01  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_drag_event) : Ignore press events fro
	  drag cursors.  And ignore release events for buttons other than the
	  one that started the drag.
	s/prepared_to_drag/drag_button/
	(item_cursor_set_arg) : Add 'Button' arg
	(item_cursor_class_init) : Ditto.

2000-12-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c (scg_object_stop_editing) : fix warning.
	  this is static now.

2000-12-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_position_pts) : new function.
	(sheet_object_position_pixels) : new function.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c : Begin moving the sheet object xml io into virtuals.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c : Add SHEET_FOREACH_CONTROL to help abstract the
	  implementation of controls and simplify changes later.
	(sheet_set_zoom_factor) : reposition objects not just comments.
	(sheet_get_objects) : New function.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c : Move most (not yet all) of the GUI aspects into
	  the sheet control.  Revamp the semantics of the sheet-object
	  virtuals.
	new_view : now handles the sizing and realizing of objects.
	Add support for persistance here.
	Delete get/set bound.

	* src/sheet-object-container.c : convert to new object management design
	* src/sheet-object-graphic.c : Ditto.
	* src/sheet-object-item.c : Ditto.
	* src/sheet-object-widget.c : Ditto.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_construct) :
	  sheet_object_construct now takes a default size.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c : Move cell comment and sheet object
	  placement routines here.  Rather than scattering them in non-gui
	  modules.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/print.c (print_object_view_position) : Convert object position
	  to points.

	* src/selection.c (sheet_selection_redraw) : simplify.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-sheet.c (gnumeric_sheet_key_mode_object) : SheetObject
	  editing is now specific to the SheetControl.
	(gnumeric_sheet_key_press) : Ditto.
	(gnumeric_sheet_key_release) : Ditto.

	* src/selection.c (sheet_is_cell_selected) : Ditto.
	(sheet_col_selection_type) : Ditto.
	(sheet_row_selection_type) : Ditto.

	* src/item-bar.c (item_bar_draw) : Ditto.

	* src/item-grid.c (item_grid_draw_background) : Ditto.
	(item_grid_button_1) : Ditto.
	(item_grid_event) : Ditto.
	(cb_obj_create_motion) : Move the object creation GUI here.
	(cb_obj_create_button_release) : and add partial support for
	  autoscroll.
	(sheet_object_begin_creation) : Ditto.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_copy) : Comments are no longer associated directly
	  with cells.
	* src/clipboard.c (paste_cell) : Ditto.
	(clipboard_release) : Ditto.

	* src/bonobo-io.c (gnumeric_bonobo_obj_read) : No need to set bounds
	  or realize the object here.  That is handed at a higher level.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/number-match.c (compute_value) : Use strtol to simplify things.

	* src/func.c (tokenized_help_new) : translate the help text.

2000-11-27  Jody Goldberg <jgoldberg@home.com>

	* src/formats.c (currency_date_format_init) : quote the currency
	  names.

2000-11-30  Almer S. Tigelaar  <almer1@dds.nl>

	* src/preview-grid-controller.c (preview_grid_controller_new) :
	Make the selection rectangle fatter and position it slightly better.

2000-11-29  Morten Welinder  <terra@diku.dk>

	* src/xml-io.c (xml_sheet_write): Initialise closure's rle_count
 	member.
	(natural_order_cmp): Fix major brown-bag in ordering.

2000-11-27  Morten Welinder  <terra@diku.dk>

	* src/analysis-tools.c (anova_single_factor_tool): Apply the rest
 	of Christensens' patch.

2000-11-27  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-view.c (workbook_view_init) : Init the format feedback.
	  But don't bother displaying.  We don't have any controls yet.

	* configure.in (have_gda) : init to false.

2000-11-27  Michael Meeks  <michael@helixcode.com>

	* src/embeddable-grid.c (EmbeddableGridFactory_init): upd.

	* Makefile.am (oaf_DATA): upd to GNOME_Gnumeric.oafinfo

	* GNOME_Gnumeric.oafinfo: upd.

2000-11-24  Jon K Hellan  <hellan@acm.org>

	* src/file.c (do_save_as): Remember name with extension, so
	subsequent saves are done to the correct file.
	
	* src/workbook.c (workbook_set_saveinfo): Remove redundant setting
	of title.

2000-11-24  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell) : bubble the sizing code further up.
	  src/cell-draw.c (cell_draw) : ditto.  Move towards a better api that
	  will pass in the bounding box rather than all the parameters needed
	  to generate it in different circumstances.

2000-11-23  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell) : until printing of the grid is synced
	  with drawing a grid, disable the tests for width, height.

	* src/expr.c (cellrange_relocate) : Use simple heuristic to help
	  diffentiate the 'expected' behavior of  moving expressions with
	  range references that are partially contained.

2000-11-22  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-math.c (gnumeric_sumx2py2): Plug leaks.
	(gnumeric_sumxmy2): Plug leaks.
	(gnumeric_sumx2my2): Plug leaks.

2000-11-22  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dialogs/dialog-plugin-manager.c (refresh_right_frame):
	Replaced ctime() with strftime() to display translated form of
	plugin modification date.

	* src/item-bar.c (colrow_tip_setlabel): Translated (Polish)
 	version of string doesn't fit within "buffer". Dropped static
 	array and used dynamic memory allocation (g_strdup_printf).
	(vertical_scroll_change, horizontal_scroll_change): It fits with
 	Polish translation but code is similar to the above.

2000-11-22  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dialogs/summary.glade: Centered "Document Summary
	Information" label.
	
2000-11-21  Morten Welinder  <terra@diku.dk>

	* src/sheet.c (sheet_new_sheet_view): Remove spurious ref.

	* src/stf-parse.c (stf_parse_get_colwidth): Don't overrun buffer.

2000-11-20  Morten Welinder  <terra@diku.dk>

	* src/gutils.c (gnumeric_usr_dir): Use g_get_home_dir, not just
 	$HOME.  Don't return duplicate slashes.

	* src/commands.c (cmd_resize_row_col_redo): Proper undo sizing.
	(cmd_sort_redo): Ditto.
	(cmd_hide_selection_rows_cols): Ditto.
	(cmd_autofill_redo): Ditto.

	* gnumeric.spec.in (gal): Require 0.2.99.

	* configure.in (gal): Require 0.2.99 (and fix check).

	* src/workbook-control-gui.c (workbook_control_gui_ctor_class):
 	Set undo_redo.truncate.
	(wbcg_undo_redo_truncate): New function.

	* src/commands.c (command_push_undo): truncate undo information.
	(truncate_undo_info): New function.
	(cmd_format): Properly size undo information.

2000-11-20  Jody Goldberg <jgoldberg@home.com>

	* src/colrow.c (col_row_get_index_list) : Take away my crack pipe.

2000-11-20  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Use a more conventional approach to path seperators.
	* src/gutils.c (gnumeric_usr_dir) : Adjust here.
	(gnumeric_sys_data_dir) : and here.
	(gnumeric_sys_lib_dir) : and here.

2000-11-20  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_clone_selection) : Fix.

	* src/item-grid.c (item_grid_draw_merged_range) : If the merged region
	  is fully selected paint it as such.

	* src/selection.c (sheet_is_full_range_selected) : new function.
	(sheet_selection_set) : support merged cells.

2000-11-20  Morten Welinder  <terra@diku.dk>

	* src/sheet.c (sheet_destroy_contents): Eliminate merged regions.
	(sheet_destroy): Free data structures for merged regions.
	(sheet_new): Activate temporary debugging code on
 	GNUMERIC_DEBUG_MERGE in environment.

2000-11-19  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_region_is_merge_cell) :
	(sheet_region_get_merged) : 
	(sheet_region_unmerge) :
	(sheet_region_merge) : implement.

2000-11-19  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw_merged_range) : new function.
	  This may be clearer if we draw the grid lines after the background.
	  It does not support borders or selection yet.
	(item_grid_draw) : Use it.

2000-11-19  Jody Goldberg <jgoldberg@home.com>

	* src/cellspan.c (cell_is_empty) : new utility function.
	  span calculation is now rather inefficent.  We could be smarter if
	  we had a better representation of spans.  For now adding support for
	  merged cells here would be enough.
	(cell_calc_span) : Use it.

	* src/cell-draw.c (cell_draw) : decrease dependence on
	  Cell::{col,row})_info::size_pixels.  This is not accurate for merged
	  cells.  More work is needed.  I have not converted the multiline
	  formating yet.  The signature of this function sucks.
	  We should pass in either span or width height, not both.

	* src/print-cell.c (print_cell) : Stay consistent with cell_draw.
	  NOTE : I have not ported over the merged cell support.  It seems
	  pointless until it is working completely for drawing.

2000-11-19  Jody Goldberg <jgoldberg@home.com>

	* s/sheet_view/scg/

	* src/formats.c (currency_symbols) : Add the slovenian tolar.

2000-11-16  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c (scg_context_menu) : renamed from
	  item_grid_popoup_menu and moved here where it makes more sense.

	* src/sheet.c (sheet_merge_region) : implement.
	(sheet_unnmerge_region) : Ditto.
	(sheet_get_merged_regions) : Ditto.

2000-11-18  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Bump to 0.60 post release
	* NEWS : ditto

2000-11-18  Jody Goldberg <jgoldberg@home.com>

	* Release 0.59

2000-11-18  Jody Goldberg <jgoldberg@home.com>

	* src/command-context-corba.c (command_context_corba_new) : warning
	  suppression.

	* src/workbook-control-gui.c (workbook_control_gui_ctor_class) : Init
	  progress_set in CommandContextClass, and add support for
	  splits_array at this level.

	* src/command-context.c (gnumeric_error_splits_array) : The decision
	  to use invalid should be done in the implementation.

	* src/workbook-control.c (wb_control_progress_set) : delete replicated
	  function.

2000-11-17  Chema Celoria  <chema@celorio.com>

	* src/print.c (sheet_print): change to a g_return_val_if_fail
	by gmorten's request

2000-11-17  Chema Celorio  <chema@celorio.com>

	* src/print.c (sheet_print): if gnome-print dialog is NULL,
	return. This avoids a crash if there aren't any printers installed.

2000-11-17  Almer S. Tigelaar  <almer1@dds.nl>

	* src/preview-grid-controller.c, src/preview-grid-controller.h
	(preview_grid_controller_new) : Extra selected parameters,
	if set a red rectangle will be drawn over the preview to indicate
	the selected state.

	* src/dialogs/dialog-autoformat.c (previews_load): Adjust so
	the selected preview will be drawn in selected state.

2000-11-16  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (format_month_before_day) : Add config test.
	* configure.in : Implement test here.
	* config.h.in : and here.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_update_only_grid) : split from sheet_update.
	(sheet_update) : call sheet_update_only_grid.

2000-11-16  Michael Meeks  <michael@helixcode.com>

	* src/xml-io.h: add xmlmemory.h

	* src/gui-clipboard.c (x_selection_handler): xmlFree
	not g_free.

2000-11-16  Morten Welinder  <terra@diku.dk>

	* plugins/Makefile.am (GDA_DIR): Blank.

2000-11-16  Zbigniew Chyla  <cyba@gnome.pl>

	* src/sheet-autofill.c: Added support for boolean values (just copy
	them).

2000-11-16  Rodrigo Moya <rodrigo@linuxave.net>

	* configure.in: added support for conditional compilation of
	the GDA (GNOME-DB) plugin
	* plugins/gda/*: updated to current GDA code. Does not compile
	yet though

2000-11-16  Zbigniew Chyla  <cyba@gnome.pl>

	* src/selection.c, src/dialogs/dialog-cell-sort.c: Marked strings
	for translation.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control.c (workbook_control_set_view) : Follow
	  convention that the manager is set when attached, and not before.
	* src/workbook-view.c (wb_view_attach_control) : Ditto.  Set the
	  tile on the new control.
	* src/workbook.c (workbook_attach_view) : Ditto.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	* src/command-context-corba.[ch] : This is incorrectly named and used
	  the wrong way :-( But at least it is compilable.  I'll fix this
	  later.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	* src/colrow.c (col_row_foreach) : Use ColRowSegments
	(col_row_restore_sizes) : Ditto.
	* src/sheet.c (sheet_{col,row}_add) : Ditto.
	(sheet_{col,row}_get_info) : Ditto.
	(sheet_{col,row}_get) : Ditto.
	(sheet_cell_foreach_range) : Ditto.
	(sheet_{col,row}_destroy) : Ditto.
	(sheet_regen_adjacent_spans) : Ditto.
	(colrow_move) : Ditto.
	(sheet_{col,row}_get_distance_pixels) : Ditto.
	(sheet_{col,row}_get_distance_pts) : Ditto.
	(sheet_{col,row}_set_size_pts) : Ditto.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	s/sheet-view/sheet-control-gui/

	* src/Makefile.am : Add command-context-corba.[ch] temporarily

	* configure.in : Default to non-bonobo build

2000-11-15  Michael Meeks  <michael@helixcode.com>

	* gnumeric.oafinfo: rename to ObjectFactory

2000-11-54  John Gotts  <jgotts@linuxsavvy.com>

	* gnumeric.spec.in: Create a devel RPM.  Added some missing files.
	Made the build work from either a tar file or CVS.

2000-11-14  Almer S. Tigelaar  <almer1@dds.nl>

	* src/io-context.h, src/io-context.c
	(gnumeric_io_progress_set): New function, calls
	upon gnumeric_progress_set to do the job.

2000-11-14  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c : Fix warning.

2000-11-13  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Bump to 0.59 post release.

2000-11-13  Jody Goldberg <jgoldberg@home.com>

        * Release 0.58

2000-11-13  JP Rosevear  <jpr@helixcode.com>

	* src/functions/fn-lookup.c (find_bound_walk): Only reverse
	direction if we haven't already switched direction once.
	Fixes bug #2872

2000-11-13  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-format-toolbar.c (workbook_feedback_set) : Doh!

2000-11-13  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-graph-guru.c (graph_guru_create_vectors_from_range) :
	  small improvement to vector selection heuristics.

2000-11-12  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_new_view) : Make public.

	* src/workbook-control-gui.c (wbcg_sheet_add) : Create views of all
	  sheet objects.

2000-11-12  Almer S. Tigelaar  <almer1@dds.nl>

	* src/stf-export.c (stf_export_sheet): Use sheet_get_extent
	instead of sheet->rows and sheet->cols.

2000-11-12  Jody Goldberg <jgoldberg@home.com>

	* src/workbook.c (workbook_sheet_attach) : Use wb_view_sheet_add.

	* src/workbook-view.c (wb_view_sheet_add) : new function.
	(wb_view_format_feedback) : Ditto.
	(wb_view_auto_expr) : Store the display result.
	(wb_view_auto_expr_value_display) : renamed
	  from wb_view_auto_expr_value_set.
	(wb_view_destroy) : clear out the new members.

	* src/workbook-format-toolbar.c (workbook_feedback_set) : Calculate
	  the style here.  This is transitory.  It will eventually move into
	  the sheet view when that is split.

	* src/workbook-control.c (wb_control_sheet_add) : Do this manually
	  so that if the new sheet is the focus sheet for the view we can
	  update the various feedback mechanisms.
	(workbook_control_sheets_init) : rather than here.

	* src/sheet.c (sheet_update) : prepare for having the wb_view handle
	  the selection.

	* src/Makefile.am : Add missing workbook-control.h

	* src/workbook-view.c (wb_view_auto_expr) : When the expression
	  changes, recalculate.

	* src/workbook-control-gui.c (wbcg_auto_expr_value) : Mark as updating
	  the ui.
	(cb_auto_expr_changed) : test the updating flag here, don't set it.

2000-11-11  Michael Meeks  <michael@helixcode.com>

	* src/bonobo-io.c (gnumeric_bonobo_obj_write),
	(write_stream_to_storage): update unref fns.
	(read_stream_from_storage): upd.
	(gnumeric_bonobo_obj_read): set the bounds correctly.

	* src/xml-io.c (xml_write_sheet_object): NULL the sheet object
	we free.

2000-11-11  Michael Meeks  <michael@helixcode.com>

	* src/clipboard.c (apply_paste_oper_to_values): kill warning.

	* src/xml-io-autoft.c: remove stale enum.

	* src/xml-io.c (xml_check_version): publicized.
	(xml_parse_ctx_new_full): add version parameter.
	(xml_parse_ctx_new): update.

	* src/bonobo-io.c (gnumeric_bonobo_read_workbook): use
	xml_check_version.

	* src/bonobo-io.c (gnumeric_bonobo_write_workbook): open the
	stream with the correct permissions.
	(gnumeric_bonobo_io_probe): update to like directories too.
	(gnumeric_bonobo_io_init): register for '.efs'
	(gnumeric_bonobo_read_workbook): beef up exception reporting.

2000-11-11  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml: fiddle, lots of strange mangling, needs HEAD
	bonobo to look at all good.
	
	* src/xml-io.c (xml_write_sheet_object): free the node nicely in
	the failure case.

2000-11-11  Michael Meeks  <michael@helixcode.com>

	* configure.in (LIBS): add gnome-config --cflags idl to the default
	IDL_FLAGS.

2000-11-11  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c : Fix typos in the accelerator selections
	  for the name menu.

	* src/gnumeric.xml : Add entries for new shared/unshared views.

	* src/style.c (font_init) : Use the correct scale.

	* src/value.c (value_get_default_halign) : Renamed and moved from here
	* src/cell.c (cell_default_halign) : to here.  Added support for
	  displaying formulas.

	* src/print-cell.c (print_cell) : only draw hash marks for numbers
	  not when displaying formulas.
	* src/cell-draw.c (cell_draw) : Ditto.
	* src/cellspan.c (cell_calc_span) : Ditto.
	* src/rendered-value.c (rendered_value_calc_size_ext) : Ditto.

2000-11-11  Jody Goldberg <jgoldberg@home.com>

	Patch from Tyler & James Christensen
	* src/analysis-tools.c (anova_single_factor_tool) : Correct handling
	  of variables stored in rows rather than columns.

2000-11-11  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dependent.c (dependent_list_filter): Correct "for" loop
	condition.

2000-11-10  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_new_view) : Store the SheetObject
	  and SheetView as object_data.
	(cb_sheet_object_configure) : Pass the SheetView to configuration
	  routines.
	(sheet_object_populate_menu) : Pass the CanvasItem it has the useful
	  property of having the associated view and sheet object as user data.
	  This makes it handy for use in callbacks.
	(display_object_menu) : signature change.
	(control_point_handle_event) : changes to display_menu_object.
	(sheet_object_canvas_event) : Ditto.

	* src/sheet-object-widget.c (sheet_widget_checkbox_user_config) :
	  signature change.  This should get things working again.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_populate_menu) :
	  signature change.

2000-11-10  Jody Goldberg <jgoldberg@home.com>
      Patch from Juan Pablo Mendoza <pablo_juan@yahoo.com>

      * sheet-view.c (sheet_view_comment_create_marke): Memory leak.

2000-11-10  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-format-toolbar.c (workbook_format_toolbutton_update) :
	  Minor optimization to decrease flicker.

	* src/sheet.c (sheet_cell_calc_span) : Clarify the semantics of 
	  the various flags.
	(cb_max_cell_width) : If the value used a dynamic format we need to
	  rerender ignoring the current width.

	* src/rendered-value.c (rendered_value_new) : renamed from
	  rendered_value_new_ext and delete the old rendered_value_new.
	  Extend slightly to flag whether or not to handle dynamic formats.

	* src/render-ascii.c (cell_region_render_ascii) : Handle the style
	  lookup localy.

	* src/cell.c (cell_eval_content) : We need to manually render
	  the value here, but no longer need to calculate the size
	  seperately.  That is done automatically in the render.
	(cell_render_value) : Handle style localy, and calculate the size.

2000-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (workbook_control_gui_init) : move the
	  autosave code here.
	* src/workbook.c : from here.

2000-11-09  Morten Welinder  <terra@diku.dk>

	* src/border.c (style_border_unref): Take border out of hash table
 	before we destroy the hashed fields.

2000-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-view.c (workbook_view_init) : Add prototype.

	* src/workbook-control-gui.c (cb_sheet_change_name) : Make static to
	  kill warning.
	* src/workbook-edit.c (workbook_edit_set_sensitive) : Ditto.

2000-11-09  Morten Welinder  <terra@diku.dk>

	* src/gnumeric-sheet.h (GNUMERIC_SHEET_FACTOR_X,
 	GNUMERIC_SHEET_FACTOR_Y): 1000000 and 2000000.  Still ugly, but
 	now central.

	* src/sheet-view.c (sheet_view_set_zoom_factor): Don't hard-code
 	scroll region sizes multiple places.

	* src/gnumeric-sheet.c (gnumeric_sheet_new): Ditto.

	* src/sheet-control.c (sheet_control_set_zoom_factor): Ditto.

	* src/sheet.h (SHEET_MAX_ROWS, SHEET_MAX_COLS): Remove duplicate
 	macros.

2000-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/stf.c (stf_read_workbook) : We are passing an IOContext.

2000-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_selection_event) : Make
	  the double click handler smarter.  It now handles empties
	  and checks both sides of a row/col.  Left/top is perfered to
	  bottom/right.

2000-11-08  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_init) : Initialize fully, add
	  prepared_to_drag_flag.
	(item_cursor_selection_event) : Move most of the state change
	  associated with BUTTON_PRESS into MOTION_NOTIFY.  And use the
	  prepared_to_drag_flag flag to indicate a requirement to initiate a
	  drag. Move most of the double click handling here.  The resone for
	  these changes was that there was a race condition in the old
	  version.  We were creating a new item cursor when we did a button
	  press.  It started in exactly the same position as the current
	  cursor.  2BUTTON_PRESS were sometimes being sent to the new cusor
	  and sometimes showing up as PRESS events on the old with no RELEASE.
	  This patch attempts to delay creating the new drag cursor until we
	  are sure this is not a double click so that the proper event
	  sequence is sent to the main cursor.

	* src/border.c (style_border_unref) : Unref the colour.
	(style_border_fetch) : unref the colour when needed.

2000-11-08  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_is_region_empty) : New function.

2000-11-08  Morten Welinder  <terra@diku.dk>

	* src/complex.c (complex_from_string): Handle overflow.

	* src/number-match.c (format_match_simple): Don't depend on
 	incoming errno not to be ERANGE.

	* src/sheet-autofill.c (string_has_number): Ditto.

	* src/parser.y (yylex): Ditto.

	* src/value.c (value_new_from_string): Ditto.  Also take care of
 	empty string.

2000-11-08  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (apply_paste_oper_to_values) : Rewrite to use
	  eval_expr.
	(paste_cell_with_operation) : rework to handle pasting as_value
	  correctly.
	(paste_link) : This is broken.  FIXME.
	(paste_cell) : Move the check for pasting content or as_value to the
	  top.

	* src/cell.c (cell_make_value) : Unlink expressions if necessary.

	* src/sheet.c (sheet_cell_set_expr) : flag that content changed.

	* src/dependent.c (dependent_queue_recalc_list) : Add some safety.

	* src/item-cursor.c (item_cursor_event) : clicking on an anted cursor
	  is almost the same as clicking on a selection cursor.

	* src/expr-name.c (expr_name_add) : It is legal to add names that are
	  available in other scopes as long as the new scope does not contiain
	  the name.

2000-11-06  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-autofill.c (autofill_cell) : Use cell_set_value directly.
	  No need to do depends or respaning for each cell.

	* src/commands.c (cmd_autofill_redo) : When we can do it here, for the
	  entire range.
	(cmd_area_set_text_redo) : Add the missing depend update here.

	* src/sheet.c (sheet_cell_set_value) : Render if required.

2000-11-06  Almer S. Tigelaar  <almer1@dds.nl>

	* src/gui-clipboard.c:
	(x_selection_to_cell_region): Make error message more descriptive.
	
	* src/stf.c:
	(stf_read_workbook): Ditto.

2000-11-06  Almer S. Tigelaar  <almer1@dds.nl>

	Fix bug #21674. (Fix will kick in once the version number of the
	XML format is bumped to GNUM_XML_V5)
	
	* src/print-info.c (print_info_new): Add extra commenting.

	* src/xml-io.c:
	(xml_write_print_repeat_range): New function, for saving a repeat range.
	(xml_read_print_repeat_range): New function, for loading a repeat range.
	(xml_write_print_info): Save the row repeat and col repeat range using
	xml_write_print_repeat_range.
	(xml_read_print_info): Read col and row repeat range if file format
	version > GNUM_XML_V4 using xml_read_print_repeat_range.

2000-11-06  Jody Goldberg <jgoldberg@home.com>

	* src/workbook.c (workbook_sheet_detach) : remove unused parm.
	  Be more paranoid about focus handling.

	* configure.in : fix typo.

2000-11-05  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (cb_set_cell_content) : Use cell_set_value.
	(sheet_range_set_text) : remove need for entered_text.

	* src/xml-io.c (xml_read_cell) : Remove 'General' hack.

	* src/dialogs/dialog-cell-format.c (draw_format_preview) : remove
	  entered_text.

	* src/rendered-value.c (rendered_value_new_ext) : No need for
	  entered_text.  Use format_value in place of value_as_string.

	* src/format.c (format_value) : No need for entered_text.
	  Be careful to always set the colour.  This may need to be tuned
	  if we enter '$10' and use a display format of @ what should be
	  displayed ?  10 or $10 ?  We may need to pass in the parse format.

	* src/cell.c (cell_cleanout) : Remove entered_text.
	(cell_copy) : Ditto.
	(cell_set_text) : Ditto.
	(cell_set_value) : Ditto, do not render value here.
	(cell_set_text_and_value) : Delete.
	(cell_set_expr_and_value) : Remove entered_text, and add format
	  argument.
	(cell_set_expr_internal) : No need to manually unref the old expr.
	  That was already done in cleanout.
	(cell_make_value) : remove entered_text.

	* src/rendered-value.c (cell_get_entered_text) : Use the stored parse
	  format and format_value to regenerate the entered text from a value.

2000-11-04  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-view.c (sheet_view_{col,row}_size_changed) : Only resize
	  all columns if the column that changed is part of the selection.

	* src/selection.c (sheet_selection_full_{cols, rows}) : flag whether
	  the selection contains the requested col.

2000-11-04  Jody Goldberg <jgoldberg@home.com>

	* src/format-template.c (format_template_apply_to_sheet_regions) : No
	  need to request a redraw.
	(cb_format_sheet_style) : Use sheet_range_apply_style because it
	  requests a redraw and handles respaning/spacing when necessary.

2000-11-03  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_paste_copy_undo) : Clear any operations when
	  storing the undo info for paste_copy.  There is no longer any need
	  for the operations.  We are storing the image.

	* src/clipboard.c (clipboard_prepend_cell) : Be safe and init the
	  comment field.

2000-11-03  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Update the GAL requirement.

2000-11-03  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_paste_region) : Optimize the styles for
	  the entire target region in one swoop, rather than each tile
	  individually.  This fixes the reported problem symptom.  I do not
	  have a definite reason why it was failing before.  This may just be
	  sweeping it under the rug.

	* src/xml-io.c (xml_workbook_write) : Bump the xml version.

	* src/format.c (format_value) : A string value takes precedence over
	  the entered text.

2000-11-03  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/analysis-tools.glade : Rename 'Alpha' to '1 - Alpha'

	* src/complete-sheet.c (text_matches) : Only use values that are strings
	  do not bother with 'entered_text'
	(complete_sheet_search_iteration) : Adjust the calls to text_matches.

	* src/dialogs/dialog-cell-format.c (fmt_dialog_init_format_page) : Be
	  careful to use the non-localized version of the format internally.

	* src/cellspan.c (cell_calc_span) : Ignore hidden columns.

	* src/colrow.c (col_row_set_visibility_list) : regen the spans outside
	  the region which changes visibility.

	* src/sheet.c (sheet_regen_adjacent_spans) : Split this out
	  from sheet_clear_region.

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-autofill.c (string_has_number) : thou shalt not use atoi
	  for it does not check for oeverflow.

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell_range) : Set the printed flag whenever
	  there is a valid cell.

	* src/sheet-autofill.c (autofill_create_fill_items) : Do not look up
	  the cell here.
	(fill_item_new) : lookup the style and cell here.
	(sheet_autofill_dir) : Always apply the style.
	(fill_item_destroy) : release the style.

2000-11-02  JP Rosevear  <jpr@helixcode.com>

	* src/xml-io.c (xml_read_attributes): Don't check for a workbook,
	this is redundant and not even true any more.
	(xml_workbook_read): Only read the attributes if the workbook is
	version 5 or later.

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_new_ext) : Any form of General
	  will need a width.  Default to full precision.

	* src/cell.c (cell_set_value) : Do not assign optional formats of General

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (cb_file_new) : We need to create a
	  control & view.
	(workbook_close_if_user_permits) : Do not attempt to finsihed editing
	  here.  This is called in a loop from cb_file_quit.
	(wbcg_close_control) : stop editing here.
	(cb_file_quit) : and stop editing here before closing and workbooks.
	  While closing workbooks save the calling working for last so than
	  can save the current view rather than guessing and using the first.

2000-11-02  Almer S. Tigelaar  <almer1@dds.nl>

	* src/dialog-autoformat.c:
	(templates_load): Also apply filtering to newly loaded templates.
	(dialog_autoformat): Don't call format_template_apply_to_sheet_regions,
	pushing the undo stuff (cmd_autoformat) already does this anyway.

	* src/format-template.c: Fix bug #30413
	(format_template_range_check): New, checks if the target range
	is wide enough to apply the format template to.
	(format_template_apply_to_sheet_regions): Use format_template_range_check
	to check the ranges. Display an error and abort when a range is invalid.
	(format_template_recalc_hash): Idem, but don't display an error but a
	warning, as no such error is supposed to happen here.
	
	* src/format-template.c: Fix bug #30419
	(format_template_filter_style): Add COLOR_BACK to pattern filtering.
	(format_template_filter_style): Correct to not always replace
	unset elements with default elements.
	(cb_format_hash_style): call format_template_filter_style with
	default element replacing.
	(cb_format_sheet_style): call format_template_filter_style without
	default element replacing.
	(cb_format_sheet_border): Idem.

2000-11-02  Michael Meeks  <michael@helixcode.com>

	* configure.in: Require bonobo-0.27+

2000-11-02  Michael Meeks <michael@helixcode.com>

	* The big api rename ...
	
2000-11-02  Michael Meeks  <michael@helixcode.com>

	* configure.in: bump gb requirement to gb-0.0.15

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_new_sheet_view) : Set the cursor when the sheet
	  is attached.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_clear_redo) : reverse the content list to keep
	  it in sync with the range list.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_read_cell) : Default the parse format to General.
	  Eventually we can simply cell_set_value to not guess that the
	  display format == the parse format.  However, that will require
	  changing all of the importers.  For now we can cheat, and supply
	  General as the format.

	* src/functions/fn-string.c (gnumeric_dollar) : use string_get_nocopy.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (cellref_relocate) : inside is always calculatd based on
	  the source sheet.  eg  Sheet1:A1 = '=A2' and we are moving A1:A2
	  from Sheet1 -> Sheet2.  The reference to A2 should be considered
	  'inside'.  References to Sheet2!A2 have already been #REF!ed.

	* src/commands.c (cmd_paste_cut_redo) : Use range_check_sanity.

	* src/sheet.c (sheet_cell_insert) : Render if necessary.
	(sheet_move_range) : Extra care is only necessary if the source and
	  target sheets are the same.  When they are different we should just
	  invalidate all references to the target range.

2000-11-02  Jon K Hellan  <hellan@acm.org>

	* src/workbook.c (workbook_history_update): Fix test to avoid
	  changing an already correct history.
	(workbook_destroy): Don't free wb->filename until we're through 
	  using it.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-sheet.c (selection_insert_selection_string) :
	  Set the position to where we expect it to be.
	(gnumeric_sheet_key_mode_sheet) : Only call sheet_update if we are not editing.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_name_quote) : names with parethesis require quotes.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-edit.c (workbook_finish_editing) : Restore the focus
	  from here.
	* src/workbook-control-gui.c
	(cb_cancel_input, cb_accept_input) : rather than here or here.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* */*.[ch] : s/SheetView::sheet_view/SheetView::canvas/
	  This has been bugging me for months.

	* src/gnumeric-sheet.c (move_cursor) : stop the edit at this level
	  rather than in sheet_cursor_set.
	(gnumeric_sheet_key_mode_sheet) : Use move_cursor.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/ranges.c (range_translate) : Split sanity check into new function.
	(range_check_sanity) : here.

	* src/xml-io.c (xml_read_range) : Use it.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_new) : Be mroe fine grained about the changes to
	  the edit position.
	(sheet_flag_status_update_cell) : Only content and format have changed.
	(sheet_flag_status_update_range) : handle the new flags.
	(sheet_flag_format_update_range) : new function.
	(sheet_update_editpos) : delete and split up.
	(sheet_update) : Do each update seperately. NOTE : this is broken.
	  All of these flags should be at the View level.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (sheet_selection_copy) : pass a workbookcontrol.
	(sheet_selection_cut) : Ditto.

	* src/commands.c (cmd_format_undo) : flag the format change.
	(cmd_format_redo) : Ditto.

	* src/workbook-control.h (wb_control_claim_selection) : new virtual.
	* src/application.c (application_set_selected_sheet) : Used here.
	(application_clipboard_copy) : Take a WorkbookControl.
	(application_clipboard_cut) : Ditto.

	* src/workbook-control-gui.c (wbcg_paste_from_selection) : new
	  function.
	(workbook_control_gui_ctor_class) : register it.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell_range) : We are only outputing
	  something in the case of a blank cell if the format is visible.

2000-11-01  Almer S. Tigelaar  <almer1@dds.nl>

	* src/dialogs/dialog-stf.glade: 
	Beautify dialog.

2000-11-01  Almer S. Tigelaar  <almer1@dds.nl>

	* src/print-cell.c:
	(print_cell_range): Fix #29442, if a cell's background
	is 'printed' this also counts as a 'printed cell'

2000-11-01  Almer S. Tigelaar  <almer1@dds.nl>

	* src/dialogs/dialog-autoformat.c:
	(dialog_autoformat): Kill memory leak, we were not freeing
	the list of acquired selection ranges.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_set_text_undo) : Use sheet_clear_region to
	  ensure that spans get regenerated in neighbouring cells.
	(cmd_set_date_time_undo) : Ditto.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/number-match.c (format_create_regexp) : Fix typo in regexp.
	  Be careful to only match 1 or more digits as a number.

2000-10-31  Morten Welinder  <terra@diku.dk>

	* src/parser.y (unregister_allocation): plug leak.
	("line = error"): deallocate the result, just in case the parser
 	discovers the error after reducing the regular line production.
	(gnumeric_expr_parser): Initialise *parser_result.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_ins_del_row_col_undo) : Correct target range.

2000-11-01  Michael Meeks  <michael@helixcode.com>

	* src/command-context-corba.[ch]: privatize the command context.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/cmd-edit.c (cmd_paste) : change the selection when pasting.
	(cmd_shift_{rows,cols}) : Do not change the selection when pasting.

	* src/commands.c (cmd_paste_cut_{undo,redo}) : Only select the target
	  if requested.
	(cmd_paste_cut) : new argument.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/value.c (value_new_from_string) : Reset errno on over/underflow.
	* src/number-match.c (format_match_simple) : Ditto.

	* src/parser.y (yylex) : reset errno in the event of over/underflow.
	  test for 'e' as an indicator of flaoting point numbers.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/application.c (application_init) : Register a shrunken version
	  of the print preview.

	* src/workbook-control-gui.c (workbook_menu_file) : Use the new
	  shrunken print preview icon.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (cb_cancel_input) : renamed from
	  cancel_input, and return focus to the sheet.
	(cb_accept_input) : renamed from accept_input, and return focus
	  to the sheet.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_popup_menu) : Use the MENU versions of
	  the stock pixmaps.

2000-10-31  Morten Welinder  <terra@diku.dk>

	* src/analysis-tools.c (get_data_groupped_by_columns): Properly
 	offset col.  Constify.
	(get_data_groupped_by_rows): Properly offset row.  Constify.

2000-10-31  Jon K Hellan  <hellan@acm.org>

	* src/io-context.c (gnumeric_io_error_system): Added it.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-view.c (wb_view_auto_expr) : Set LC_MONETARY and
	  LC_NUMERIC.
	* src/xml-io.c (xml_workbook_write) : Ditto.
	(xml_workbook_read) : Ditto.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/*.[ch] : WorkbookControlGUI is now required for gui
	  operations.  A WorkbookView is required to know which sheet is the
	  current.

	* src/xml-io.c : We now load/save WorkbookViews.

	* src/xml-io-autoft.c : Adjust to signature changes.

	* src/workbook.c : Split the View into WorkbookView.
	  Abstract the Controler interface, and move the GUI specific
	  implementation of the Controler into WorkbookControlGUI.

	* src/workbook-view.c : Complete rewrite with correct semantics.

	* src/workbook-private.h : Move all the GUI specific stuff into
	  WorkbookControlGUI were it belongs.

	* src/workbook-private.c (workbook_private_class_init) : Fix typo.

	* src/workbook-edit.c : These are now WorkbookControlGUI specific.
	  We should rename the functions eventually.
	* src/workbook-format-toolbar.c : Ditto.
	* src/workbook-object-toolbar.c : Ditto.

	* src/workbook-cmd-format.c : Adjust to signature changes.
	  and use WorkbookControlGUI were necessary.

	* src/style.c (style_font_new_from) : Delete dead code.

	* src/solver-lp.c : Adjust to signature changes.
	* src/sort.c : Ditto.
	* src/stf.c : Ditto. Make dialog conditional on gui-ness.

	* src/sheet.c (sheet_new_sheet_view) : IS_SHEET checks for NULL.
	(sheet_detach_sheet_view) : renamed from sheet_destroy_sheet_view
	  and only take a SheetView as argument.
	(sheet_new) : Do not create a view by default.
	(sheet_update_zoom_controls) : foreach control.
	(sheet_update_editpos) : ditto.
	(sheet_update) : handle multiple views and controls.

	* src/sheet-view.c : Commands take WorkbookControls rather than
	  CommandContexts.

	* src/sheet-object-widget.c : Most things take WorkbookControlGUI
	  rather than Workbooks.

	* src/sheet-object-container.c (sheet_object_container_new_view) :
	  Use the uic from the WorkbookControlGUI.

	* src/sheet-control.c : New file. Unused so far.
	  cp sheet-view.c sheet-control.c
	  s/SheetView/SheetControl/

	* src/print.c : Make the GUI dependency explicit.
	  At some point the setup dialog should be split out of here.

	* src/main.c (gnumeric_main) : Explicitly create a WorkbookControlGUI
	  only adding sheets if nothing was loaded.  Improve handing of exit
	  request while loading.

	* src/item-grid.c (item_grid_draw) : Filter the edit cell from here
	  because we know which control to use.
	(context_menu_hander) : Switch to WorkbookControlGUI.
	(item_grid_popup_menu) : Ditto.

	* src/item-edit.c : Everything takes a WorkbookControlGUI inplace of a
	  Workbook now.

	* src/item-cursor.c (item_cursor_target_region_ok) : dialog_run takes
	  a WorkbookControlGUI.
	(item_cursor_do_action) : All the commands take WorkbookControls.

	* src/item-bar.c (item_bar_event) : item_grid_popup_menu takes a
	  SheetView now.

	* src/history.c : Take WorkbookControlGUI.
	  Update all controls for each workbook.

	* src/gui-clipboard.c : Use 'unsigned char'

	* src/gnumeric.xml : More work to split commands from layout.

	* src/gnumeric-util.c (gnumeric_no_modify_array_notice) : Delete.
	(gnumeric_notice) : Take a WorkbookControlGUI.
	(gnumeric_wb_dialog_run) : Ditto.
	(gnumeric_dialog_run) : Ditto.
	(gnumeric_dialog_show) : Ditto.
	(gnumeric_set_transient) : Ditto.
	(gnumeric_glade_xml_new) : Ditto.
	(gnumeric_non_modal_dialog) : Ditto.
	(gnumeric_inject_widget_into_bonoboui) : Ditto.

	* src/gnumeric-sheet.c : SheetView now has a WorkbookControlGUI member
	  to keep track of which control it is associated with. Use it.

	* src/file.c : Adjust to lots of signature changes.
	  We now load/save WorkbookView rather than Workbook.
	  Add a placeholder struct IOContext so that we can consider doing
	  smarter import/export and dealing with warnings and missing things
	  smoothly.

	* src/eval.c (workbook_recalc_all) : After a recalc update all views.

	* src/commands.c (undo_redo_menu_labels) : foreach control.
	(command_undo) : ditto.
	(command_redo) : ditto.
	(command_push_undo) : change signature.  The workbookcontrol
	  now acts as the command context.

	* src/cmd-edit.c : Adjust to signature changes.

	* src/clipboard.c : split the gui specific X handlers out into a new
	  file.
	* src/gui-clipboard.c :  here.

	* src/cell-draw.c (cell_draw) : Do not test the sheet for whether or
	  not to we are editing.  That is at the control level.  Test it in
	  the rendering loop.

	* src/bonobo-io.c : FIXME. adjusted to signature changes.  Totatly
	  broken for now.  This needs a View rather than a Model and should be
	  associated with something.

	* src/application.c (application_workbook_list_add) : New function.
	(application_workbook_list_remove) : New function.
	(application_workbook_list) : New function.
	(application_clipboard_copy) : foreach control.
	(application_clipboard_cut) : foreach control.
	(application_clipboard_clear) : foreach control.
	(application_workbook_foreach) : renamed from workbook_foreach.
	(application_set_selected_sheet) : FIXME. Disabled for now.

	* src/about.c (cb_closed) : Associated the flag with the control
	  directly.
	(dialog_about) : dialogs are associated with gui-controls.

	* src/analysis-tools.c : change all dialog signatures to handle MVC
	  split of workbook.

2000-10-30  Jody Goldberg <jgoldberg@home.com>

	* src/Makefile.am : Add new command-context,  io-context,
	  workbook-view, workbook-control, workbook-control-gui files.
	  Remove old command-context-gui, command-context-corba, and disable
	  corba-* for now.

2000-10-29  Jody Goldberg <jgoldberg@home.com>

	* idl/gnumeric-graphs.idl : Remove studdly caps.  I wish people would
	  make up their minds.

	* idl/Gnumeric.idl : Remove Workbook::show.

2000-10-29  Jody Goldberg <jgoldberg@home.com>

	* BUGS : Update.
	* NEWS : Update.
	* TODO : Update.

2000-10-30  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-math.c (gnumeric_sumproduct): Plug leak.

2000-10-29  Almer S. Tigelaar  <almer1@dds.nl>

	* src/commands.h, src/commands.c:
	(cmd_autoformat_undo): New, undo for the autoformat.
	(cmd_autoformat_redo): New, redo for the autoformat.
	(cmd_autoformat_destroy): Part of undo/redo.
	(cmd_autoformat): Idem.
	
	* src/format-template.h: Correct outdated comment.
	
	* src/format-template.h, src/format-template.c:
	(format_template_member_clone): New, clone a templatemember.
	(format_template_clone): New, clone a format template.
	(cb_format_sheet_style): Insert extra checks.
	(cb_format_sheet_border): Idem.
	(format_template_apply_to_sheet_selection): Renamed.
	(format_template_apply_to_sheet_sheet_regions): Modification of the
	above function, now accept a separate list of regions.

	* src/dialogs/dialog-autoformat.c:
	(dialog_autoformat): Modify so it calls upon routines which record
	undo/redo information.

2000-10-28  Michael Meeks  <michael@helixcode.com>

	* configure.in (Configuration): add scary message about Gnome Basic.

2000-10-28  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (gnumeric_bonobo_{read|write}_workbook): 
	Forgot to tell: Also replaced vfs storage, which no longer exists
	in Bonobo, with efs, which does. It doesn't seem to work, but
	that's a different matter.

2000-10-28  Almer S. Tigelaar  <almer1@dds.nl>

	* src/clipboard.c:
	(x_selection_to_cell_region): Correct 'char' into 'unsigned char' so the eror
	message will display the correct ASCII decimal.

	* src/stf.c:
	(stf_read_workbook): Idem.

2000-10-28  Jon K Hellan  <hellan@acm.org>

	* configure.in: Require Bonobo >= 0.26.

	* src/bonobo-io.c (write_stream_to_storage,
	gnumeric_bonobo_write_workbook): Switch from
	Bonobo_Storage_create_stream (which no longer exists) to
	Bonobo_Storage_open_stream
	(gnumeric_bonobo_obj_write, read_stream_from_storage,
	gnumeric_bonobo_write_workbook, gnumeric_bonobo_read_workbook):
	Use BONOBO_EX macro for clarity.

2000-10-26  Michael Meeks  <michael@helixcode.com>

	* configure.in: Depend on gb-0.0.14 (CVS)

2000-10-24  Michael Meeks  <michael@helixcode.com>

	* src/sheet-object-bonobo.c: Remove #ifdef ENABLE_BONOBO's
	(open_cb, sheet_object_bonobo_populate_menu): impl.
	(sheet_object_bonobo_class_init): hook in.
	(sheet_object_bonobo_load_from_file): upd.

	* src/sheet-object-container.c (sheet_object_container_new_file): upd.

2000-10-24  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml: Start to separate out cmds / widgets, a very
	long and tedious job, s/Menu_Open/Open/ etc.

2000-10-22  Jon K Hellan  <hellan@acm.org>

	* src/workbook-format-toolbar.c (workbook_format_toolbar []): Now
	also for non bonobo case: Add button to replace font and size
	selectors in vertical mode.
	(workbook_format_toolbar_orient): Show/hide font button mentioned
	above.
	(workbook_create_format_toolbar): Hide font button.

	* src/workbook-format-toolbar.h: Update all toolbar item indexes.

2000-10-21  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (selection_to_list) : delete.
	(selection_get_ranges) : implement  allow_intersection.
	(selection_apply) : change the signature of the callback.

2000-10-21  Michael Meeks  <michael@helixcode.com>

	* src/sheet-object-container.c: include bonobo-object-directory.h

	* configure.in: depend on gb >= 0.0.13 and libole >= 0.1.7

	* README: update to reflect this.

2000-10-21  Jon K Hellan  <hellan@acm.org>

	* src/gnumeric.xml: Add tips for toolbar undo and redo.  Correct
	tip for menu PrintPreview.  Add tip to toolbar zoom.  Don't
	display it when vertical.  Add tips to toolbar font name and font
	size controls. Replace them with a button in vertical mode. (2
	controls -> 1 button.)  It invokes the font page of the format
	dialog. Add tips to toolbar border, background and foreground
	selectors.

	* src/workbook-format-toolbar.c (font_select_cmd): New
	command. Pop up cell format dialog at font page.
	(workbook_feedback_set): Remove warning by not defining toolbar
	variable for bonobo.
	(workbook_format_toolbar_orient): Remove warning by undefining
	this for bonobo.

	* src/workbook.c (format_cells_cmd): Call dialog_cell_format
	with new parameter pageno = FD_CURRENT.

	* src/item-grid.c (context_menu_hander): Ditto

2000-10-21  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml.h: commit to CVS.

2000-10-20  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (do_render_number) : Brown paper bag.  Bug 29068.
	  I HATE global variables.
	(fmt_general_float) : Rewrite to rationalize and catch some corner
	  cases.

2000-10-19  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml: don't display the zoom control when vertical.

2000-10-19  Michael Meeks  <michael@helixcode.com>

	* configure.in (gnumeric_executable): check for (CVS) Bonobo 0.24

	* src/file.c (do_load_from): split from (workbook_load_from): upd.
	(workbook_try_read): use do_load_from to kill (empty) message box.

	* src/bonobo-io.c (gnumeric_bonobo_io_probe): remove annoying warning.

	* src/sheet-object-container.c (sheet_object_container_new_file):
	move this ugly code into bonobo and clean; make D&D components work again.

	* src/bonobo-io.c (gnumeric_bonobo_write_workbook): update for HEAD
	Bonobo.
	(gnumeric_bonobo_read_workbook): ditto.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_load_from_file): upd.

2000-10-18  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (format_value) : Only format doubles as ints if they
	  fit in an integer.
	(fmt_general_int) : improve handling of log (0).
	(fmt_general_float) : ditto.  Increase (temporarily) the width of a
	  decimal point.

2000-10-18  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (fmt_general_float) : clamp the precision at DBL_PREC.

	* src/rendered-value.c (rendered_value_new_ext) : Don't forget the
	  intercharacter spacing when approximating the width of a character.

	* src/str.c (string_get_nocopy) : new function.

	* src/cell.c (cell_set_value) : Use it.

2000-10-16  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_new_ext) : fix some leaks.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_paste_region) : no need to clear the
	  formats.  We are going to be pasting over them later.  This means
	  that we don't rerender everything in the region then replace it.

	* src/rendered-value.c (rendered_value_new_ext) : Pass colwidth as a
	  float to get beter resolution.
	* src/format.c (format_value) : Ditto.

	* src/format.c (fmt_general_float) : More tuning.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_update) : RE_RENDER when a span calc is forced.
	  This is a bit brute force for now, but is necessary to force the
	  re-rendering of values that may have width dependent formats.
	  I've noted a possible future enhancement that would remove this req
	  at the cost of some complexity.

	* src/format.c (fmt_general_float) : new function.
	(fmt_general_int) : new function.
	(format_value) : Use the new routines.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_set_value) : Re-render the entered text to handle
	  width dependent formats.

2000-10-14  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_overflow) : improve drawing of hash marks.
	* src/cell-draw.c (draw_overflow) : to always draw at least one hash.

	* src/rendered-value.c (rendered_value_new_ext) : pass in approx
	  column width in characters for use by general.

2000-10-14  Chema Celorio  <chema@celorio.com>

	* src/workbook.c (workbook_sheet_get_free_name): remove g_assert not
	reached, as it was reached when duplicating sheets with names like :
	"Sales (1995)". If we have a sheet with a number in parenthesis and
	the number is > 1000. Duplicate it with the name "Name (numer) (2)".

2000-10-13  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_new) : Handle the unrefing of
	  the local style here.
	(rendered_value_new_ext) : rather than here.
	(rendered_value_calc_size) : handke the unrefing of the local style
	  here.
	(rendered_value_calc_size_ext) : rather than here.

	* src/preview-grid-controller.c (cb_grid_get_cell) : Adjust the
	  semantics of the rendered_value_*_ext methods so that they don't
	  unref the styles.

2000-10-13  Jody Goldberg <jgoldberg@home.com>

	* src/position.c (parse_pos_init) : Relax the restrictions.

	* src/workbook.c : Improve wording of Names->Define.

	* src/gnumeric.xml : fix typo with Insert->Names->Define

2000-10-12  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_destroy) : Move the destruction of
	  the tip here.
	(item_cursor_drag_event) : from here.  do not destroy the cursor.
	(item_cursor_do_action) : destroy the cursor here.
	(item_cursor_do_drop) : and sometimes here.

2000-10-12  Jon K Hellan  <hellan@acm.org>

	* configure.in: Require bonobo >= 0.21. We now use
	bonobo_ui_util_encode_str - added since 0.20.

	* src/gnumeric.xml: Bonobo no longer supports placeholder
	delimit="both". Use "top" and a separator instead. Indicate
	separators by <separator/> instead <menuitem/>. Change last
	remaining descr to _tip.

	* src/history.c (history_menu_insert_items): Bonobo changed
	again. We fix.
	(file_history_cmd): Use "tip" instead of "descr"

2000-10-12  Jody Goldberg <jgoldberg@home.com>

	* src/main.c (gnumeric_main) : manually init the corba factories after
	  the support subsystems are initialized, but before the workbooks are
	  created.  This needs some serious cleaning.

	* src/embeddable-grid.c (EmbeddableGridFactory_init) : return a flag
	  for later use.
	(grid_view_activate) : focus on the widget not the containing object.

	* src/corba-args.c (gnumeric_arg_parse) : Do not init the corba
	  factories yet.  they were getting called before the application was
	  ready.

2000-10-11  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-util.c (gnumeric_create_popup_menu) : Generalized and
	  moved from item-grid.c

2000-10-11  Jon K Hellan  <hellan@acm.org>

	* src/history.c (file_history_cmd): Removed yet another vestige of
	the old Bonobo UI Handler code: Changed `BonoboUIHandler *uih' to
	`BonoboUIComponent *uic.

2000-10-11  Martin Baulig  <baulig@suse.de>

	Removed the last bits of the old Bonobo UI Handler code.

	* src/workbook-private.h (WorkbookPrivate): Changed `BonoboUIHandler *uih'
	to `BonoboUIComponent *uic'.
	* src/workbook.c (workbook_new): Create the BonoboUIComponent here.

2000-10-10  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-util.c (run_popup_menu) : Delete.
	(popup_menu_item_activated) : Delete.
	(gtk_radio_button_select) : Delete.

	* src/item-cursor.c (item_cursor_do_drop) : Use item_grid_popup_menu.

	* src/sheet-object.c (display_object_menu) : Rename from create_popup_menu
	  and display the menu.
	(control_point_handle_event) : simplify with display_object_menu.
	(sheet_object_canvas_event) : simplify with display_object_menu.

	* src/gnumeric-util.c (gnumeric_popup_menu) : Do not pass the button
	  number from the event that is poping up the menu.  That disables the
	  ability to select a menu item via a different button.

2000-10-10  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-private.c (workbook_private_init) : Init the
	  updating_toolbar flag.

	* src/workbook-format-toolbar.c (set_selection_halign) : Use the
	  updating toolbar flag so that the bonobo version (which does not
	  disable the callbacks) works correctly.
	(change_selection_font) : Ditto.
	(workbook_format_toolbutton_update) : Remove the hackish static and use a real flag.

	* src/gnumeric.xml : Update for the new bonobo.

	* configure.in (AM_INIT_AUTOMAKE) : follow new protocol and bump
	  version immediately after release rather than before.
