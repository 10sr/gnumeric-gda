2001-02-23  Jody Goldberg <jgoldberg@home.com>

	* Release 0.63

2001-02-23  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw_merged_range) : check for background
	  before checking for selection.

	* src/sheet-merge.c (sheet_merge_add) : don't apply the borders from
	  the corner cell to the whole region.  Just the content.

	* src/sheet-control-gui.c (scg_comment_display) : We only need to be
	  sure that scg::selected is a comment if we are using it and no other
	  comment is visible.

	* src/style-border.c (print_hline) : gdk_draw_line excludes the far
	  pixel.  Make this match to keep the draw code consistent.
	(print_vline) : ditto.

	* src/print-cell.c (print_cell_range) : Use the hide_grid from the
	  print flags not the sheet itself.

	* src/print.c (print_page_cells) : We now pass 'HideGridLines' so
	  invert the logic.

	* src/print-cell.c (print_cell) : typo.

2001-02-22  Jody Goldberg <jgoldberg@home.com>

	* src/item-edit.c (point_is_inside_range) : dont highlight ranges on
	  other sheets.
	(scan_at) : simplify.

	* src/workbook-control-gui.c (cb_notebook_switch_page) : If we are
	  only switching pages to select a range there is no need to update
	  anything.

	* src/expr.c (eval_expr_real) : fix old typo.

	* src/commands.c (cmd_unmerge_cells_init) : add simple test to avoid
	  merging singletons.
	(cmd_unmerge_cells) : check for failure.
	(cmd_merge_cells) : ditto.

2001-02-22  Almer S. Tigelaar  <almer@gnome.org>

	* src/preview-grid.c (preview_grid_draw): The style row
	init routine expect a hide gridlines parameter, so we need
	to pass the inverse of the preview grid's show gridlines property.

2001-02-21  Jody Goldberg <jgoldberg@home.com>

	* src/render-ascii.c (cell_region_render_ascii) : The list reveral
	  stuff is no longer needed.  The new engine keeps only complete
	  styles and keeps the list as a partition.

	* src/sheet-style.c (sheet_style_insert_colrow) : When inserting
	  before the first row/col use the style from A/1.

	* src/sheet.h (SHEET_FOREACH_CONTROL) : Be really really careful about
	  potential modifications to the list why we are walking it.

2001-02-20  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_default_halign) : add support for arrays
	  and center booleans.

2001-02-20  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_write_style) : store indent.
	(xml_read_style) : restore indent.

2001-02-20  Jody Goldberg <jgoldberg@home.com>

	* src/item-edit.c (item_edit_draw_text) : draw autocompletions of
	  wrapped text nicely.

2001-01-20  John Gotts  <jgotts@linuxsavvy.com>

	* gnumeric.spec.in: Sync with new directory structure.

2001-02-20  Jody Goldberg <jgoldberg@home.com>

	* src/item-edit.c (item_edit_draw_text) : kill warning.

2001-02-20  Jody Goldberg <jgoldberg@home.com>

	* src/main.c : remove inclusion of embeddable-grid.h this causes
	  problems in the release because main.c then depends on files that
	  are only available in the ENABLE_BONOBO case.

	* src/item-bar.c (bar_draw_cell) : set the clip for the text.  no need
	  to clip a rectangle or shadow whose boundaries we define.

	* src/sheet-control-gui.c (scg_redraw_cell_region) : Handle shrinkage.

2001-02-20  Jon K Hellan  <hellan@acm.org>

	* src/item-edit.c (item_edit_draw_text): Fix wrapped line drawing
	problem.

2001-02-20  Morten Welinder  <terra@diku.dk>

	* src/item-bar.c (bar_draw_cell): Fix column header drawing
 	problem.  (And possibly other weird drawing problems related to
 	style.)

2001-02-20  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dialogs/dialog-cell-format.c (setup_color_pickers): Move
	variable assignments out of assertions to allow compilation with
	"G_DISABLE_ASSERT" defined.

	* src/dialogs/dialog-cell-sort.c:
	Use e_free_string_list() from GAL instead of newly defined
	free_string_list().
	(dialog_cell_sort): Plug leak.

2001-02-20  Morten Welinder  <terra@diku.dk>

	* src/regression.c (LUPDecomp): Really fix row flipping.

2001-02-19  Jon K Hellan  <hellan@acm.org>

	* src/file.h: Add level FILE_FL_MANUAL_REMEMBER. Fix typos:
	FILE_SAVER_ID_INVAID -> FILE_SAVER_ID_INVALID,
	FILE_OPENER_ID_INVAID -> FILE_OPENER_ID_INVALID.

	* src/file.c (file_format_register_open): Fix typo:
	FILE_OPENER_ID_INVAID -> FILE_OPENER_ID_INVALID.
	(file_format_register_save): Fix typo: FILE_OPENER_ID_INVAID ->
	FILE_SAVER_ID_INVALID.
	(cb_unregister_save, workbook_save): Fix
	typo: FILE_SAVER_ID_INVAID -> FILE_SAVER_ID_INVALID.

	* src/workbook.c (workbook_destroy): Only include in history is
	file_format_level >= FILE_FL_MANUAL_REMEMBER.
	(workbook_new, workbook_set_saveinfo): Fix typo:
	FILE_SAVER_ID_INVAID -> FILE_SAVER_ID_INVALID.

	* src/xml-io.c: Fix typos: FILE_SAVER_ID_INVAID ->
	FILE_SAVER_ID_INVALID, FILE_OPENER_ID_INVAID ->
	FILE_OPENER_ID_INVALID.

2001-02-19  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_format) : Optionally supply a name.

	* src/cell-draw.c (cell_draw) : numbers with indents turn to hashes
	  too.  Hmm, I do not like the hash marks.

	* src/print-cell.c (print_cell) : merge in the indent code.

2001-02-19  Morten Welinder  <terra@diku.dk>

	* src/regression.c (LUPDecomp): Fix row flipping.
	(general_linear_regression): Survive failing LUPDecomp.

2001-02-19  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_calc_size_ext) : tune the size
	  of an indent step.

	* src/workbook-control-gui.c (show_gui) : kill warning.

	* src/workbook-format-toolbar.c (cb_format_dec_indent) : implement.
	(cb_format_inc_indent) : ditto.

	* src/gnumeric.xml : Move the toggle specs into commands.

	* src/workbook-control-gui.c (toggle_util) : new func.
	(TOGGLE_HANDLER) : util macro to simplify gnome/bonobo transition.
	(workbook_control_gui_init) : use TOGGLE_REGISTER for the bonobo case.

2001-02-19  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (show_gui): Call
	scg_adjust_preferences only if sheet exists.

2001-02-19  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_paste_cut_redo) : update the selection after the
	  move to handle merged cells.

	* src/workbook-format-toolbar.c : Add a seperator and rename the
	  callbacks to follow std conventions.

2001-02-19  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (wbcg_menu_state_enable_insert) : There
	  has not been a need for the menu path for a while.  Why was this
	  still here ?
	(toggle_menu_item) : clean up the #ifdef to make this readable.
	(wbcg_menu_state_sheet_prefs) : Finish the bonobo case.

2001-02-19  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (show_gui) : It seems like we need to
	  show_all for the bonobo build, I don't know why.  Add an explicit
	  call the scg_adjust_preferences to rehide headers that may be shown
	  inadvertently.

	* src/cellspan.c (cell_calc_span) : Even if the content fits the
	  indent may cause a span.

	* src/style.c (required_updates_for_style) : flag an indent change as
	  something that requires a resize.

2001-02-18  Jody Goldberg <jgoldberg@home.com>

	* src/embeddable-grid.c (set_header_visibility) : delete.

	* src/workbook-control-gui.c (cb_change_zoom) : Block recursion here.
	(zoom_changed) : not here.
	(toggle_menu_item) : add warning for bonobo case.
	(workbook_setup_edit_area) : add show_all to compensate for changes in
	  construct.

2001-02-18  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c : Back port the help text from the bonobo
	  verson.
	(workbook_menu_edit_select) : Use Meta-space for select row,
	  Shift-space does not work well.
	(wbcg_close_control) : fix typo (bug 51058)

	* src/workbook-edit.c (workbook_finish_editing) : Editing is local to
	  the control.
	(workbook_start_editing_at_cursor) : ditto.

2001-02-18  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c : reindent some ugliness from the rename.

	* src/sheet.c (sheet_create_editor) : delete.

2001-02-18  Jody Goldberg <jgoldberg@home.com>

	s/display_zero/hide_zero/		+ necessary logic inversions
	s/show_grid/hide_grid/			+ necessary logic inversions
	s/show_col_header/hide_col_header/	+ necessary logic inversions
	s/show_row_header/hide_row_header/	+ necessary logic inversions
	s/wb_control_paste_special_enable/wb_control_menu_state_paste_special/
	s/wbcg_paste_special_enable/wbcg_menu_state_paste_special/

	* src/workbook-format-toolbar.c (workbook_format_toolbutton_update) :
	  Simplfy and use wbcg::updating_ui.
	(workbook_format_halign_feedback_set) : use simplified interface.
	(workbook_feedback_set) : Ditto.
	(set_selection_halign) : If the current alignment is already set to
	  the target type revert to general.

	* src/preview-grid.c (preview_grid_draw) : cell_draw::h_center 
	  will default to width / 2.
	* src/item-grid.c (item_grid_draw_merged_range) : Ditto.
	(item_grid_draw) : Ditto.

	* src/print-cell.c (print_cell) : print_cell::h_center
	  will default to width / 2.
	(print_merged_range) : Ditto.
	(print_cell_range) : Ditto.

	* src/sheet.c (sheet_adjust_preferences) : Update the menus to reflect
	  changes in prefs.  Take a flag to control redraw requests.
	(sheet_menu_state_enable_insert) : new function.

	* src/workbook-control-gui.c (wbcg_menu_state_enable_insert) : Merge
	  all the insert col/row/cell menu updates into here.
	(wbcg_menu_state_sheet_prefs) : new function.
	(cb_sheet_pref_display_formulas) : reentrancy protection and use
	  sheet_adjust_preferences.
	(cb_sheet_pref_hide_zeros) : ditto.
	(cb_sheet_pref_hide_grid_lines) : ditto.
	(cb_sheet_pref_hide_col_header) : ditto.
	(cb_sheet_pref_hide_row_header) : ditto.
	(workbook_control_gui_init) : add the new menu items.
	(workbook_control_gui_ctor_class) : reorg a bit.

	src/workbook-control.c : reorg a bit.

2001-02-18  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Make python plugin optional.

2001-02-18  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control.c (wb_control_sheet_add) : update menus here.

	* src/print-cell.c (print_cell) : fix the display zero logic.
	* src/cell-draw.c (cell_draw) : ditto.  And fix the comment.

2001-02-18  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_default_halign) : Handle alignment of numbers
	  correctly when displaying formulas.

	* src/embeddable-grid.c (set_header_visibility) : start using our
	  native MVC.
	(Grid_set_header_visibility) : ditto.
	(embeddable_grid_set_header_visibility) : delete.

	* src/sheet-control-gui.c (scg_set_header_visibility) : delete.
	(scg_adjust_preferences) : Make this contingent on having a wbcg.

	* src/selection.c (sheet_selection_set_internal) : Use
	  sheet_menu_state_enable_insert.
	(sheet_selection_reset) : ditto.

2001-02-18  Almer S. Tigelaar  <almer1@dds.nl>

	* src/sheet-private.h : Add flag for insert cells.

	* src/workbook-control-gui.c :
	(wbcg_insert_cells_enable) : New, enable/disable the Insert->Cells menu item.
	(workbook_control_gui_init) : Initialize the insert_cells menu item.
	(workbook_control_gui_ctor_class) : Initialize insert_cells function pointer.

	* src/workbook-control-gui.h : Add menu_item_insert_cells.
	
	* src/workbook-control.c, src/workbook-control.h, src/workbook-control-priv.h :
	Export wbcg_insert_cell_enable to workbook-control.
	
	* src/selection.c
	(sheet_selection_set_internal) : If the whole sheet is selected, 
	disable Insert->Cells. Otherwise enable it.
	(sheet_selection_reset) : Enable Insert->Cells.

 	* src/workbook-view.c
 	(wb_view_menus_update) : Update Insert->Cells too.
	
2001-02-17  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_sheet_write) : Store some flags about the sheet.
	(xml_sheet_read) : Restore them.

2001-02-17  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_clear_undo) : reset the selection to queue a
	  redraw.

	* src/cell-draw.c (cell_draw) : take the coords of the center of the
	  region directly, rather than the left offset.
	* src/print-cell.c (print_cell) : ditto.

	* src/preview-grid.c (preview_grid_draw) : change sematics of the
	  centering arg to cell_draw.
	* src/item-grid.c (item_grid_draw) : ditto.
	(item_grid_draw_merged_range) : ditto. Fix drawing of selected cells.
	* src/print-cell.c (print_cell_range) : ditto.
	(print_merged_range) : ditto.

2001-02-17  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_paste_region) : Allow pasting just
	  formats.

	* src/print.c (print_page) : fix typo.

	* src/xml-io.c (xml_read_style) : Before version 1 and after version 6
	  we stored full styles.  Be sure the create a default style as a
	  backward compatibility measure incase we add elements to styles in
	  the future.

2001-02-17  Almer S. Tigelaar  <almer1@dds.nl>

	* src/commands.c 
	(cmd_hide_colrow_correct_selection) : Make sure the
	hidden cols/rows are not selected. Selecting adjacent cols/rows
	instead. Fixes #38179.
	(cmd_hide_colrow_undo) : Call cmd_hide_colrow_correct_selectio here.
	(cmd_hide_colrow_redo) : And here.
	
	* src/colrow.h, src/colrow.c (colrow_find_adjacent_visible) : 
	New, Find the next visible col/row in the sheet.

2001-02-17  Jody Goldberg <jgoldberg@home.com>

	* src/style-border.c (style_borders_row_draw) : Don't draw the
	  diagonals unless we are drawing the verticals.

	* src/sheet-control-gui.c (scg_scrollbar_config) : simplify a bit.

2001-02-16  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-cell-format.c (fmt_dialog_init_align_page) :
	  begin support for indenting.
	* src/workbook-format-toolbar.c : ditto.

2001-02-16  Jody Goldberg <jgoldberg@home.com>

	* configure.in : post release version bump

2001-02-15  Jody Goldberg <jgoldberg@home.com>

	* s/fit_in_cell/wrap_text/
	rename this in preparation for supporting shrink_to_fit

2001-02-16  Jody Goldberg <jgoldberg@home.com>

	* Release 0.62

2001-02-16  Jody Goldberg <jgoldberg@home.com>

	* src/print.c (render_sheet_objects) : more constness.

2001-02-16  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric.xml : remove the 'pack-end' from some of the format
	  controls too.

2001-02-16  Jody Goldberg <jgoldberg@home.com>

	* src/cell-draw.c (cell_draw) : fix some warnings.

2001-02-15  Jody Goldberg <jgoldberg@home.com>

	* src/number-match.c (compute_value) : check for overflow.

2001-02-15  Jody Goldberg <jgoldberg@home.com>

	* configure.in : remove dead dirs
	* Makefile.am : Add the xml-i18n-*.in files

2001-02-15  Jody Goldberg <jgoldberg@home.com>

	* src/print.c (compute_sheet_pages) : Use even_if_only_styles.
	(print_page) : Ditto.
	(print_sheet) : Ditto.

	* src/xml-io.c (xml_write_print_info) : Support 'even_if_only_styles'
	(xml_read_print_info) : Ditto.
	* src/dialogs/dialog-printer-setup.c (do_fetch_page_info) : ditto.
	(do_setup_page_info) : Ditto.
	* src/print-info.c (print_info_copy) : ditto.
	(print_info_new) : ditto.
	(print_info_save) : ditto.

2001-02-15  Jody Goldberg <jgoldberg@home.com>

	* src/cell-draw.c (cell_draw) : Support indents for left/right
	  alignment.

	* src/cellspan.c (cell_calc_span) : Support indents when calculating
	  spans.

	* src/rendered-value.c (cell_rendered_offset) : new function

2001-02-15  Almer S. Tigelaar  <almer1@dds.nl>

	* preview-grid-controller.c
	(preview_grid_controller_new) : Properly initialize the selection_rect.
	(preview_grid_controller_free) : Remove rect and selection_rect from canvas.

	* templates/autoformat/autoformat.General.advanced.xml : Correct wrongly
	set border.
	
2001-02-15  Jody Goldberg <jgoldberg@home.com>

	* src/mstyle.c (mstyle_visible_in_blank) : off by one error.
	* src/xml-io.c (xml_write_style_border) : Ditto.
	(xml_read_style_border) : ditto.

	* src/rendered-value.c (rendered_value_calc_size_ext) : calculate the
	  indent offsets.

	* src/sheet-merge.c (sheet_merge_add) : redraw the entire region.

2001-02-14  Jody Goldberg <jgoldberg@home.com>

	* src/style-border.c (style_border_draw) : delete.

2001-02-14  Jody Goldberg <jgoldberg@home.com>

	* src/preview-grid.c (pg_style_get_row) : new function.
	(preview_grid_draw) : for use here. 

	* src/sheet-style.c (style_row_init) : New routine spit out from.
	* src/item-grid.c (item_grid_draw) : here.
	* src/preview-grid.c (preview_grid_draw) : for use here.
	(preview_grid_draw_background) : there is no selection.

2001-02-14  Jody Goldberg <jgoldberg@home.com>

	* s/sheet_view/scg/
	Do some renaming before the release

2001-02-14  Almer S. Tigelaar  <almer1@dds.nl>

	* configure.in: Small correction to libglade requirement.

2001-02-14  Morten Welinder  <terra@diku.dk>

	* src/plugin.c (plugin_info_list_read_for_dir): Prepare for xml2.
  	(s/childs/xmlChildrenNode/).

	* src/xml-io-autoft.c (xml_read_format_template_members): Ditto.

2001-02-14  Almer S. Tigelaar  <almer1@dds.nl>

 	* src/preview-grid.c
 	(preview_grid_draw_border): Remove.
 	(preview_grid_draw): Revamp excluding border drawing.

2001-02-14  Jody Goldberg <jgoldberg@home.com>

	* configure.in : bump the libglade req to get some translation fixes.
	* README : ditto.
	* gnumeric.spec.in : ditto.
	
2001-02-14  Karl Eichwalder  <ke@suse.de>

	* src/workbook-control-gui.c (cb_edit_search_replace_query):
	Untabify message.

2001-02-13  Jody Goldberg <jgoldberg@home.com>

	* some header cleanup.  Remove unused copies of
	  rendered-value.h

2001-02-13  Morten Welinder  <terra@diku.dk>

	* src/plugin.c (plugin_info_list_read_for_dir): Plug leak big
 	enough to drive a truck through.
	(plugin_info_free): Plug leak.

2001-02-13  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_clone_styles) : rewrite for new style engine.
	(sheet_move_range) : remove warning.

2001-02-13  Maciej Stachowiak  <mjs@eazel.com>

	Changes to make gnumeric distcheck properly (mildly xml-i18n-tools
	related).

	* po/Makefile.in.in: Remove; this should not be in cvs, autogen
	will create it with gettextize and patch it with xml-i18n-tools.

	* src/dialogs/Makefile.am: Remove define of glade_msgs and remove
	it from EXTRA_DIST; these files are not in cvs any more, rather
	they are generated on demand by the xml-i18n-tools extraction
	code, so they should not (and cannot) go into the distribution
	tarball.

2001-02-12  Karl Eichwalder  <ke@suse.de>

	* templates/autoformat/Makefile.am (Category_files): Typo.

2001-02-12  Jody Goldberg <jgoldberg@home.com>

	* src/cell-draw.c (cell_draw) : Center content on the cell with the
	  content, not on the width of the span (think about asymetric column
	  widths on the left and right.
	* src/print-cell.c (print_cell) : Ditto.

	* src/item-grid.c (item_grid_draw) : Pass the offset from the left
	  edge to the cell with content.
	* src/print-cell.c (print_cell) : Ditto.

2001-02-12  Jody Goldberg <jgoldberg@home.com>

	* src/cell-draw.c (cell_draw) : Fence post problem.  Measure right
	  margin as 'left + width - 1'
	* src/print-cell.c (print_cell) : ditto.

2001-02-11  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw) : pass the correct width.

2001-02-11  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (wb_control_gui_focus_cur_sheet) :
	  Improve the precondition.
	(cb_autosave) : ditto.
	(cb_notebook_switch_page) : Add some safety.

2001-02-11  Karl Eichwalder  <ke@suse.de>

	* src/main.c: s/behaviour/behavior/ and s/colours/colors/ .
	Typo.

2001-02-11  Almer S. Tigelaar  <almer1@dds.nl>

	* configure.in: Small correction for GAL.

2001-02-11  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_cell_set_text) : Queue a redraw before changing
	  in case span shrinks after change.

	* src/sheet-merge.c (sheet_merge_add) : Clear spans

2001-02-11  Jody Goldberg <jgoldberg@home.com>

	* README : bump GAL req.
	* gnumeric.spec.in : ditto.
	* configure.in : Ditto.

2001-02-11  Jody Goldberg <jgoldberg@home.com>

	* src/parser.y : Move the state information into a struct so that we
	  can eventually get rid of the statics.
	Take a 'ParseError' as a place to return more detailed information
	  about parsing errors (Not used yet).

2001-02-10  Jon K Hellan  <hellan@acm.org>

	* src/print.c: Illustrate margin definitions.
	(print_headers): Header, not top margin, should be top of header
	area.
	(print_footers): Footer, not bottom margin, should be top of
	footer area.

	* src/xml-io.c (xml_print_info_fix_margins): New function fix up
	incorrectly stored margins.
	(xml_read_print_margins): Use it.

2001-02-10  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (insert_bonobo_object) : help
	  translators.

	* src/sheet-style.c (foreach_tile) : Only apply to applicable row or
	  col tile segments.

2001-02-09  Jeffrey Stedfast  <fejj@ximian.com>
	
	* src/print.c: include ranges.h

	* src/expr.c: include gutils.h

2001-02-08  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric.xml : Remove the ugly alight right

	* src/style-border.c (style_borders_row_draw) : Do a quick
	  implementation of diagonals.

2001-02-08  Jon K Hellan  <hellan@acm.org>

	* src/embeddable-grid.[ch]: Adapt to more Bonobo changes. 

	* src/embeddable-grid.h (struct EmbeddableGridClass): Add
	POA_GNOME_Gnumeric_Grid__epv.

	* src/embeddable-grid.c:  Remove
	embeddable_grid_(v)?epv.
	(embeddable_grid_class_init): New version.
	(init_embeddable_grid_corba_class, create_embeddable_grid):
	Remove.
	(embeddable_grid_new(_anon)?): Remove CORBA stuff.
	(embeddable_grid_get_type, grid_view_get_type): Use
	bonobo_x_type_unique.
	(grid_view_get_type):

2001-02-08  Almer S. Tigelaar  <almer1@dds.nl>

	* src/style-border.h, src/style-border.c (style_borders_row_draw): 
	Adjust so it uses a vector of ints for column widths instead of 
	reading them out of the Sheet directly.
	
	* src/item-grid.c (item_grid_draw): Built a column width 
	vector and pass it to the style_borders_row_draw routine.

2001-02-08  Morten Welinder  <terra@diku.dk>

	* src/file-autoft.c (category_group_list_get): Plug leak.
	(category_group_free): Plug grave leak.

2001-02-07  Morten Welinder  <terra@diku.dk>

	* src/commands.c (cmd_search_replace_do_cell): Improve quoting
 	using gnumeric_strescape.

	* src/gutils.c (gnumeric_strescape): Imported from src/expr.c.
  	Constified and changed to add the quotes.

	* src/expr.c (strescape): Moved to gutils.
	(do_expr_tree_to_string): Use gnumeric_strescape.

2001-02-07  Jon K Hellan  <hellan@acm.org>

	* src/print.c (print_hf_line): Check if there is room to print a
	header or footer.

2001-02-07  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (border_mask_vec) : fix the problem where
	  artificial conflicts were created when comparing cells without
	  borders to cells with backgrounds and no borders.  the backgrounds
	  were causing the borders to be NULL which would toggle a conflict.

2001-02-06  Jody Goldberg <jgoldberg@home.com>

	* src/print.c (print_page) : Print areas with visible styles too.

	* src/sheet-style.c (sheet_style_has_visible_content) : new function

2001-02-06  Jody Goldberg <jgoldberg@home.com>

	* src/style-border.c (style_borders_row_print) : Use print_hline
	  print_vline to simplify things later.

	* src/print.c (print_page) : typo.

	* src/sheet.c (sheet_col_set_default_size_pts) : Add some safety.
	(sheet_row_set_default_size_pts) : Add some safety.

2001-02-06  Jody Goldberg <jgoldberg@home.com>

	* src/print.c (print_page) : Add a simple filter to avoid printing
	  pages with no content.  Currently uses only cells.  No tests for
	  visible styles on blank cells.

	* src/cellspan.c (cell_calc_span) : improve const.

2001-02-06  Jody Goldberg <jgoldberg@home.com>

	* src/style-border.c (style_border_data) : DO NOT use width 0 lines
	  with dashes.  Strange offset problems happen when you do partial
	  redraws.

2001-02-06  Morten Welinder  <terra@diku.dk>

	* src/workbook-private.c (workbook_private_new): Fix prototype.

	* src/commands.c (cmd_search_replace_destroy): Plug leak.
	(cmd_search_replace_do_cell): Implement string and error failure
 	modes (apart from a FIXME in the code).

2001-02-06  Jon K Hellan  <hellan@acm.org>

	* configure.in, README: Depend on bonobo >= 0.35.

2001-02-06  Almer S. Tigelaar  <almer1@dds.nl>

	* src/gui-clipboard.c (x_selection_to_cell_region):
	Use mstyle_new_default instead of mstyle_new.

	* src/preview-grid-controller.c (preview_grid_controller_new):
	No need to make a copy of the default mstyle.

	* src/format-template.c (format_template_set_style):
	Make sure the passed mstyle gets all it's elements set.

2001-02-06  Jody Goldberg <jgoldberg@home.com>

	* src/style-border.c (style_borders_row_draw) : init x.
	(style_borders_row_print) : init x.

	* src/print-cell.c (print_cell_range) : typo.

2001-02-06  Almer S. Tigelaar  <almer1@dds.nl>

	* src/gui-clipboard.c (x_selection_to_cell_region):
	Don't invoke the STF druid when pasting a single line. Fixes #21507.

2001-02-06  Jon K Hellan  <hellan@acm.org>

	* src/embeddable-grid.c (grid_view_new): Adapt to changes in bonobo.

2001-02-05  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (sheet_style_get_extent) : this should search the
	  entire sheet, not just decrease the extent passed in.

	* src/style-border.c (style_borders_row_draw) : new function.

	* src/print-cell.c (print_cell_grid) : delete.
	(print_cell_range) : sync with itemgrid.
	(print_merged_range) : ditto.
	(print_cell_background) : ditto.

2001-02-05  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw) : Off by one.
	(item_grid_draw_merged_range) : some simple optimization.  No need to
	  calc the coords for the entire cell unless we are painting the
	  content too.

2001-02-05  Jody Goldberg <jgoldberg@home.com>

	* src/style-border.c (style_borders_row_draw) : check for NULL even on
	  the last border.

2001-02-05  Jody Goldberg <jgoldberg@home.com>

	* src/style-border.c (style_border_hmargins) : built from the original
	(style_border_vmargins) : draw routines.
	(style_borders_row_draw) : a wrapper to draw a set of borders.

2001-02-04  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (style_row) : Handle the display of gridlines
	  here.

	* src/item-grid.c (item_grid_draw_merged_range) : prepare to do
	  borders & grids in a batch as part of the standard render process.
	(item_grid_draw) : Ditto.

2001-02-04  Jody Goldberg <jgoldberg@home.com>

	* src/preview-grid.c (preview_grid_realize) : no need for
	  visual_is_paletted.
	* src/item-grid.c (item_grid_realize) : ditto.

2001-02-03  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_workbook_read) : bump xml version to 6.
	(xml_read_style_region) : V6 uses set_range rather than the older
	  apply_range.  We now save/restore fully qualified styles.

2001-02-03  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_objects_max_extent) : new routine.
	(sheet_object_destroy) : regen extent if necessary.

	* src/sheet-control-gui.c (scg_scrollbar_config) : Honour the object
	  max extent flag.

	* src/gui-file.c (gui_file_import) : A successful import must have at
	  least 1 sheet.

	* src/file.c (do_load_from) : Check that a successful read actually
	  imported something.

	* src/gui-clipboard.c (x_selection_to_cell_region) : Init
	  CellRegion::merged.
	* src/stf-parse.c (stf_parse_region) : Ditto.
	* src/xml-io.c (xml_read_selection_clipboard) : Ditto.

	* src/sheet-control-gui.c (scg_object_move) : split out from the
	  control point motion handler.
	(cb_control_point_event) : Use it here.
	(cb_slide_handler) : and here.

2001-02-01  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw) : Last couple of intersection
	  cases.  We now draw correctly for the simple cases.  Grid lines are
	  handled incorrectly.  The error won't show up when drawing, but it
	  will when we do this for printing.  We should also be more careful
	  with the intersection cases for borders.  double check using borders
	  of different colours.

2001-02-01  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (cb_obj_create_button_release) : Use the new default
	  size routine.

	* src/sheet-object-impl.h : Add default_{width, height} to class.

	* src/sheet-control-gui.c (scg_object_update_bbox) : when we select a
	  new object get its position.
	(cb_control_point_event) : This is a motion event.  Get rid of the
	  stupid statics.

	* src/sheet-merge.c (sheet_merge_remove) : free the range AFTER we
	  lookup the cell.  It is possible that the range is the same as the
	  argument and we still need it.

	* src/item-grid.c (item_grid_draw) : Init the extra horizontals
	  in the next two rows.

2001-02-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_get_extent) : don't call style_extent.  The
	  caller can do that if desired.

	* src/item-grid.c (item_grid_draw) : Use the new drawing code.

	* src/style-border.c (style_border_fetch) : init 'width'
	(style_border_set_gc_dash) : Use 'CAP_NOT_LAST' to get consistent
	  behavior with width 0 and width > 0 lines.
	(style_border_hdraw) : implement.
	(style_border_vdraw) : implement.

2001-01-31  Morten Welinder  <terra@diku.dk>

	* src/commands.c (cmd_search_replace): Revert previous interface
 	change (and use a callback instead).  Commands should not know
 	about user interfaces.

	* src/workbook-control-gui.c (wbcg_paste_special_enable): Fix
 	Bonobo case, I hope.
	(cb_edit_search_replace_query): New function.
	(cb_edit_search_replace): Connect cb_edit_search_replace_query.

	* src/item-grid.c (item_grid_draw): Kill a few (real) warnings.

2001-01-31  Almer S. Tigelaar  <almer1@dds.nl>

 	* src/sheet.h :
 	Remove all menu item state flags.

 	* src/sheet-private.h:
 	Put the menu item state flags here.

 	* src/workbook-control-gui.c:
 	(wbcg_paste_special_enable): Remove the second argument to
 	this function. Instead read this directly out of the flags. Add sheet
	argument.
 	(wbcg_insert_cols_rows_enable): Ditto for the 3rd argument and
 	also remove the cols arguments so that one call will update both
 	row and column menu items. Also add sheet argument.

 	* src/workbook-control.c, src/workbook-control.h,
	src/workbook-control-priv.h:
 	Adjust arguments to wbcg_paste_special_enable and insert_cols_rows.

 	* src/application.c:
	(application_clipboard_copy): First set the paste special flag
 	and don't pass argument to paste_special_enable.
 	(application_clipboard_cut): Ditto.
 	(application_clipboard_clear): Ditto.

 	* src/workbook-view.c:
 	(wb_view_menus_update): Update to don't pass flags as argument, don't
 	do separate calls for cols and rows and optimize to do all calls in one loop.

 	* src/selection.c:
 	(sheet_selection_set_internal): Disable or enable insert cols/rows,
 	update UI only when neccessary and rename label for clarity.
 	(sheet_selection_reset): Enable insert cols/rows flags.

2001-01-31  Morten Welinder  <terra@diku.dk>

	* src/search.c (search_replace_verify): For regexps, validate the
 	replacement string.
	(search_replace_compile): Detect whether replacement text is
 	literal (modulo case of letters).

	* src/commands.c (cmd_search_replace): Take a wbcg so we can pop
 	up dialogs.
	(cmd_search_replace_do_cell): Implement "Fail" error mode.

2001-01-30  Jody Goldberg <jgoldberg@home.com>

	* src/preview-grid-controller.c (preview_grid_controller_force_redraw)
	  work around overflow on BSD.
	* src/item-bar.c (item_bar_event) : ditto.

2001-01-30  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_sheet_create) : typo.

2001-01-30  Jody Goldberg <jgoldberg@home.com>

	s/float_t/gnum_float/
	s/int_t/gnum_int/

	* src/sheet-style.c (sheet_style_get_uniform) : implement.

	* src/parse-util.c (parse_text_value_or_expr) : dont lose the entered
	  text.

	* src/history.c (history_menu_insert_separator) : keep case
	  consistent.
	* src/workbook-control-gui.c (workbook_menu_file) : ditto.

	* configure.in : update GAL req.
	* README : ditto.
	* gnumeric.spec.in : ditto.

2001-01-29  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.h : decl for StyleRow.

	* src/xml-io.c : Use the Child and Root aliases to ease ease
	  transition from xml1 -> xml2.
	(xml_sheet_create) : default name for sheets that fail to specify one.

	* src/workbook.c (workbook_sheet_by_index) : improve safety.

2001-01-30  Michael Meeks  <michael@helixcode.com>

	* src/sheet-object-bonobo.c (sheet_object_bonobo_set_server):
	add a ref to the server, we seem to have lost one somewhere.

2001-01-30  Almer S. Tigelaar  <almer1@dds.nl>

	* src/selection.c, src/selection.h:
	(sheet_selection_reset_only): Rename to sheet_selection_reset.

	* src/cmd-edit.c: s/sheet_selection_reset_only/sheet_selection_reset.
	* src/commands.c: Ditto.
	* src/gnumeric-sheet.c: Ditto.
	* src/item-grid.c: Ditto.
	* src/sheet.c: Ditto.
	* src/sheet-control-gui.c: Ditto.
	* src/xml-io.c: Ditto.

2001-01-29  Almer S. Tigelaar  <almer1@dds.nl>

	* src/sheet.h: Add flags for insert cols/rows and paste special.

	* src/selection.c
	(sheet_selection_add_range):
	Remove the settings of insert cols/rows here.
	(sheet_selection_set_internal):
	Set insert cols/rows menu items and flags correctly.
	(sheet_selection_reset_only): Reset insert cols/rows flags.

	* src/application.c
	(application_clipboard_clear): Set enable paste special flag.
	(application_clipboard_copy): Ditto.
	(application_clipboard_cut): Ditto.

	* src/workbook-view.c, src/workbook-view.h
	(wb_view_menus_update): New function, updates the
	insert cols/rows and paste special menu items.
	(wb_view_sheet_focus): Call menus_update here.
	(wb_view_sheet_add): Ditto.

	* src/workbook-control-gui.c
	(workbook_control_gui_init): Update menu items here.

2001-01-29  Fatih Demir	<kabalak@gmx.net>

	* .cvsignore: Added the xml-i18n-* files and the intl
		subdir to the ignores.

2001-01-28  Zbigniew Chyla  <cyba@gnome.pl>

	* src/plugin.c, src/xml-io-autoft.c:
	s/xml_search_child/e_xml_get_child_by_name/
	s/xml_search_child_lang_list/e_xml_get_child_by_name_by_lang_list/

	* src/xml-io.[ch]:
	Removed function: xml_search_child.
	Functions moved to GAL:
	xml_search_child_lang_list_with_score,
	xml_search_child_lang_list,
	xml_search_child_no_lang.
	Use e_xml_get_child_by_name instead of xml_search_child everywhere.

2001-01-27  Zbigniew Chyla  <cyba@gnome.pl>

	Making Gnumeric -Werror friendly (well, almost).

	* plugins/excel/ms-chart.c: Added "#if 0/#endif" around declarations
	of unused variables.

	* plugins/gda/plugin-gda.c (display_recordset): Removed unused
	variable, fixed some errors (that's why I use -Werror).

	* plugins/xml2/xml2.c (init_plugin): Used xml2_probe function.

	* src/search.c: Included "ranges.h".

	* src/style.c: Included "sheet.h"

2001-01-27  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dialogs/plugin-manager.glade: Set policy to AUTOMATIC for some
	scrollbars.

2001-01-26  Zbigniew Chyla  <cyba@gnome.pl>

	* src/gnumeric-sheet.c (gnumeric_sheet_filenames_dropped): Added
	missing file_finish_load(). Displaying error dialog in non-bonobo
	version if file has unknown format.

2001-01-26  Jon K Hellan  <hellan@acm.org>

	* src/sheet-control-gui.[ch] (scg_rangesel_cursor_extend,
	  scg_take_focus): new functions to wrap direct calls to gsheet.

	* src/sheet-control-gui.c (sheet_view_destroy): Yield focus if we
	have it.

	* src/workbook-control-gui.c (wb_control_gui_focus_cur_sheet): Use
	scg_take_focus instead of gtk_window_set_focus.
	(yield_focus): Remove. sheet_view_destroy now takes care of this.
	(wbcg_sheet_add): Do not attach yield_focus.

	* src/item-grid.c (cb_extend_expr_range): Use
	scg_rangesel_cursor_extend instead of gnumeric_sheet version.

2001-01-26  Michael Meeks  <michael@helixcode.com>

	* src/plugin.c (plugin_info_read): g_new0 the PluginInfo so the
	umpteen function pointers are NULL'd.

2001-01-25  Almer S. Tigelaar  <almer1@dds.nl>

        * src/workbook-control-priv.h: Remove insert struct, there
	is only one function in it anyway so no need for a struct.

	* src/workbook-control.c: Adjust for removal of the insert struct.

	* src/workbook-control-gui.c
	(wbcg_paste_special_enable): Use change_menu_sensitivity.
	(workbook_control_gui_ctor_class): Adjust for removal of the insert struct.

2001-01-25  Morten Welinder  <terra@diku.dk>

	* src/commands.c (cmd_search_replace_update_after_action): Delete
 	unused variable.
	(enum SearchReplaceItemType): retire SRI_expr.

	* src/parser.y (parse_ref_or_string): Constify.
	(gnumeric_parse_error): Fix prototype.
	(STRING '(' arg_list ')'): plug leak and use proper error
 	reporting method.

2001-01-25  Zbigniew Chyla  <cyba@gnome.pl>

	* plugins/applix/boot.c plugins/dif/dif.c plugins/excel/boot.c
	plugins/gb/plugin.c plugins/gda/plugin-gda.c plugins/guile/plugin.c
	plugins/html/boot.c plugins/html/boot.h plugins/html/html.c
	plugins/html/html.h plugins/html/latex.c plugins/html/latex.h
	plugins/html/roff.c plugins/html/roff.h plugins/lotus-123/boot.c
	plugins/numtheory/numtheory.c plugins/oleo/boot.c
	plugins/plan-perfect/pln.c plugins/python/python.c plugins/sc/sc.c
	plugins/sylk/sylk.c plugins/xbase/boot.c plugins/xml2/xml2.c:
	Defined gnumeric_plugin_version variable containing Gnumeric version
	string for every plugin.
	Added user_data parameter to "probe", "open" and "save" functions.
	Changed PluginData to PluginInfo.
	Modified can_deactivate_plugin, cleanup_plugin and init_plugin
	functions to match new prototypes in plugin.h.
	Storing registered opener_id/saver_id in variables and using them
	while unregistering.

	* plugins/applix/Makefile.am plugins/dif/Makefile.am
	plugins/gda/Makefile.am plugins/html/Makefile.am
	plugins/lotus-123/Makefile.am plugins/numtheory/Makefile.am
	plugins/oleo/Makefile.am plugins/plan-perfect/Makefile.am
	plugins/sc/Makefile.am plugins/sylk/Makefile.am
	plugins/xbase/Makefile.am plugins/xml2/Makefile.am:
	Installing every plugin in separate directory, together with plugin
	descriptions (plugin.xml files).

	* plugins/applix/plugin.xml, plugins/dif/plugin.xml,
	plugins/gda/plugin.xml, plugins/html/plugin.xml,
	plugins/lotus-123/plugin.xml, plugins/numtheory/plugin.xml,
	plugins/oleo/plugin.xml, plugins/plan-perfect/plugin.xml,
	plugins/python/plugin.xml, plugins/sc/plugin.xml,
	plugins/sylk/plugin.xml, plugins/xbase/plugin.xml,
	plugins/xml2/plugin.xml:
	New files - plugin descriptions in XML files.

2001-01-25  Zbigniew Chyla  <cyba@gnome.pl>

	* src/Makefile.am (GNUMERIC_BASE_SOURCES): Added error-info.[ch]

	* error-info.[ch]: New files.

	* src/plugin.[ch]: New plugin engine.

	* src/dialogs/dialog-plugin-manager.c,
	src/dialogs/plugin-manager.glade,
	src/dialogs/plugin-manager.glade.h:
	New plugin manager.

	* src/main.c (gnumeric_main): Call plugins_shutdown() on shutdown.

	* src/bonobo-io.c
	(gnumeric_bonobo_write_workbook, gnumeric_bonobo_read_workbook,
	gnumeric_bonobo_io_probe): Added "user_data" arg.
	(gnumeric_bonobo_io_init): Saving saver/opener id.

	* src/file-autoft.c (gnumeric_extra_autoformat_dirs): Used
	gnumeric_config_get_string_list function.

	* src/file.c
	(file_format_register_open, file_format_register_save): Added
	user_data parameter, return FileOpenerId/FileSaverId.
	(file_format_unregister_open, file_format_unregister_save): Take
	only FileOpenerId/FileSaverId as parameter.
	(get_file_saver_by_id, get_file_opener_by_id): New functions.
	(do_load_from): Pass user_data parameter to "probe" and "open"
	functions.
	(workbook_save_as, workbook_save): Pass user_data parameter to "save"
	function.

	* src/file.h
	(FileFormatProbe, FileFormatOpen, FileFormatSave): Adder user_data
	parameter.
	(struct _FileOpener, struct _FileSaver): Added opener_id/saver_id
	field.
	(file_format_register_open, file_format_register_save):
	Added user_data parameter, return FileOpenerId/FileSaverId.
	(file_format_unregister_open, file_format_unregister_save):
	Take only FileOpenerId/FileSaverId as parameter.

	* src/gnumeric-util.[ch]
	(gnumeric_error_info_dialog_show, static ctree_insert_error_info):
	New functions displaying dialog with ErrorInfo contents.

	* src/gui-file.c (gui_file_import): Pass user_data parameter to
	"open" function.

	* src/gutils.[ch]
	New functions: gnumeric_config_get_string_list,
	gnumeric_config_set_string_list, g_string_list_copy,
	g_strsplit_to_list.
	(g_create_list): Added missing va_end().

	* src/stf.c (stf_read_workbook, stf_write_workbook): Added user_data
	parameter.

	* src/workbook.[ch] (workbook_set_saveinfo): Now takes file_saver_id
	instead of save_fn.

	* src/xml-io.c
	(xml_probe, gnumeric_xml_read_workbook, gnumeric_xml_write_workbook):
	Added user_data parameter.
	(xml_init): Store xml_opener_id and xml_saver_id.
	(gnumeric_xml_get_opener_id, gnumeric_xml_get_saver_id): New
	functions.

2001-01-25  Almer S. Tigelaar  <almer1@dds.nl>

	* src/clipboard.h : Add PASTE_UPDATE_ROW_HEIGHT as a new paste flag.

	* src/commands.c
	(cmd_paste_copy_undo): Add PASTE_UPDATE_ROW_HEIGHT to the paste flags.
	(cmd_paste_cut_redo): Update the row heights of the target region after
	pasting for consistency with the behaviour of copy.
	(cmd_paste_cut): Show source cut range in undo descriptor.

	* src/clipboard.c (clipboard_paste_region): Update row height after
	pasting if PASTE_UPDATE_ROW_HEIGHT flag is given.

2001-01-25  Jody Goldberg <jgoldberg@home.com>

	* src/cmd-edit.c (cmd_paste_to_selection) : allow merged regions

	* src/clipboard.c (clipboard_paste_region) : Optionally paste merged
	  regions too.

	* src/style-border.c (style_border_fetch) : add margins.

2001-01-24  Morten Welinder  <terra@diku.dk>

	* src/commands.c (cmd_search_replace_update_after_action): New
 	function.
	(cmd_search_replace_undo, cmd_search_replace_redo,
 	cmd_search_replace_do): Call
 	cmd_search_replace_update_after_action.
	(cmd_search_replace_do_cell): Change to work on entered text which
 	is, we believe, what XL does.

2001-01-24  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (sheet_style_get_uniform) : disable stupid cruft
	  until I actually write this function.

	* src/format-template.c (format_template_recalc_hash) : remove the
	  cruft to apply shifted borders.

	* src/gnumeric.xml : Define font Underline/Italic as toggles.

2001-01-24  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_copy_range) : save the merged regions.
	(clipboard_release) : cleanup merged regions.

	* src/commands.c (cmd_merge_cells_redo) : move the non-corner content
	  clearing from here.
	* src/sheet-merge.c (sheet_merge_add) : to here.  Apply the style from
	  the corner to the entire region.

	* src/sheet.c (sheet_range_set_text) : clear range_filled merged
	  regions.

	* src/item-grid.c (item_grid_draw) : borders & grids for merged cells.

2001-01-23  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (style_row) : move the clearing of grid lines
	* src/item-grid.c (item_grid_draw) : from here.

2001-01-24  Almer S. Tigelaar  <almer1@dds.nl>

	* src/gnumeric-util.c (gnumeric_create_popup_menu):
	Let the sensitivity filter function exacly like the
	display filter.

	* src/sheet-control-gui.c (scg_context_menu):
	Disable insert rows/cols according to the selected
	rows/cols. We don't want people to insert anything if
	the whole sheet is selected or if there are multiple
	selections of whole rows and cols.

	* src/workbook-control-gui.c (wbcg_insert_cols_rows_enable):
	Fix typo, "Cols" should be "Columns".

2001-01-24  Almer S. Tigelaar  <almer1@dds.nl>

	* src/clipboard.c (clipboard_paste_region):
	Update row heights after pasting a region. Fixes #38176.

2001-01-23  Morten Welinder  <terra@diku.dk>

	* src/commands.c (cmd_search_replace_do): Implement
 	search-and-replace in range.

	* src/search.c (calculate_replacement): New function.  Implements
 	case preservation.

2001-01-23  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c (scg_colrow_select) : If we are not
	  selecting a range for an expression then we should cancel editing.
	(scg_context_menu) : cancel editing.

2001-01-22  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c : Use the new wrapper function in scg (for now) rather
	  than a direct call to gsheet.

	* src/sheet-control-gui.c (scg_set_cursor_bounds) : new function to
	  wrap direct calls to gsheet.  This is prep for supporting panes.
	(scg_compute_visible_region) : new function
	(scg_make_cell_visible) : new function
	(scg_create_editor) : new function
	(scg_stop_editing) : new function
	(scg_stop_cell_selection) : new function

	* src/pattern.c (gnumeric_background_set_gc) : no need for setting GC
	  in non selection case.

	* src/gnumeric-sheet.c (gnumeric_sheet_create_editor) : renamed from
	  gnumeric_sheet_create_editing_cursor.
	(gsheet_compute_visible_region) : rename from
	  gnumeric_sheet_compute_visible_ranges

2001-01-22  Morten Welinder  <terra@diku.dk>

	* src/search.c (match_is_word): I got this right-end condition
 	wrong.  Oh dear.

	* src/cell.c (cell_has_comment): Resurrect.

	* src/commands.c (cmd_search_replace_do_cell): No need for the
 	sheet argument.
	(command_push_undo): Remove duplicate call to update_after_action.
  	First check parameters, then use them.
	(command_register_undo): New function, split from
 	command_push_undo.
	(command_push_undo): Use command_register_undo.
	(truncate_undo_info): Change to take a Workbook directly.  Caller
 	changed.
	(cmd_search_replace): Use command_register_undo and eliminate
 	gross hack.

2001-01-22  Morten Welinder  <terra@diku.dk>

	* src/search.c (search_replace_verify): When relevant, check that
 	the range text is not empty.  Implement searching for whole words.

	* src/application.c (application_dpi_to_pixels): Fix prototype.
	(application_history_update_list): Constify.
	(application_display_dpi_get, application_display_dpi_set): Change
 	to using doubles, not floats.

	* src/commands.c (cmd_search_replace_redo): hack: don't do
 	anything the first time around.
	(cmd_search_replace_do_cell): Partially implement.
	(cb_search_replace_collect): New function.
	(cb_order_sheet_row_col): New function.
	(cmd_search_replace_do): Partially implement.

	* src/workbook-control-gui.c (cb_edit_search_replace): Activate
 	undo/redo support.

2001-01-22  Almer S. Tigelaar  <almer1@dds.nl>

	Fixes #32417

	* src/workbook-control-gui.c, src/workbook-control-gui-priv.h:
	(wbcg_insert_cols_rows_enable): New, handles enabling/disabling
	of insert cols/rows menu items.
	(change_menu_sensitivity): New, for settings the sensitivity
	of menu items.
	(workbook_control_gui_ctor_class): Add insert_cols_rows.enable
	here.

	* src/workbook-control.c, src/workbook-control.h: Add
	insert_cols_rows_enable as a virtual function.

	* src/workbook-control-priv.h: Add struct for insert_cols_rows
	here.

	* src/selection.c
	(sheet_selection_add_range): After adding a range, find out if
	any range specifies either a whole row or whole col selection
	and disable insert rows/cols accordingly.
	(sheet_selection_reset_only): Re-enable insert rows/cols here.

2001-01-18  Morten Welinder  <terra@diku.dk>

	* src/search.c (search_replace_verify, search_replace_string): New
 	functions.

	* src/commands (cmd_search_replace_do_cell): new function.

2001-01-22  Almer S. Tigelaar  <almer1@dds.nl>

	* src/commands.c (update_after_action):
	Make the sheet that was subject to an undo/redo operation
	the active sheet after the operation has succeeded. Fixes #38208.

2001-01-21  Almer S. Tigelaar  <almer1@dds.nl>

	* src/sheet-autofill.c (autofill_cell):
	Use sheet_cell_set_value instead of sheet_cell_set_text. Fixes bug #38175.

2001-01-17  Morten Welinder  <terra@diku.dk>

	* src/commands.c (cmd_search_replace_undo,
 	cmd_search_replace_redo, cmd_search_replace_do,
 	cmd_search_replace, cmd_search_replace_destroy): New functions,
 	partly from jpablo.

2001-01-16  Morten Welinder  <terra@diku.dk>

	* src/item-grid.c (item_grid_draw): UMR fixes from jody.

2001-01-16  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (sheet_style_get_uniform) : don't leak border ref.

	* src/workbook.c (workbook_sheet_delete) : disable the undo/redo
	  combos when we clear the undo stack.

2001-01-14  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (style_row) : don't apply none to a cleared
	  border.

	* src/sheet-style.h (StyleRow) : const.

	* src/mstyle.c (mstyle_get_color) : const.

	* src/pattern.c (gnumeric_background_set_gc) : remove duplicate
	  test, const.

2001-01-13  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw) : rewrite.

	* src/sheet-control-gui.c (sheet_view_redraw_cell_region) : make the
	  borders wider.

	* src/commands.c (cmd_format) : if there are no borders there is no
	  need to save the surroundings.

	* src/selection.c (selection_contains_colrow) : const

	* src/sheet-style.c (get_style_row) : Fix stupidity.
	(style_row) : ditto.

2001-01-12  Jody Goldberg <jgoldberg@home.com>

	* src/cell-draw.c (cell_draw) : const.

	* src/pattern.c (gnumeric_background_set_gc) : const.
	(gnumeric_background_set_pc) : const.

	* src/sheet-control-gui.c (sheet_view_selection_ant) : No more 'grid'
	  argument.

	* src/item-grid.c : privatize the structure in preparation for panes.

	* src/item-edit.c (entry_create_feedback_range) : no more grid
	  argument.  Use scg instead.
	(item_edit_set_arg) : ditto.

	* src/item-cursor.c (item_cursor_set_arg) : delete the GRID argument
	  it was useless.

	* src/gnumeric-sheet.c (start_cell_selection_at) : Avoid casting the
	  result of a function call.  Remove setting 'Grid' deleted argument.
	(gnumeric_sheet_new) : No more Grid argument.

	* src/preview-grid.c (preview_grid_draw_border) : moved here from
	  item-grid.

2001-01-16  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Switch to AM_GNOME_GETTEXT and remove the
	  AC_LINK_FILES line so that things configure and compile again.

2001-01-12  Morten Welinder  <terra@diku.dk>

	* src/history.c (file_history_cmd) [ENABLE_BONOBO]: Plug leak.

2001-01-12  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (cb_style_extent) : new function.
	(sheet_style_get_extent) : quick easy implementation.

2001-01-11  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (sheet_style_get_extent) : implement.
	(cb_style_extent) : implement.

2001-01-11  Jody Goldberg <jgoldberg@home.com>

	* src/mstyle.c (mstyle_ref_multiple) : new function.
	(mstyle_copy_merge) : new function.
	(mstyle_new_default) : Do not cache the result.  That is done at the
	  sheet level.
	(mstyle_do_merge) : delete.
	(mstyle_get_format) : constness.

	* src/format-template.c (cb_format_sheet_border) : delete.
	(format_template_apply_to_sheet_regions) : borders are no longer special.

	* src/expr.c (expr_tree_array_formula_corner) : do not store the
	  corner anymore.
	(expr_tree_new_array) : ditto.
	(do_expr_tree_unref) : ditto.

	* src/cell.c (cell_relocate) : Arrays are simplified.  No need to keep
	  a pointer to the corner.  It made the system too brittle.
	(cell_set_mstyle) : delete.

	* src/Makefile.am : remove test.[ch]

	* src/gnumeric-sheet.c (gnumeric_sheet_find_{col,row}) : There is no
	  1 pixel border.

2001-01-09  Jody Goldberg <jgoldberg@home.com>

	* src/mstyle.h : Change order of borders to match BorderLocation

2001-01-08  Jody Goldberg <jgoldberg@home.com>

	* src/ranges.c (range_has_header) : avoid leaking styles.

	* src/cell.c (cell_get_mstyle) : Use sheet_style_get, and do not bump
	  the ref count.
	(cell_render_value) : Adjust.
	(cell_get_format : Adjust.
	(cell_set_text) : Adjust.

	* src/functions/fn-information.c (gnumeric_cell) : sheet_style_get
	  does not make a reference. Use it.
	* src/workbook-format-toolbar.c (modify_cell_format) :  Ditto.
	(change_selection_font) : Ditto.
	* src/sheet-autofill.c (fill_item_new) : ditto.
	* src/print-cell.c (print_cell_range) : ditto.
	* src/cellspan.c (cell_calc_span) : ditto.
	* src/sheet.c (sheet_cell_set_text) : ditto.
	* src/rendered-value.c (rendered_value_calc_size) : ditto.
	* src/workbook-view.c (wb_view_format_feedback) : ditto.

2001-01-07  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-cell-format.c (dialog_cell_format) :
	  init initial style to NULL.
	(fmt_dialog_selection_type) : call sheet_style_get_uniform here.

	* src/commands.c (cmd_format_redo) : Now that apply_border is not
	  doing a redraw we need to if there is no style applied.

	* src/selection.c (sheet_selection_extend_to) : Add support akin to
	  gnumeric_sheet_rangesel_cursor_extend to extend to full col/row.

	* src/sheet-control-gui.c (scg_colrow_select) : extend to full col/row
	  if necessary.

	* src/item-bar.c (item_bar_event) : Set the selection, not extend it.

2001-01-11  Morten Welinder  <terra@diku.dk>

	* src/search.h: New file.
	* src/search.c: New file.

	* src/workbook-control-gui.c (cb_edit_search_replace): New
 	function.

	* src/gnumeric.xml: Fix edit->sheet->rename.
	* src/workbook-control-gui.c: Ditto.

2001-01-10  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (wbcg_undo_redo_labels): Add "_" in
	bonobo menu labels.

	* src/gnumeric.xml: Caught another missing "_" in menu labels.

2001-01-10  Morten Welinder  <terra@diku.dk>

	* src/workbook-control-gui.c: Setup verbs EditDuplicateSheet and
 	EditRenameSheet.
	(wbcg_sheet_remove): Don't unref page; we no longer own the
 	reference.
	(workbook_menu_edit): mirror gnumeric.xml changes.

	* src/gnumeric.xml: Move "Delete Sheet" into a submenu and add
 	duplicate, insert, and rename.
	Remove a few extraneous "..."
	Added and corrected the occasional "_" in menu labels.

2001-01-09  Jon K Hellan  <hellan@acm.org> (on behalf of Jody)

	* src/sheet.c (sheet_update_only_grid): Only set selection if it
	hasn't been cleared.

2001-01-09  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-date.c: Fixup various docs based on a patch
 	from Phillip J Shelton <shelton11@dingoblue.net.au>.

2001-01-09  Jon K Hellan  <hellan@acm.org>

	* src/sheet-control-gui.c (horizontal_scroll_event,
	vertical_scroll_event): Fix bug: Pressing both left and right
	button would pop up a tooltip that couldnt be removed.

2001-01-07  Jon K Hellan  <hellan@acm.org>

	* src/xml-io.c (POINT_SIZE_PRECISION): New define giving precision
	for point measures.
	(xml_set_value_double): Add precision parameter.  -1 means default
	(DBL_DIG).
	(xml_set_value_points): New function. Set a double value for a
	node with POINT_SIZE_PRECISION digits precision.
	(xml_set_print_unit): Save in a more natural way.
	(xml_get_print_unit): Do not expect the node to have a child.
	(xml_write_print_info): Save margins as children of a "Margins"
	node.
	(xml_read_print_margins): New function: Read margins.
	(xml_read_print_info): Find the PrintInformation node so that we
	actually read print info.
	(xml_write_style): Save font size using xml_set_value_points.
	(xml_write_colrow_info): Save font size using
	xml_set_value_points.
	(xml_sheet_write): Save Cols, Rows DefaultSizePts using
	xml_set_value_points.

2001-01-07  Fatih Demir	<kabalak@gmx.net>

	* configure.in: Added tr to ALL_LINGUAS.

2001-01-06  Mike Kestner  <mkestner@ameritech.net>

	* configure.in - Depend on bonobo-0.32.

	* src/sheet-object-item.c (sheet_object_item_new_view): Add ui_cont
	param to the client_site_new_item call.

2001-01-05  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (workbook_close_if_user_permits): Use
	gui_file_save instead of workbook_save.

	* src/gui-file.c (gui_file_import): Do not set selection
	mode. That belongs in the Glade file.

	* src/workbook-control-gui.c (cb_realize): New callback
	function. Make current control size the default. Toplevel would
	resize spontaneously. This makes it stay the same size until user
	resizes.
	(workbook_control_gui_init): Connect cb_realize to realize signal.

2001-01-06  Kenneth Christiansen  <kenneth@gnu.org>

        * configure.in, macros/autogen.sh:
          added support for xml-i18n-tools. This module is now required
          when building from cvs. Please make sure that the macrofile
          installed by xml-i18n-tools is installed so it's in aclocal's
          path. or do:

 	  export ACLOCAL_FLAGS='-I <prefix>/share/aclocal'

2001-01-04  Jon K Hellan  <hellan@acm.org>

	* src/Makefile.am: Add files gui-file.c, gui-file.h

	* src/file.[ch]: Factor out GUI dependent parts of workbook I/O
	handling and move to gui-file.[ch].
	(file_format_get_savers, file_format_get_openers):
	New functions. Used by GUI to access file saver and file opener
	lists.
	(workbook_import): Move to gui-file.[ch].
	(file_finish_load): Made visible in order to split out the GUI.
	(workbook_save_as): The old version moved to gui-file.c and was
	renamed to gui_file_save_as. The new version contains the GUI
	independent part of the old do_save_as. It has explicit file name
	and file saver parameters to remaining GUI independent function.
	(workbook_save): No longer check if it should call
	workbook_save_as. This happens at the GUI layer. Change control
	parameter to WorkbookControl.

	* src/file.h (struct _FileOpener, struct _FileSaver): Had to make
	these visible in order to split out the GUI.

	* src/file.c: Remove file static variable current_saver.
	(file_format_unregister_save): Do not update current_saver.
	(workbook_try_read): Report the error if failure.
	(cb_select, handle_ok, saver_activate,
	file_saver_is_default_format, fill_save_menu, make_format_chooser,
	file_dialog_delete_event, fs_key_event, fs_set_filename,
	wants_to_overwrite, can_try_save_to, dialog_query_load_file): Move
	to gui-file.c

	* src/gui-file.c, src/gui-file.h: New files. Gui dependent parts
	of I/O handling moved here from file.[ch].
	(gui_file_import): New name for workbook_import. Use
	file_format_get_openers to access file opener list.
	(is_saver_registered): New function. Check that a given file saver
	is present in the file saver list.
	(handle_ok): Fix a bug when changing into directory user entered,
	and simplify code.
	(saver_activate, file_saver_is_default_format, fill_save_menu):
	Use file_format_get_savers to access file saver list.
	(file_saver_is_default_format, make_format_chooser): Add GUI
	control parameter.
	(fill_save_menu): Save GUI control as object data on menu items.
	(do_save_as): Don't call insure_saver. That check is redundant
	here. Set view's preferred size to size of control's notebook
	before saving, so that this size gets saved in workbook.
	(gui_file_save_as): New name for old workbook_save_as.
	Verify that control's current saver is still valid before displaying
	dialog.
	(dialog_query_load_file): Simplify code to select workbook's
	directory.
	(gui_file_save): New function. Set view's preferred size as in
	do_save_as, then call workbook_save.

	* src/workbook-control-gui.c (cb_autosave, cb_file_save): Call
	gui_file_save instead of workbook_save.
	(workbook_close_if_user_permits): Cast wbcg to WorkbookControl
	before calling workbook_save.
	(cb_file_import): Call gui_file_import instead of workbook_import.
	(cb_file_save_as): Call gui_file_save_as instead of
	workbook_save_as.

	* src/workbook-control-gui-priv.h (struct _WorkbookControlGUI):
	Add current_saver member. Include file.h.

2001-01-04  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-sheet.c (rangesel_{horizontal,vertical}_move) : remove
	  crufty use of ItemCursor::base.  The cursors have both corners now.

2001-01-04  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_event) : animated cursors can no be
	  dragged or resized.   NOTE : This introduces a small bug while
	  fixing another.  The animated cursor is frequently drawn on top of
	  the current selection cursor when it is first created.  As such the
	  selection cursor does not receive all the events it should.
	  Ideally the canvas would pass ignored events to the widget below, but
	  that is not going to happen.  We can not just forward the events to
	  the other cursor because it may have moved.  We would need to ensure
	  that we only forward things in the areas that are overlapping.  Which
	  is not easy.
	(item_cursor_set_spin_base) : delete.

	* src/item-grid.c (item_grid_button_1) : support shift-extending a
	  range selection cursor.

	* src/workbook-view.c (wb_view_selection_desc) : Add some safety.

	* src/gnumeric-sheet.c (gnumeric_sheet_rangesel_cursor_extend) :
	  Intelligently handle extension to full rows/cols and rename from
	  gnumeric_sheet_selection_extend.
	(start_cell_selection_at) : no need to set the base a second time.
	(gnumeric_sheet_rangesel_cursor_bounds) : rename from
	  gnumeric_sheet_selection_cursor_place and allow the specification of
	  base and move coords.
	(gnumeric_sheet_selection_cursor_base) : delete.

	* src/item-bar.c (is_pointer_on_division) : no resizing while range
	  selecting.
	(get_element_from_pixel) : delete dead code.

2001-01-03  Jody Goldberg <jgoldberg@home.com>

	* src/item-bar.c (item_bar_event) : Call scg_colrow_select directly.
	  and convert from using 'is_vertical' to 'is_cols' which is the
	  convention everywhere else.
	(cb_extend_selection) : ditto.
	(colrow_tip_setlabel) : ditto.
	(item_bar_marshal) : delete.
	(get_row_name) : fortify a bit.

	* src/sheet-control-gui.c (scg_colrow_select) : merge together from
	  sheet_view_{col,row}_selection_changed and rewrite.
	(sheet_view_construct) : remove handlers for the item-bar signal.

	* src/commands.c (cmd_autofill_redo) : check for array violations.
	  Clear the target range.  This will allow entire arrays to be filled.
	(cmd_autofill) : Use the area that we will be filling rather.  Excude
	  the area that will not change.

	* src/sheet.c (sheet_{col,row}_get_info) : simplify.

	* src/selection.c (walk_boundaries) : don't walk into hidden cols/rows.

2001-01-02  Jody Goldberg <jgoldberg@home.com>

	* src/Makefile.am : add the new file.

	* src/sheet-style.h : new file split from sheet.h in preparation
	  for changing the style engine.

2001-01-01  Jody Goldberg <jgoldberg@home.com>

	* src/colrow.c (cb_set_colrow_size) : ignore resize requests for
	  hidden cols/rows.

2000-12-30  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c : fix includes.
	* src/file-autoft.c : ditto.
	* src/format-template.c : ditto.
	* src/workbook-format-toolbar.c : ditto.
	* src/xml-io-autoft.c : ditto.
	* src/format-template.h : do not in include <config.h> publicly

	* src/mstyle.c (mstyle_new_default) : use style_color_{black,white}

2000-12-30  Jody Goldberg <jgoldberg@home.com>

	* rename border.[ch] -> style-border.[ch]
	* rename color.[ch] -> style-color.[ch]

2000-12-30  Jody Goldberg <jgoldberg@home.com>

	* src/border.c (style_border_draw) : Take a StyleBorderLocation rather
	  than an MSTYLE_ELEMENT.  The fit is more natural.
	(style_border_print) : ditto.
	(style_border_get_orientation) : ditto.

2000-12-30  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (wbcg_size_pixels_set): Remove it.
	(workbook_setup_edit_area, workbook_setup_sheets)): Add GTK_SHRINK
	option to gtk_table_attach.
	(show_gui): New function. Size window, then show it.  If
	the workbook specifies a preferred size, the notebook is sized,
	and the window size constrained to not exceed the screen
	size. Otherwise, a size is computed based on screen size. Parts
	extracted from workbook_control_gui_init.
	(workbook_control_gui_init): Move sizing to show_gui. To be sure
	that everything is initialized, run show_gui as a GTK idle proc.

2000-12-30  Jody Goldberg <jgoldberg@home.com>

	* src/cell-draw.c (cell_draw) : sync drawing with
	* src/print-cell.c (print_cell) : printing.

	* src/item-grid.c (item_grid_draw) : sync drawing with
	* src/print-cell.c (print_cell_range) : printing.
	(print_merged_range) : new function, sort of works.  We need to draw
	  grids AFTER content to avoid this sort of sillyness.

2000-12-29  Jody Goldberg <jgoldberg@home.com>

	* src/cell-draw.c (cell_draw) : support multiline text in merged
	  cells.

	* src/sheet.c (cb_max_cell_height) : merged cells do not contribute to
	  the row height.

2000-12-29  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-autofill.c (sheet_autofill_dir) : support merged cells.
	(fill_item_new) : Ditto.

	* src/sheet.c
	(sheet_merge_add) : rename
	(sheet_merge_remove) : rename
	(sheet_merge_get_overlap) : rename
	(sheet_merge_contains_pos) : rename
	(sheet_merge_is_corner) : rename
	(sheet_merged_relocate) : rename
	(sheet_merge_get_adjacent) : rename

	* src/rendered-value.c (rendered_value_new) : Use
	  sheet_merge_is_corner rather than sheet_region_get_merged_cell.

2000-12-29  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c (scg_object_update_bbox) : Use the stored
	  coordinates for movement.
	(scg_object_calc_position) : handle inversion and store the coordinates.
	(cb_control_point_event) : use the stored coordinates.

2000-12-29  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_redraw_cell_region) : support merged cells.

	* src/style.c (style_font_new_simple) : guestimate width.
	(style_font_get_width) : new function.

	* src/rendered-value.c (rendered_value_new) : appoximate with via pts.
	  handle merged cells.

2000-12-29  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_region_unmerge) : untag an existing cell as being
	  merged.
	(sheet_cell_remove_from_hash) : ditto.
	(sheet_region_merge) : tag an existing cell as being merged.
	(sheet_cell_add_to_hash) : ditto.

	* src/item-edit.c (recalc_spans) : support merged cells.

2000-12-29  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_read_cell) : Early versions had newlines at the
	  end of their content

	* src/sheet.c (sheet_{insert,delete}_{cols,rows}) : no need to update
	  object positions, we have already moved them.

2000-12-29  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (GNUMERIC_MAKE_COMMAND_WITH_PARENT) : new macro.
	(update_after_action) : new function to localize calls to
	  sheet_update, dirty, recalc.
	(GnumericCommand) : Add a sheet to help localize repeated calls to
	  sheet_update, dirty, recalc.
	(command_undo) : Call update_after_action.
	(command_redo) : Call update_after_action.
	(command_push_undo) : Call update_after_action.
	(cmd_*_{undo,redo}) : remove calls to sheet_update, dirty, recalc.
	(cmd_*) : set the sheet.
	(cmd_paste_cut_update_origin) : new function.
	(cmd_paste_cut_undo) : call cmd_paste_cut_update_origin.
	(cmd_paste_cut_redo) : ditto.

	* src/commands.c (CmdMergeCells) : inherit from CmdUnmergeCells to
	  facilitate reuse and implement.

2000-12-27  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_cell_insert) : privatize.
	(sheet_cell_remove_simple) : privatize.

2000-12-27  Morten Welinder  <terra@diku.dk>

	* src/workbook-format-toolbar.c
 	(workbook_format_toolbutton_update): Plug leak.

2000-12-27  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-format-toolbar.c (cb_unmerge_cells) : hook up the
	  commands.
	(cb_merge_cells) : ditto.  Although merge is not yet implemented.

	* src/sheet.c (sheet_update_only_grid) : Add support for repositioning
	  the selection.
	(sheet_region_unmerge) : set the flag here.
	(sheet_region_merge) : and here.

	* src/commands.c (cmd_unmerge_cells) : implement.
	(cmd_unmerge_cells_destroy) : ditto.
	(cmd_unmerge_cells_redo) : ditto.
	(cmd_unmerge_cells_undo) : ditto.

2000-12-26  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (cb_move_cursor) : fix old off by 1 error.

	* src/workbook-format-toolbar.c (workbook_format_toolbar)
	  merge/unmerge are not toggle items.

	* src/gnumeric.xml : Add entries for merge/unmerge.

	* s/MStyleBorder/StyleBorder/

2000-12-26  Morten Welinder  <terra@diku.dk>

	* src/analysis-tools.c (set_cell_text_col, set_cell_text_row): New
 	functions.
	(summary_statistics): Use set_cell_text_col and/or
 	set_cell_text_row.
	(ztest_tool): Ditto.
	(ttest_paired_tool): Ditto.
	(ttest_eq_var_tool): Ditto.
	(ttest_neq_var_tool): Ditto.
	(ftest_tool): Ditto.
	(regression_tool): Ditto.
	(anova_single_factor_tool): Ditto.
	(anova_two_factor_without_r_tool): Ditto.

2000-12-25  Jody Goldberg <jgoldberg@home.com>

	* src/ranges.h : clean up includes.

2000-12-25  Almer S. Tigelaar  <almer1@dds.nl>

        * src/clipboard.c : Remove superflous remnants of
	the previously integrated gui-clipboard.c

	* src/gui-clipboard.c (x_selection_handler) :
	Replace the hardcoded "2000" with the GNUMERIC_ATOM_INFO
	constant.

	* src/clipboard.c
	(paste_cell_with_operation) : Get rid of sheet_cell_insert.
	(paste_cell) : Idem.

2000-12-22  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (format_number) : partial support for formats of the
	  form [$<currency>-{digit}+].  Eventually we may want to understand
	  what the locale specifier changes.

2000-12-22  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object-container.c (sheet_object_container_new) : new
	  function.
	(sheet_object_container_new_bonobo) : delete.

2000-12-22  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_set_expr_and_value) : Make linking the
	  expression optional.

	* src/ranges.c (range_init_full_sheet) : adjusted from
	  sheet_get_full_range.

2000-12-22  Zbigniew Chyla  <cyba@gnome.pl>

	* plugins/applix/boot.c gnumeric/plugins/applix/boot.c,
	plugins/lotus-123/boot.c gnumeric/plugins/lotus-123/boot.c,
	plugins/oleo/boot.c gnumeric/plugins/oleo/boot.c,
	plugins/xbase/boot.c gnumeric/plugins/xbase/boot.c:
	Used g_extension_pointer() function from gnome-libs, removed
	unnecessary function (filename_ext).

2000-12-22  Zbigniew Chyla  <cyba@gnome.pl>

	* src/plugin.c (plugin_load): Displaying plugin name as part of
	error messages. Removed allocation check - g_new0 is guaranteed to
	return value != NULL unless sizeof (type) == 0.

2000-12-22  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dialogs/dialog-stf-preview.c: Fixed bug. Allocated array was
	to small.

2000-12-21  Jody Goldberg <jgoldberg@home.com>

	* src/bonobo-io.c (gnumeric_bonobo_obj_read) : Don't create the object
	  here.  Pass it in.

2000-12-20  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_position_pixels) : Add some safety.

	* src/selection.c (selection_is_simple) : Fix warning.

2000-12-20  Morten Welinder  <terra@diku.dk>

	* src/mathfunc.c (gnumeric_add_epsilon): New function for more
 	user-wanted rounding behaviour.
	(gnumeric_fake_floor, gnumeric_fake_ceil, gnumeric_fake_round):
 	New functions.

	* src/fn-math (gnumeric_round, gnumeric_roundup,
 	gnumeric_rounddown, gnumeric_trunc, gnumeric_ceil,
 	gnumeric_floor): use fake rounding.

2000-12-20  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (insert_bonobo_object) : utility routine
	  to create objects and to catch errors.
	(cb_insert_bonobo_object) : used here.
	(select_component_id) : and here.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_set_object_iid) :
	  handle object creation failure.

	* src/sheet-object.c (sheet_object_destroy) : Handle the destruction
	  of objects before they are attached to a sheet.

2000-12-20  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dialogs/dialog-autoformat.c (cb_get_cell_content): Reverted
	g_strtod => strtod change. I was wrong.

2000-12-20  Zbigniew Chyla  <cyba@gnome.pl>

	* src/value.c (value_compare):  Use strcoll() when comparing string
	values (interpret strings as appropriate for the current locale).

2000-12-20  Zbigniew Chyla  <cyba@gnome.pl>

	* templates/autoformat/*.xml: Added Polish translations.

2000-12-20  Morten Welinder  <terra@diku.dk>

	* src/file-autoft.c: Include <config.h>.

2000-12-20  Zbigniew Chyla  <cyba@gnome.pl>

	* src/Makefile.am: Removed "-DGNUMERIC_AUTOFORMATDIR" from INCLUDES.
	Now we use a function inside Gnumeric for this.

	* src/dialogs/dialog-autoformat.c:
	Marked strings for translation (sample data).
	(struct AutoFormatInfo): Now we have field current_category_group
	(of type FormatTemplateCategoryGroup *) instead of current_category
	and category_groups instead of categories.
	(cb_get_cell_content): Function g_strtod always uses "C" locale,
	used strtod instead.
	(templates_load): Mostly new implementation, uses
	category_group_get_templates_list().
	(cb_remove_current_activated): Now it is implemented.
	(cb_canvas_button_release): Showing real category name
	(template->category->name). Setting sensitivity of
	info->remove_current menu item.
	(cb_category_popwin_hide): Used
	category_group_list_find_category_by_name when setting
	info->current_category_group and category_list_get_names_list
	when calling gtk_combo_set_popdown_strings. Selecting "General"
	category by default if it exists. Displaying current category
	description in the category combo tooltip.

	* src/file-autoft.c, src/file-autoft.h: New functions:
	gnumeric_sys_autoformat_dir, gnumeric_usr_autoformat_dir,
	gnumeric_extra_autoformat_dirs,
	category_free, category_get_templates_list, category_list_free,
	category_group_free, category_group_get_templates_list,
	category_group_list_get, category_group_list_find_category_by_name,
	category_group_list_get_names_list, category_group_list_free.
	Removed functions: template_list_load, template_list_free,
	util_list_free, category_list_load, category_list_free.

	* src/format-template.c, src/format-template.h:
	New function: format_template_compare_name.
	New structs: FormatTemplateCategory and
	FormatTemplateCategoryGroup.
	(struct FormatTemplate): field category is now of type
	FormatTemplateCategory.

	* src/gutils.c, src/gutils.h: New functions: g_create_list,
	g_lang_score_in_lang_list, g_lang_score_is_better (implemented
	as a macro).

	* src/xml-io-autoft.c:
	(xml_write_format_template_members): Don't write category
	information.
	(xml_read_format_template_members): Used
	xml_search_child_lang_list instead of xml_search_child to find
	"Information" node. Ignore category information.
	(gnumeric_xml_read_format_template_category): New function.

	* src/xml-io-autoft.h: Added
	gnumeric_xml_read_format_template_category function declaration.

	* src/xml-io.c, src/xml-io.h: New functions:
	xml_search_child_lang_list, xml_search_child_no_lang,
	xml_search_child_lang_list_with_score (static function).

	* templates/autoformat/3D.category,
	templates/autoformat/Financial.category,
	templates/autoformat/Classical.category,
	templates/autoformat/General.category,
	templates/autoformat/Colourful.category,
	templates/autoformat/List.category:
	New files, XML descriptions of default categories.

	* templates/autoformat/Makefile.am:
	Templates grouped into categories, now every category is installed
	in separate directory. Installing *.category files as ".category" in
	appropriate directories.

2000-12-20  Jon K Hellan  <hellan@acm.org>

	* src/file.c (dialog_query_load_file): Select directory of
	workbook file if there is one.

2000-12-20  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (selection_is_simple) : Handle merged cells and
	  arrays.

	* src/sheet.c (sheet_relocate_merged) : new function.

	* src/sheet-object.c (sheet_relocate_objects) : we only need to move
	  objects in the origin zone.

2000-12-19  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_clone_merged_regions) : implement.
	(sheet_duplicate) : call sheet_clone_merged_regions.

	* src/xml-io.c (xml_sheet_read) : add IO for merged regions.
	(xml_sheet_write) : Ditto.
	(xml_read_merged_regions) : new function.
	(xml_write_merged_regions) : new function.

2000-12-19  Morten Welinder  <terra@diku.dk>

	* configure.in: Introduce variables for the <yes> and <no> visible
 	markers.  Prepare for fanciness.

	* src/complete-sheet.c (complete_sheet_class_init): Set finalize.
	(complete_sheet_finalize): New function.
	(complete_sheet_destroy): Move the freeing of ->current to
 	_finalize.

	* src/complete.c (complete_destroy): Zero out text field after
 	freeing it.
	(complete_start): Handle the special case of text not changing.

2000-12-19  Miguel de Icaza  <miguel@helixcode.com>

	* src/complete.h (CompleteClass): new method: start_over.

	* src/complete.c (complete_start): invoke start_over.

	* src/complete.c, src/complete-sheet.c: Use E_MAKE_TYPE instead of
	GNUMERIC_MAKE_TYPE.

2000-12-18  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (walk_boundaries) : Make smart walking of merged
	  cells optional.  It only seems to affect walking fixed regions.
	(sheet_selection_walk_step) : Fix previous thinko.

2000-12-18  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (sheet_selection_walk_step) : recognize singletons
	  even when they are merged cells.

2000-12-18  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (sheet_selection_walk_step) : support merged cells.
	(walk_boundaries) : Rewrite to support intelligent walking of merged
	  regions.

	* src/sheet.c (sheet_set_edit_pos) : signature change.

2000-12-18  Morten Welinder  <terra@diku.dk>

	* src/eval.c (sheet_region_get_deps): Take a Range pointer, not a
 	Range structure as argument.  All callers changed.

2000-12-18  Jon K Hellan  <hellan@acm.org>

	* src/print.c (print_page): Fix bug: We must use gnome-print
	coordinate system when clipping to page limit. Also take into
	account that Postscript/gnome-print clip paths exclude the pixels
	on the path.

2000-12-18  Almer S. Tigelaar  <almer1@dds.nl>

	* configure.in : Fix typo in gb check.

2000-12-17  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Post release bump

2000-12-17 Jody Goldberg <jgoldberg@home.com>

	* Release 0.61

2000-12-17  Jody Goldberg <jgoldberg@home.com>

	* src/ranges.c (parse_range) : support singletons.

	* src/sheet-object.c (sheet_object_write_xml) : Store the anchor
	  descriptor.
	(sheet_object_read_xml) : restore the descriptor.

2000-12-17  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-sheet.c (cursor_vertical_move) : fix cut-n-paste-o.
	(rangesel_vertical_move) : Ditto.

2000-12-17  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_find_boundary_horizontal) : support merged cells
	  fully.
	(sheet_find_boundary_vertical) : Ditto.

	* src/gnumeric-sheet.c (gnumeric_sheet_set_cursor_bounds) : Remove
	  unnecessary sanity checks.
	(cursor_horizontal_move) : pass the base row.
	(cursor_vertical_move) : Ditto.
	(rangesel_horizontal_move) : Ditto.
	(rangesel_vertical_move) : Ditto.
	(rangesel_horizontal_extend) : Ditto.
	(rangesel_vertical_extend) : Ditto.

	* src/selection.c (sheet_selection_extend) : Pass the base row/col.
	* src/item-cursor.c (item_cursor_selection_event) : Ditto.

2000-12-17  Almer S. Tigelaar  <almer1@dds.nl>

	* src/dialogs/dialog-stf-preview.c (stf_preview_format_line) :
	Pass desired format to format_match to preserve certain formatting
	information which would previously have been lost.

	* src/stf.c (stf_read_workbook) : First apply the styles to
	the sheet and then fill the contents of the cells instead of
	vice versa.

2000-12-17  Morten Welinder  <terra@diku.dk>

	* src/about.c (dialog_about): Made a little more consistent in
 	style.

2000-12-17  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_new_sheet_view) : no need to normalize.
	(sheet_cursor_set) : no need to normalize.

	* src/item-cursor.c (item_cursor_set_bounds) : Add a notion of
	  move_corner and base_corner.

	* src/gnumeric-sheet.c
	(cursor_horizontal_move) : renamed from move_cursor_horizontal.
	(cursor_horizontal_extend) : renamed from move_horizontal_selection.
	(cursor_vertical_move) : renamed from move_cursor_vertical.
	(cursor_vertical_extend) : renamed from move_vertical_selection.
	(gnumeric_sheet_selection_extend) : no need to normalize.  the
	  item-cursor now does it for us.
	(rangesel_horizontal_move) : renamed from selection_cursor_move_horizontal.
	(rangesel_vertical_move) : renamed from selection_cursor_move_vertical.
	(rangesel_horizontal_extend) : renamed from selection_expand_horizontal.
	  Use the new item-cursor base/move corners.
	(rangesel_vertical_extend) : renamed from selection_expand_vertical.
	  Use the new item-cursor base/move corners.
	(gnumeric_sheet_key_mode_sheet) : simplify.

	* src/sheet.c (sheet_find_boundary_horizontal) : support merged cells.
	(sheet_find_boundary_vertical) : ditto.
	(sheet_set_edit_pos) : Add edit_pos vs edit_pos_real to improve merged
	  cell support.
	(sheet_region_get_merged_cell) : new function.

	* src/gnumeric-sheet.c (move_cursor_horizontal) : Use edit_pos_real to
	  improve handling for merged cells.
	(move_cursor_vertical) : Ditto.
	(start_cell_selection) : Ditto.

2000-12-16  Jody Goldberg <jgoldberg@home.com>

	s/Sheet::cursor::edit_pos/Sheet::edit_pos/

	* src/gnumeric-sheet.c (gnumeric_sheet_new) : No need to pass in the
	  col/row items.  They are available from the sheet control.

	* src/sheet-control-gui.c (sheet_view_construct) : signature change to
	  gnumeric_sheet_new.

2000-12-15  Jody Goldberg <jgoldberg@home.com>

	Tidy up the naming scheme a bit.
	s/row_col/colrow/
	s/col_row/colrow/
	s/SheetSelection/Range/

	* src/workbook-cmd-format.c (workbook_cmd_resize_selected_colrow) :
	  Merged from workbook_cmd_format_column_width and.
	  & workbook_cmd_format_row_height

	* src/item-bar.c (item_bar_end_resize) : Call scg_colrow_size_set
	  directly.
	(item_bar_class_init) : remove the SIZE_CHANGED signal.

	* src/selection.c (sheet_selection_full_cols_rows) : merge
	  sheet_selection_full_cols & sheet_selection_full_rows.

2000-12-14  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw) : Move the span handling here.
	* src/cell-draw.c (cell_draw) : from here.

	* src/print-cell.c (print_cell_range) : Move the span handling here.
	(print_cell) : rather than here.

	* src/sheet-control-gui.c (scg_get_distance) : merge
	  sheet_{row,col}_distance_get_pixels and make the result sheet
	  control specific.

2000-12-14  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_convert_expr_to_value) : rename from cell_make_value.

	* src/format.c (format_number) : adjust signature to take the
	  colwidth in preparation for supporting
	(format_value) : pass in the width.

2000-12-14  Jody Goldberg <jgoldberg@home.com>

	* src/formats.c (currency_date_format_init) : correctly place currency
	  before or after the value, and optionally include a space.

	* src/format.c (format_get_currency) : include info on currency
	  placement.

2000-12-14  Jody Goldberg <jgoldberg@home.com>

	* src/workbook.c (workbook_sheet_rename) : Handle renames that only
	  change case more smoothly.

2000-12-14  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Gussy up the reporting to improve readability

2000-12-14  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object-bonobo.c (sheet_object_bonobo_construct) : create
	  the client site here.
	(sheet_object_bonobo_set_object_iid) : rather than here.

2000-12-14  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-util.c (gnumeric_entry_at_subexpr_boundary_p) :
	  Add ')' bug 35149

2000-12-11  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-math.c (gnumeric_round): Apply patch from
 	hans@snow.nl, see bug 34844.

	* src/functions/fn-math.c (help_int): fix bogus docs for negative
 	arguments.

	* configure.in: clean up quote stuff.

2000-12-10  Morten Welinder  <terra@diku.dk>

	* configure.in: first cut at improved version checks for required
	packages.

2000-12-10  Jody Goldberg <jgoldberg@home.com>

	* src/expr-name.c (expr_name_invalidate_refs_sheet) : comment out
 	  the warning.  The life cycles of names are too fluid to scare
 	  users yet.
	(expr_name_invalidate_refs_wb) : Ditto.

2000-12-10  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_set_text) : send the current format to the
	  number matcher.
	* src/sheet.c (sheet_cell_set_text) : Ditto.

	* src/parse-util.c (parse_text_value_or_expr) : send the current
	  format to the number matcher.

	* src/number-match.c (format_match) : take the current format as a
 	  parameter.  Begin using it to handle cells formated as text.

	* src/format.c (style_format_is_text)  utility routine.

2000-12-09  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (sheet_selection_set_internal) : rename from
 	  sheet_selection_set and add the 'just_add_it' flag to indicate
 	  that we don't need to do anything fancy.

2000-12-09  Chema Celorio  <chema@celorio.com>

	* src/xml-io.c (xml_write_names): Always write a <Names> node,
	even if it is empty.  (See comment in code for details)

	* src/sheet.c (sheet_new): make sheet->names NULL.
	(sheet_clone_names): free the list with g_list_free not g_free
	(sheet_clone_names): add a warning about not duplicating
	names yet.

	* src/expr-name.h (expr_name_wb2sheet): add prototypes for
	wb2sheet & sheet2wb

	* src/expr-name.c (expr_name_unlink): new funct. Code from
 	expr_name_remove
	(expr_name_remove): call expr_name_unlink
	(expr_name_invalidate_refs_name): add a warning about this
 	function not being implemented
	(expr_name_invalidate_refs_sheet): ditto
	(expr_name_invalidate_refs_wb): ditto
	(expr_name_sheet2wb): new funct. changed the scope of a
 	NamedExpression from sheet to workbook.
	(expr_name_wb2sheet): not implemented yet. Workbook to sheet scope
 	change

2000-12-09  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c (scg_comment_display) : Always clear the
	  timer.

	* src/gnumeric-util.c (gnumeric_entry_at_subexpr_boundary_p)
	: Add '<' '>'.  Bug 34642

2000-12-09  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_construct) : delete.
	(sheet_object_set_bounds) : Delete.
	(sheet_object_set_sheet) : new function.
	(sheet_object_clear_sheet) : new function.
	(sheet_object_read_xml) : implement.
	(sheet_object_write_xml) : implement.
	(sheet_object_range_get) : support setting the range without a having
	  a sheet.
	(sheet_relocate_objects) : Use set_sheet & clear_sheet.
	(sheet_object_register) : new function.

	* src/sheet-object-widget.c (sheet_widget_checkbox_set_sheet) : new
	  function.  we need to move the dependent into the new sheet.
	(sheet_widget_checkbox_clear_sheet) :  ditto.

	* src/sheet-object-graphic.c : (sheet_object_graphic_{read,write)_xml) :
	  new functions.
	(sheet_object_filled_{read,write)_xml) : new functions.

	* src/sheet-object-container.c (view_activated_cb) : no more
	  sheet_object_construct.

	* src/sheet-object-cell-comment.c (cell_comment_{read,write)_xml) :
	  new functions.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_{read,write)_xml) :
	  New functions.  These need work.  the 'read_fn' and 'write_fn' do
	  not merge nicely yet.

	* src/main.c (gnumeric_main) : Register the sheet object types.
	  We need this until the plugin scheme is ready.

	* src/item-grid.c (cb_obj_create_button_release) : Use set_sheet
	  rather than realize.

	* src/bonobo-io.c (gnumeric_bonobo_obj_write) : constness.

2000-12-08  Jody Goldberg <jgoldberg@home.com>

	From :Ade Lovett <ade@FreeBSD.org>
	* templates/english/Makefile.am : typo.
	* idl/Makefile.am : Ditto.

2000-12-08  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_write_xml) : protect from missing
	  virtual.
	(sheet_object_read_xml) : Ditto.

2000-12-07  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Bump the version number

2000-12-07  Jody Goldberg <jgoldberg@home.com>

        * Release 0.60

2000-12-07  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c : Disable canvas grab debug.
	* src/item-cursor.c : Ditto.
	* src/item-bar.c : Ditto.
	* src/sheet-control-gui.c : Ditto.

2000-12-07  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c (scg_context_menu) : Use more of the new
	  artwork.

2000-12-07  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (cellrange_relocate) : disable the relocating the partner
	  for forced partial relocation.

2000-12-07  Jody Goldberg <jgoldberg@home.com>

	* src/application.c (application_init) : Add some new icons

	* src/gnumeric.xml : Use the new icons
	* src/workbook-control-gui.c : Ditto
	* src/workbook-format-toolbar.c : Ditto.

2000-12-07  Jody Goldberg <jgoldberg@home.com>

	* src/mstyle.c (mstyle_hash) : add indent.
	(mstyle_element_equal) : Ditto.
	(mstyle_new_default) : Ditto.
	(mstyle_[gs]et_orientation) : new functions.

2000-12-06  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Update GAL req.

2000-12-06  Jon K Hellan  <hellan@acm.org>

	* src/file.c (set_ok): Rename to handle_ok. Make it check if
	current file selection is a directory. If so, change to the
	directory and continue selecting file.

2000-12-05  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_region_adjacent_merge) : new function.

	* src/cellspan.c (cell_calc_span) : Use it here to pre bound the
	  potential span region.

2000-12-05  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw_merged_range) : Draw borders too.
	  This can easily be optimized.

	* src/selection.c (sheet_selection_add_range) : Use
	  sheet_selection_set.

2000-12-05  Morten Welinder  <terra@diku.dk>

	* src/sheet-object.c (sheet_object_realize): Check that the sheet
 	object belongs to a valid sheet.

2000-12-05  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (wbcg_zoom_feedback) : Move the bounding
	  box if the zoom changes.

2000-12-04  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-view.c (wb_view_sheet_focus) : Init the selection
	  descriptor and format format.
	(wb_view_selection_desc) : new function.
	(workbook_view_init) : Init the expression and format before setting
	  the current sheet.  Setting the sheet will update the content.

	* src/workbook-control.c (wb_control_sheet_add) : Init the format,
	  edit line, and selection descriptor.

	* src/selection.c (sheet_get_selection_name) : Delete.
	(sheet_selection_extend_to) : Use wb_view_selection_desc.

	* src/gnumeric-sheet.c (gnumeric_sheet_key_release) : Use
	  wb_view_selection_desc.
	* src/item-grid.c (item_grid_event) : Ditto.

2000-12-05  Michael Meeks  <michael@helixcode.com>

	* src/main.c (gnumeric_main): do the bonobo activate before we
	start doing CORBA calls and bonobo stuff!

	* src/embeddable-grid.c: Fixup for the generic factory.

2000-12-04  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-view.c (wb_view_edit_line_set) : renamed from
	  workbook_edit_load_value and tweaked to operate on the view level.

	* src/workbook-edit.c (workbook_finish_editing) : Adjust to changes in
	  edit-line update api.

	* src/sheet.c (sheet_update) : Use wb_view_edit_line_set.

	* src/workbook-view.c (wb_view_sheet_focus) : bug 34185.

2000-12-04  Morten Welinder  <terra@diku.dk>

	* src/mstyle.c (mstyle_hash): Don't shift all the hash information
 	away.  Rotate, don't shift.

	* src/mathfunc.c: white-space mania.

	* src/item-bar.c: Make debug-code statement-safe, just in case.
	* src/item-cursor.c: Ditto.
	* src/item-grid.c: Ditto.
	* src/sheet-control-gui.c: Ditto.

	* src/sheet-object-widget.c (sheet_widget_checkbox_user_config):
 	Plug leak.

	* src/number-match.c (print_regex_error): Print error code
 	numerically if our switch does not catch it.  Catch REG_EBOL and
 	REG_EEOL.  Print errors to stderr.
	(format_match_define): Change result type to gboolean.  Plug leak.
	(format_create_regexp): Properly regexp-quote quoted
 	format-strings.

2000-12-04  Zbigniew Chyla  <cyba@gnome.pl>

	* src/sheet-object-widget.c (sheet_widget_checkbox_toggled): calling
	workbook_recalc() after setting cell value based on checkbox state.

2000-12-04  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_relocate_objects) : Remember to move the
	  object to the new sheet, not just the views.
	(sheet_object_position) : Off by one.  Use < not <=

2000-12-04  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_{insert,delete}_{cols,rows}) : Call
	  sheet_relocate_objects.
	(sheet_move_range) : Ditto.

	* src/sheet-object.c (sheet_object_unrealize) : restore this routine.
	(sheet_object_destroy) : Use it here.
	(sheet_object_position) : renamed from sheet_object_reposition.
	(sheet_relocate_objects) : new routine.  Only handles current anchor
	  format.  Will need to extend this.

	* src/item-bar.c (item_bar_event) : Exit object edit mode when a
	  button presses on the itembar.

2000-12-02  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (cellrange_relocate) : Still not doing the 'right' thing
	  in all cases.   However at least it will no longer create broken
	  references.
	(cellref_relocate) : tweak a bit.

2000-12-01  Michael Meeks  <michael@helixcode.com>

	* configure.in: check for gb >= 0.0.17

2000-12-02  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (cellrange_relocate) : fix the logic that was broken when
	  supporting the partial ranges.
	(cellref_relocate) : move some of the code here, to decrease
	  replication.

2000-12-02  Jody Goldberg <jgoldberg@home.com>

	* src/item-bar.c : Add some debug macros to catch the magic helix
	  cursor grab.
	* src/item-cursor.c : Ditto.
	* src/item-grid.c : Ditto.
	* src/sheet-control-gui.c : Ditto.

2000-12-01  Jody Goldberg <jgoldberg@home.com>

	* src/functions/fn-lookup.c (gnumeric_hlookup) : fix cut-n-paste-o.

2000-12-01  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_drag_event) : Ignore press events fro
	  drag cursors.  And ignore release events for buttons other than the
	  one that started the drag.
	s/prepared_to_drag/drag_button/
	(item_cursor_set_arg) : Add 'Button' arg
	(item_cursor_class_init) : Ditto.

2000-12-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c (scg_object_stop_editing) : fix warning.
	  this is static now.

2000-12-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_position_pts) : new function.
	(sheet_object_position_pixels) : new function.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c : Begin moving the sheet object xml io into virtuals.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c : Add SHEET_FOREACH_CONTROL to help abstract the
	  implementation of controls and simplify changes later.
	(sheet_set_zoom_factor) : reposition objects not just comments.
	(sheet_get_objects) : New function.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c : Move most (not yet all) of the GUI aspects into
	  the sheet control.  Revamp the semantics of the sheet-object
	  virtuals.
	new_view : now handles the sizing and realizing of objects.
	Add support for persistance here.
	Delete get/set bound.

	* src/sheet-object-container.c : convert to new object management design
	* src/sheet-object-graphic.c : Ditto.
	* src/sheet-object-item.c : Ditto.
	* src/sheet-object-widget.c : Ditto.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_construct) :
	  sheet_object_construct now takes a default size.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c : Move cell comment and sheet object
	  placement routines here.  Rather than scattering them in non-gui
	  modules.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/print.c (print_object_view_position) : Convert object position
	  to points.

	* src/selection.c (sheet_selection_redraw) : simplify.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-sheet.c (gnumeric_sheet_key_mode_object) : SheetObject
	  editing is now specific to the SheetControl.
	(gnumeric_sheet_key_press) : Ditto.
	(gnumeric_sheet_key_release) : Ditto.

	* src/selection.c (sheet_is_cell_selected) : Ditto.
	(sheet_col_selection_type) : Ditto.
	(sheet_row_selection_type) : Ditto.

	* src/item-bar.c (item_bar_draw) : Ditto.

	* src/item-grid.c (item_grid_draw_background) : Ditto.
	(item_grid_button_1) : Ditto.
	(item_grid_event) : Ditto.
	(cb_obj_create_motion) : Move the object creation GUI here.
	(cb_obj_create_button_release) : and add partial support for
	  autoscroll.
	(sheet_object_begin_creation) : Ditto.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_copy) : Comments are no longer associated directly
	  with cells.
	* src/clipboard.c (paste_cell) : Ditto.
	(clipboard_release) : Ditto.

	* src/bonobo-io.c (gnumeric_bonobo_obj_read) : No need to set bounds
	  or realize the object here.  That is handed at a higher level.

2000-11-30  Jody Goldberg <jgoldberg@home.com>

	* src/number-match.c (compute_value) : Use strtol to simplify things.

	* src/func.c (tokenized_help_new) : translate the help text.

2000-11-27  Jody Goldberg <jgoldberg@home.com>

	* src/formats.c (currency_date_format_init) : quote the currency
	  names.

2000-11-30  Almer S. Tigelaar  <almer1@dds.nl>

	* src/preview-grid-controller.c (preview_grid_controller_new) :
	Make the selection rectangle fatter and position it slightly better.

2000-11-29  Morten Welinder  <terra@diku.dk>

	* src/xml-io.c (xml_sheet_write): Initialise closure's rle_count
 	member.
	(natural_order_cmp): Fix major brown-bag in ordering.

2000-11-27  Morten Welinder  <terra@diku.dk>

	* src/analysis-tools.c (anova_single_factor_tool): Apply the rest
 	of Christensens' patch.

2000-11-27  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-view.c (workbook_view_init) : Init the format feedback.
	  But don't bother displaying.  We don't have any controls yet.

	* configure.in (have_gda) : init to false.

2000-11-27  Michael Meeks  <michael@helixcode.com>

	* src/embeddable-grid.c (EmbeddableGridFactory_init): upd.

	* Makefile.am (oaf_DATA): upd to GNOME_Gnumeric.oafinfo

	* GNOME_Gnumeric.oafinfo: upd.

2000-11-24  Jon K Hellan  <hellan@acm.org>

	* src/file.c (do_save_as): Remember name with extension, so
	subsequent saves are done to the correct file.

	* src/workbook.c (workbook_set_saveinfo): Remove redundant setting
	of title.

2000-11-24  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell) : bubble the sizing code further up.
	  src/cell-draw.c (cell_draw) : ditto.  Move towards a better api that
	  will pass in the bounding box rather than all the parameters needed
	  to generate it in different circumstances.

2000-11-23  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell) : until printing of the grid is synced
	  with drawing a grid, disable the tests for width, height.

	* src/expr.c (cellrange_relocate) : Use simple heuristic to help
	  diffentiate the 'expected' behavior of  moving expressions with
	  range references that are partially contained.

2000-11-22  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-math.c (gnumeric_sumx2py2): Plug leaks.
	(gnumeric_sumxmy2): Plug leaks.
	(gnumeric_sumx2my2): Plug leaks.

2000-11-22  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dialogs/dialog-plugin-manager.c (refresh_right_frame):
	Replaced ctime() with strftime() to display translated form of
	plugin modification date.

	* src/item-bar.c (colrow_tip_setlabel): Translated (Polish)
 	version of string doesn't fit within "buffer". Dropped static
 	array and used dynamic memory allocation (g_strdup_printf).
	(vertical_scroll_change, horizontal_scroll_change): It fits with
 	Polish translation but code is similar to the above.

2000-11-22  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dialogs/summary.glade: Centered "Document Summary
	Information" label.

2000-11-21  Morten Welinder  <terra@diku.dk>

	* src/sheet.c (sheet_new_sheet_view): Remove spurious ref.

	* src/stf-parse.c (stf_parse_get_colwidth): Don't overrun buffer.

2000-11-20  Morten Welinder  <terra@diku.dk>

	* src/gutils.c (gnumeric_usr_dir): Use g_get_home_dir, not just
 	$HOME.  Don't return duplicate slashes.

	* src/commands.c (cmd_resize_row_col_redo): Proper undo sizing.
	(cmd_sort_redo): Ditto.
	(cmd_hide_selection_rows_cols): Ditto.
	(cmd_autofill_redo): Ditto.

	* gnumeric.spec.in (gal): Require 0.2.99.

	* configure.in (gal): Require 0.2.99 (and fix check).

	* src/workbook-control-gui.c (workbook_control_gui_ctor_class):
 	Set undo_redo.truncate.
	(wbcg_undo_redo_truncate): New function.

	* src/commands.c (command_push_undo): truncate undo information.
	(truncate_undo_info): New function.
	(cmd_format): Properly size undo information.

2000-11-20  Jody Goldberg <jgoldberg@home.com>

	* src/colrow.c (col_row_get_index_list) : Take away my crack pipe.

2000-11-20  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Use a more conventional approach to path seperators.
	* src/gutils.c (gnumeric_usr_dir) : Adjust here.
	(gnumeric_sys_data_dir) : and here.
	(gnumeric_sys_lib_dir) : and here.

2000-11-20  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_clone_selection) : Fix.

	* src/item-grid.c (item_grid_draw_merged_range) : If the merged region
	  is fully selected paint it as such.

	* src/selection.c (sheet_is_full_range_selected) : new function.
	(sheet_selection_set) : support merged cells.

2000-11-20  Morten Welinder  <terra@diku.dk>

	* src/sheet.c (sheet_destroy_contents): Eliminate merged regions.
	(sheet_destroy): Free data structures for merged regions.
	(sheet_new): Activate temporary debugging code on
 	GNUMERIC_DEBUG_MERGE in environment.

2000-11-19  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_region_is_merge_cell) :
	(sheet_region_get_merged) :
	(sheet_region_unmerge) :
	(sheet_region_merge) : implement.

2000-11-19  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw_merged_range) : new function.
	  This may be clearer if we draw the grid lines after the background.
	  It does not support borders or selection yet.
	(item_grid_draw) : Use it.

2000-11-19  Jody Goldberg <jgoldberg@home.com>

	* src/cellspan.c (cell_is_empty) : new utility function.
	  span calculation is now rather inefficent.  We could be smarter if
	  we had a better representation of spans.  For now adding support for
	  merged cells here would be enough.
	(cell_calc_span) : Use it.

	* src/cell-draw.c (cell_draw) : decrease dependence on
	  Cell::{col,row})_info::size_pixels.  This is not accurate for merged
	  cells.  More work is needed.  I have not converted the multiline
	  formating yet.  The signature of this function sucks.
	  We should pass in either span or width height, not both.

	* src/print-cell.c (print_cell) : Stay consistent with cell_draw.
	  NOTE : I have not ported over the merged cell support.  It seems
	  pointless until it is working completely for drawing.

2000-11-19  Jody Goldberg <jgoldberg@home.com>

	* s/sheet_view/scg/

	* src/formats.c (currency_symbols) : Add the slovenian tolar.

2000-11-16  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-control-gui.c (scg_context_menu) : renamed from
	  item_grid_popoup_menu and moved here where it makes more sense.

	* src/sheet.c (sheet_merge_region) : implement.
	(sheet_unnmerge_region) : Ditto.
	(sheet_get_merged_regions) : Ditto.

2000-11-18  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Bump to 0.60 post release
	* NEWS : ditto

2000-11-18  Jody Goldberg <jgoldberg@home.com>

	* Release 0.59

2000-11-18  Jody Goldberg <jgoldberg@home.com>

	* src/command-context-corba.c (command_context_corba_new) : warning
	  suppression.

	* src/workbook-control-gui.c (workbook_control_gui_ctor_class) : Init
	  progress_set in CommandContextClass, and add support for
	  splits_array at this level.

	* src/command-context.c (gnumeric_error_splits_array) : The decision
	  to use invalid should be done in the implementation.

	* src/workbook-control.c (wb_control_progress_set) : delete replicated
	  function.

2000-11-17  Chema Celoria  <chema@celorio.com>

	* src/print.c (sheet_print): change to a g_return_val_if_fail
	by gmorten's request

2000-11-17  Chema Celorio  <chema@celorio.com>

	* src/print.c (sheet_print): if gnome-print dialog is NULL,
	return. This avoids a crash if there aren't any printers installed.

2000-11-17  Almer S. Tigelaar  <almer1@dds.nl>

	* src/preview-grid-controller.c, src/preview-grid-controller.h
	(preview_grid_controller_new) : Extra selected parameters,
	if set a red rectangle will be drawn over the preview to indicate
	the selected state.

	* src/dialogs/dialog-autoformat.c (previews_load): Adjust so
	the selected preview will be drawn in selected state.

2000-11-16  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (format_month_before_day) : Add config test.
	* configure.in : Implement test here.
	* config.h.in : and here.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_update_only_grid) : split from sheet_update.
	(sheet_update) : call sheet_update_only_grid.

2000-11-16  Michael Meeks  <michael@helixcode.com>

	* src/xml-io.h: add xmlmemory.h

	* src/gui-clipboard.c (x_selection_handler): xmlFree
	not g_free.

2000-11-16  Morten Welinder  <terra@diku.dk>

	* plugins/Makefile.am (GDA_DIR): Blank.

2000-11-16  Zbigniew Chyla  <cyba@gnome.pl>

	* src/sheet-autofill.c: Added support for boolean values (just copy
	them).

2000-11-16  Rodrigo Moya <rodrigo@linuxave.net>

	* configure.in: added support for conditional compilation of
	the GDA (GNOME-DB) plugin
	* plugins/gda/*: updated to current GDA code. Does not compile
	yet though

2000-11-16  Zbigniew Chyla  <cyba@gnome.pl>

	* src/selection.c, src/dialogs/dialog-cell-sort.c: Marked strings
	for translation.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control.c (workbook_control_set_view) : Follow
	  convention that the manager is set when attached, and not before.
	* src/workbook-view.c (wb_view_attach_control) : Ditto.  Set the
	  tile on the new control.
	* src/workbook.c (workbook_attach_view) : Ditto.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	* src/command-context-corba.[ch] : This is incorrectly named and used
	  the wrong way :-( But at least it is compilable.  I'll fix this
	  later.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	* src/colrow.c (col_row_foreach) : Use ColRowSegments
	(col_row_restore_sizes) : Ditto.
	* src/sheet.c (sheet_{col,row}_add) : Ditto.
	(sheet_{col,row}_get_info) : Ditto.
	(sheet_{col,row}_get) : Ditto.
	(sheet_cell_foreach_range) : Ditto.
	(sheet_{col,row}_destroy) : Ditto.
	(sheet_regen_adjacent_spans) : Ditto.
	(colrow_move) : Ditto.
	(sheet_{col,row}_get_distance_pixels) : Ditto.
	(sheet_{col,row}_get_distance_pts) : Ditto.
	(sheet_{col,row}_set_size_pts) : Ditto.

2000-11-15  Jody Goldberg <jgoldberg@home.com>

	s/sheet-view/sheet-control-gui/

	* src/Makefile.am : Add command-context-corba.[ch] temporarily

	* configure.in : Default to non-bonobo build

2000-11-15  Michael Meeks  <michael@helixcode.com>

	* gnumeric.oafinfo: rename to ObjectFactory

2000-11-54  John Gotts  <jgotts@linuxsavvy.com>

	* gnumeric.spec.in: Create a devel RPM.  Added some missing files.
	Made the build work from either a tar file or CVS.

2000-11-14  Almer S. Tigelaar  <almer1@dds.nl>

	* src/io-context.h, src/io-context.c
	(gnumeric_io_progress_set): New function, calls
	upon gnumeric_progress_set to do the job.

2000-11-14  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c : Fix warning.

2000-11-13  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Bump to 0.59 post release.

2000-11-13  Jody Goldberg <jgoldberg@home.com>

        * Release 0.58

2000-11-13  JP Rosevear  <jpr@helixcode.com>

	* src/functions/fn-lookup.c (find_bound_walk): Only reverse
	direction if we haven't already switched direction once.
	Fixes bug #2872

2000-11-13  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-format-toolbar.c (workbook_feedback_set) : Doh!

2000-11-13  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-graph-guru.c (graph_guru_create_vectors_from_range) :
	  small improvement to vector selection heuristics.

2000-11-12  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_new_view) : Make public.

	* src/workbook-control-gui.c (wbcg_sheet_add) : Create views of all
	  sheet objects.

2000-11-12  Almer S. Tigelaar  <almer1@dds.nl>

	* src/stf-export.c (stf_export_sheet): Use sheet_get_extent
	instead of sheet->rows and sheet->cols.

2000-11-12  Jody Goldberg <jgoldberg@home.com>

	* src/workbook.c (workbook_sheet_attach) : Use wb_view_sheet_add.

	* src/workbook-view.c (wb_view_sheet_add) : new function.
	(wb_view_format_feedback) : Ditto.
	(wb_view_auto_expr) : Store the display result.
	(wb_view_auto_expr_value_display) : renamed
	  from wb_view_auto_expr_value_set.
	(wb_view_destroy) : clear out the new members.

	* src/workbook-format-toolbar.c (workbook_feedback_set) : Calculate
	  the style here.  This is transitory.  It will eventually move into
	  the sheet view when that is split.

	* src/workbook-control.c (wb_control_sheet_add) : Do this manually
	  so that if the new sheet is the focus sheet for the view we can
	  update the various feedback mechanisms.
	(workbook_control_sheets_init) : rather than here.

	* src/sheet.c (sheet_update) : prepare for having the wb_view handle
	  the selection.

	* src/Makefile.am : Add missing workbook-control.h

	* src/workbook-view.c (wb_view_auto_expr) : When the expression
	  changes, recalculate.

	* src/workbook-control-gui.c (wbcg_auto_expr_value) : Mark as updating
	  the ui.
	(cb_auto_expr_changed) : test the updating flag here, don't set it.

2000-11-11  Michael Meeks  <michael@helixcode.com>

	* src/bonobo-io.c (gnumeric_bonobo_obj_write),
	(write_stream_to_storage): update unref fns.
	(read_stream_from_storage): upd.
	(gnumeric_bonobo_obj_read): set the bounds correctly.

	* src/xml-io.c (xml_write_sheet_object): NULL the sheet object
	we free.

2000-11-11  Michael Meeks  <michael@helixcode.com>

	* src/clipboard.c (apply_paste_oper_to_values): kill warning.

	* src/xml-io-autoft.c: remove stale enum.

	* src/xml-io.c (xml_check_version): publicized.
	(xml_parse_ctx_new_full): add version parameter.
	(xml_parse_ctx_new): update.

	* src/bonobo-io.c (gnumeric_bonobo_read_workbook): use
	xml_check_version.

	* src/bonobo-io.c (gnumeric_bonobo_write_workbook): open the
	stream with the correct permissions.
	(gnumeric_bonobo_io_probe): update to like directories too.
	(gnumeric_bonobo_io_init): register for '.efs'
	(gnumeric_bonobo_read_workbook): beef up exception reporting.

2000-11-11  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml: fiddle, lots of strange mangling, needs HEAD
	bonobo to look at all good.

	* src/xml-io.c (xml_write_sheet_object): free the node nicely in
	the failure case.

2000-11-11  Michael Meeks  <michael@helixcode.com>

	* configure.in (LIBS): add gnome-config --cflags idl to the default
	IDL_FLAGS.

2000-11-11  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c : Fix typos in the accelerator selections
	  for the name menu.

	* src/gnumeric.xml : Add entries for new shared/unshared views.

	* src/style.c (font_init) : Use the correct scale.

	* src/value.c (value_get_default_halign) : Renamed and moved from here
	* src/cell.c (cell_default_halign) : to here.  Added support for
	  displaying formulas.

	* src/print-cell.c (print_cell) : only draw hash marks for numbers
	  not when displaying formulas.
	* src/cell-draw.c (cell_draw) : Ditto.
	* src/cellspan.c (cell_calc_span) : Ditto.
	* src/rendered-value.c (rendered_value_calc_size_ext) : Ditto.

2000-11-11  Jody Goldberg <jgoldberg@home.com>

	Patch from Tyler & James Christensen
	* src/analysis-tools.c (anova_single_factor_tool) : Correct handling
	  of variables stored in rows rather than columns.

2000-11-11  Zbigniew Chyla  <cyba@gnome.pl>

	* src/dependent.c (dependent_list_filter): Correct "for" loop
	condition.

2000-11-10  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_new_view) : Store the SheetObject
	  and SheetView as object_data.
	(cb_sheet_object_configure) : Pass the SheetView to configuration
	  routines.
	(sheet_object_populate_menu) : Pass the CanvasItem it has the useful
	  property of having the associated view and sheet object as user data.
	  This makes it handy for use in callbacks.
	(display_object_menu) : signature change.
	(control_point_handle_event) : changes to display_menu_object.
	(sheet_object_canvas_event) : Ditto.

	* src/sheet-object-widget.c (sheet_widget_checkbox_user_config) :
	  signature change.  This should get things working again.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_populate_menu) :
	  signature change.

2000-11-10  Jody Goldberg <jgoldberg@home.com>
      Patch from Juan Pablo Mendoza <pablo_juan@yahoo.com>

      * sheet-view.c (sheet_view_comment_create_marke): Memory leak.

2000-11-10  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-format-toolbar.c (workbook_format_toolbutton_update) :
	  Minor optimization to decrease flicker.

	* src/sheet.c (sheet_cell_calc_span) : Clarify the semantics of
	  the various flags.
	(cb_max_cell_width) : If the value used a dynamic format we need to
	  rerender ignoring the current width.

	* src/rendered-value.c (rendered_value_new) : renamed from
	  rendered_value_new_ext and delete the old rendered_value_new.
	  Extend slightly to flag whether or not to handle dynamic formats.

	* src/render-ascii.c (cell_region_render_ascii) : Handle the style
	  lookup localy.

	* src/cell.c (cell_eval_content) : We need to manually render
	  the value here, but no longer need to calculate the size
	  seperately.  That is done automatically in the render.
	(cell_render_value) : Handle style localy, and calculate the size.

2000-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (workbook_control_gui_init) : move the
	  autosave code here.
	* src/workbook.c : from here.

2000-11-09  Morten Welinder  <terra@diku.dk>

	* src/border.c (style_border_unref): Take border out of hash table
 	before we destroy the hashed fields.

2000-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-view.c (workbook_view_init) : Add prototype.

	* src/workbook-control-gui.c (cb_sheet_change_name) : Make static to
	  kill warning.
	* src/workbook-edit.c (workbook_edit_set_sensitive) : Ditto.

2000-11-09  Morten Welinder  <terra@diku.dk>

	* src/gnumeric-sheet.h (GNUMERIC_SHEET_FACTOR_X,
 	GNUMERIC_SHEET_FACTOR_Y): 1000000 and 2000000.  Still ugly, but
 	now central.

	* src/sheet-view.c (sheet_view_set_zoom_factor): Don't hard-code
 	scroll region sizes multiple places.

	* src/gnumeric-sheet.c (gnumeric_sheet_new): Ditto.

	* src/sheet-control.c (sheet_control_set_zoom_factor): Ditto.

	* src/sheet.h (SHEET_MAX_ROWS, SHEET_MAX_COLS): Remove duplicate
 	macros.

2000-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/stf.c (stf_read_workbook) : We are passing an IOContext.

2000-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_selection_event) : Make
	  the double click handler smarter.  It now handles empties
	  and checks both sides of a row/col.  Left/top is perfered to
	  bottom/right.

2000-11-08  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_init) : Initialize fully, add
	  prepared_to_drag_flag.
	(item_cursor_selection_event) : Move most of the state change
	  associated with BUTTON_PRESS into MOTION_NOTIFY.  And use the
	  prepared_to_drag_flag flag to indicate a requirement to initiate a
	  drag. Move most of the double click handling here.  The resone for
	  these changes was that there was a race condition in the old
	  version.  We were creating a new item cursor when we did a button
	  press.  It started in exactly the same position as the current
	  cursor.  2BUTTON_PRESS were sometimes being sent to the new cusor
	  and sometimes showing up as PRESS events on the old with no RELEASE.
	  This patch attempts to delay creating the new drag cursor until we
	  are sure this is not a double click so that the proper event
	  sequence is sent to the main cursor.

	* src/border.c (style_border_unref) : Unref the colour.
	(style_border_fetch) : unref the colour when needed.

2000-11-08  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_is_region_empty) : New function.

2000-11-08  Morten Welinder  <terra@diku.dk>

	* src/complex.c (complex_from_string): Handle overflow.

	* src/number-match.c (format_match_simple): Don't depend on
 	incoming errno not to be ERANGE.

	* src/sheet-autofill.c (string_has_number): Ditto.

	* src/parser.y (yylex): Ditto.

	* src/value.c (value_new_from_string): Ditto.  Also take care of
 	empty string.

2000-11-08  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (apply_paste_oper_to_values) : Rewrite to use
	  eval_expr.
	(paste_cell_with_operation) : rework to handle pasting as_value
	  correctly.
	(paste_link) : This is broken.  FIXME.
	(paste_cell) : Move the check for pasting content or as_value to the
	  top.

	* src/cell.c (cell_make_value) : Unlink expressions if necessary.

	* src/sheet.c (sheet_cell_set_expr) : flag that content changed.

	* src/dependent.c (dependent_queue_recalc_list) : Add some safety.

	* src/item-cursor.c (item_cursor_event) : clicking on an anted cursor
	  is almost the same as clicking on a selection cursor.

	* src/expr-name.c (expr_name_add) : It is legal to add names that are
	  available in other scopes as long as the new scope does not contiain
	  the name.

2000-11-06  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-autofill.c (autofill_cell) : Use cell_set_value directly.
	  No need to do depends or respaning for each cell.

	* src/commands.c (cmd_autofill_redo) : When we can do it here, for the
	  entire range.
	(cmd_area_set_text_redo) : Add the missing depend update here.

	* src/sheet.c (sheet_cell_set_value) : Render if required.

2000-11-06  Almer S. Tigelaar  <almer1@dds.nl>

	* src/gui-clipboard.c:
	(x_selection_to_cell_region): Make error message more descriptive.

	* src/stf.c:
	(stf_read_workbook): Ditto.

2000-11-06  Almer S. Tigelaar  <almer1@dds.nl>

	Fix bug #21674. (Fix will kick in once the version number of the
	XML format is bumped to GNUM_XML_V5)

	* src/print-info.c (print_info_new): Add extra commenting.

	* src/xml-io.c:
	(xml_write_print_repeat_range): New function, for saving a repeat range.
	(xml_read_print_repeat_range): New function, for loading a repeat range.
	(xml_write_print_info): Save the row repeat and col repeat range using
	xml_write_print_repeat_range.
	(xml_read_print_info): Read col and row repeat range if file format
	version > GNUM_XML_V4 using xml_read_print_repeat_range.

2000-11-06  Jody Goldberg <jgoldberg@home.com>

	* src/workbook.c (workbook_sheet_detach) : remove unused parm.
	  Be more paranoid about focus handling.

	* configure.in : fix typo.

2000-11-05  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (cb_set_cell_content) : Use cell_set_value.
	(sheet_range_set_text) : remove need for entered_text.

	* src/xml-io.c (xml_read_cell) : Remove 'General' hack.

	* src/dialogs/dialog-cell-format.c (draw_format_preview) : remove
	  entered_text.

	* src/rendered-value.c (rendered_value_new_ext) : No need for
	  entered_text.  Use format_value in place of value_as_string.

	* src/format.c (format_value) : No need for entered_text.
	  Be careful to always set the colour.  This may need to be tuned
	  if we enter '$10' and use a display format of @ what should be
	  displayed ?  10 or $10 ?  We may need to pass in the parse format.

	* src/cell.c (cell_cleanout) : Remove entered_text.
	(cell_copy) : Ditto.
	(cell_set_text) : Ditto.
	(cell_set_value) : Ditto, do not render value here.
	(cell_set_text_and_value) : Delete.
	(cell_set_expr_and_value) : Remove entered_text, and add format
	  argument.
	(cell_set_expr_internal) : No need to manually unref the old expr.
	  That was already done in cleanout.
	(cell_make_value) : remove entered_text.

	* src/rendered-value.c (cell_get_entered_text) : Use the stored parse
	  format and format_value to regenerate the entered text from a value.

2000-11-04  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-view.c (sheet_view_{col,row}_size_changed) : Only resize
	  all columns if the column that changed is part of the selection.

	* src/selection.c (sheet_selection_full_{cols, rows}) : flag whether
	  the selection contains the requested col.

2000-11-04  Jody Goldberg <jgoldberg@home.com>

	* src/format-template.c (format_template_apply_to_sheet_regions) : No
	  need to request a redraw.
	(cb_format_sheet_style) : Use sheet_range_apply_style because it
	  requests a redraw and handles respaning/spacing when necessary.

2000-11-03  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_paste_copy_undo) : Clear any operations when
	  storing the undo info for paste_copy.  There is no longer any need
	  for the operations.  We are storing the image.

	* src/clipboard.c (clipboard_prepend_cell) : Be safe and init the
	  comment field.

2000-11-03  Jody Goldberg <jgoldberg@home.com>

	* configure.in : Update the GAL requirement.

2000-11-03  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_paste_region) : Optimize the styles for
	  the entire target region in one swoop, rather than each tile
	  individually.  This fixes the reported problem symptom.  I do not
	  have a definite reason why it was failing before.  This may just be
	  sweeping it under the rug.

	* src/xml-io.c (xml_workbook_write) : Bump the xml version.

	* src/format.c (format_value) : A string value takes precedence over
	  the entered text.

2000-11-03  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/analysis-tools.glade : Rename 'Alpha' to '1 - Alpha'

	* src/complete-sheet.c (text_matches) : Only use values that are strings
	  do not bother with 'entered_text'
	(complete_sheet_search_iteration) : Adjust the calls to text_matches.

	* src/dialogs/dialog-cell-format.c (fmt_dialog_init_format_page) : Be
	  careful to use the non-localized version of the format internally.

	* src/cellspan.c (cell_calc_span) : Ignore hidden columns.

	* src/colrow.c (col_row_set_visibility_list) : regen the spans outside
	  the region which changes visibility.

	* src/sheet.c (sheet_regen_adjacent_spans) : Split this out
	  from sheet_clear_region.

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-autofill.c (string_has_number) : thou shalt not use atoi
	  for it does not check for oeverflow.

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell_range) : Set the printed flag whenever
	  there is a valid cell.

	* src/sheet-autofill.c (autofill_create_fill_items) : Do not look up
	  the cell here.
	(fill_item_new) : lookup the style and cell here.
	(sheet_autofill_dir) : Always apply the style.
	(fill_item_destroy) : release the style.

2000-11-02  JP Rosevear  <jpr@helixcode.com>

	* src/xml-io.c (xml_read_attributes): Don't check for a workbook,
	this is redundant and not even true any more.
	(xml_workbook_read): Only read the attributes if the workbook is
	version 5 or later.

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_new_ext) : Any form of General
	  will need a width.  Default to full precision.

	* src/cell.c (cell_set_value) : Do not assign optional formats of General

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (cb_file_new) : We need to create a
	  control & view.
	(workbook_close_if_user_permits) : Do not attempt to finsihed editing
	  here.  This is called in a loop from cb_file_quit.
	(wbcg_close_control) : stop editing here.
	(cb_file_quit) : and stop editing here before closing and workbooks.
	  While closing workbooks save the calling working for last so than
	  can save the current view rather than guessing and using the first.

2000-11-02  Almer S. Tigelaar  <almer1@dds.nl>

	* src/dialog-autoformat.c:
	(templates_load): Also apply filtering to newly loaded templates.
	(dialog_autoformat): Don't call format_template_apply_to_sheet_regions,
	pushing the undo stuff (cmd_autoformat) already does this anyway.

	* src/format-template.c: Fix bug #30413
	(format_template_range_check): New, checks if the target range
	is wide enough to apply the format template to.
	(format_template_apply_to_sheet_regions): Use format_template_range_check
	to check the ranges. Display an error and abort when a range is invalid.
	(format_template_recalc_hash): Idem, but don't display an error but a
	warning, as no such error is supposed to happen here.

	* src/format-template.c: Fix bug #30419
	(format_template_filter_style): Add COLOR_BACK to pattern filtering.
	(format_template_filter_style): Correct to not always replace
	unset elements with default elements.
	(cb_format_hash_style): call format_template_filter_style with
	default element replacing.
	(cb_format_sheet_style): call format_template_filter_style without
	default element replacing.
	(cb_format_sheet_border): Idem.

2000-11-02  Michael Meeks  <michael@helixcode.com>

	* configure.in: Require bonobo-0.27+

2000-11-02  Michael Meeks <michael@helixcode.com>

	* The big api rename ...

2000-11-02  Michael Meeks  <michael@helixcode.com>

	* configure.in: bump gb requirement to gb-0.0.15

2000-11-02  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_new_sheet_view) : Set the cursor when the sheet
	  is attached.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_clear_redo) : reverse the content list to keep
	  it in sync with the range list.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_read_cell) : Default the parse format to General.
	  Eventually we can simply cell_set_value to not guess that the
	  display format == the parse format.  However, that will require
	  changing all of the importers.  For now we can cheat, and supply
	  General as the format.

	* src/functions/fn-string.c (gnumeric_dollar) : use string_get_nocopy.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (cellref_relocate) : inside is always calculatd based on
	  the source sheet.  eg  Sheet1:A1 = '=A2' and we are moving A1:A2
	  from Sheet1 -> Sheet2.  The reference to A2 should be considered
	  'inside'.  References to Sheet2!A2 have already been #REF!ed.

	* src/commands.c (cmd_paste_cut_redo) : Use range_check_sanity.

	* src/sheet.c (sheet_cell_insert) : Render if necessary.
	(sheet_move_range) : Extra care is only necessary if the source and
	  target sheets are the same.  When they are different we should just
	  invalidate all references to the target range.

2000-11-02  Jon K Hellan  <hellan@acm.org>

	* src/workbook.c (workbook_history_update): Fix test to avoid
	  changing an already correct history.
	(workbook_destroy): Don't free wb->filename until we're through
	  using it.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-sheet.c (selection_insert_selection_string) :
	  Set the position to where we expect it to be.
	(gnumeric_sheet_key_mode_sheet) : Only call sheet_update if we are not editing.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_name_quote) : names with parethesis require quotes.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-edit.c (workbook_finish_editing) : Restore the focus
	  from here.
	* src/workbook-control-gui.c
	(cb_cancel_input, cb_accept_input) : rather than here or here.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* */*.[ch] : s/SheetView::sheet_view/SheetView::canvas/
	  This has been bugging me for months.

	* src/gnumeric-sheet.c (move_cursor) : stop the edit at this level
	  rather than in sheet_cursor_set.
	(gnumeric_sheet_key_mode_sheet) : Use move_cursor.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/ranges.c (range_translate) : Split sanity check into new function.
	(range_check_sanity) : here.

	* src/xml-io.c (xml_read_range) : Use it.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_new) : Be mroe fine grained about the changes to
	  the edit position.
	(sheet_flag_status_update_cell) : Only content and format have changed.
	(sheet_flag_status_update_range) : handle the new flags.
	(sheet_flag_format_update_range) : new function.
	(sheet_update_editpos) : delete and split up.
	(sheet_update) : Do each update seperately. NOTE : this is broken.
	  All of these flags should be at the View level.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (sheet_selection_copy) : pass a workbookcontrol.
	(sheet_selection_cut) : Ditto.

	* src/commands.c (cmd_format_undo) : flag the format change.
	(cmd_format_redo) : Ditto.

	* src/workbook-control.h (wb_control_claim_selection) : new virtual.
	* src/application.c (application_set_selected_sheet) : Used here.
	(application_clipboard_copy) : Take a WorkbookControl.
	(application_clipboard_cut) : Ditto.

	* src/workbook-control-gui.c (wbcg_paste_from_selection) : new
	  function.
	(workbook_control_gui_ctor_class) : register it.

2000-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell_range) : We are only outputing
	  something in the case of a blank cell if the format is visible.

2000-11-01  Almer S. Tigelaar  <almer1@dds.nl>

	* src/dialogs/dialog-stf.glade:
	Beautify dialog.

2000-11-01  Almer S. Tigelaar  <almer1@dds.nl>

	* src/print-cell.c:
	(print_cell_range): Fix #29442, if a cell's background
	is 'printed' this also counts as a 'printed cell'

2000-11-01  Almer S. Tigelaar  <almer1@dds.nl>

	* src/dialogs/dialog-autoformat.c:
	(dialog_autoformat): Kill memory leak, we were not freeing
	the list of acquired selection ranges.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_set_text_undo) : Use sheet_clear_region to
	  ensure that spans get regenerated in neighbouring cells.
	(cmd_set_date_time_undo) : Ditto.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/number-match.c (format_create_regexp) : Fix typo in regexp.
	  Be careful to only match 1 or more digits as a number.

2000-10-31  Morten Welinder  <terra@diku.dk>

	* src/parser.y (unregister_allocation): plug leak.
	("line = error"): deallocate the result, just in case the parser
 	discovers the error after reducing the regular line production.
	(gnumeric_expr_parser): Initialise *parser_result.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/commands.c (cmd_ins_del_row_col_undo) : Correct target range.

2000-11-01  Michael Meeks  <michael@helixcode.com>

	* src/command-context-corba.[ch]: privatize the command context.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/cmd-edit.c (cmd_paste) : change the selection when pasting.
	(cmd_shift_{rows,cols}) : Do not change the selection when pasting.

	* src/commands.c (cmd_paste_cut_{undo,redo}) : Only select the target
	  if requested.
	(cmd_paste_cut) : new argument.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/value.c (value_new_from_string) : Reset errno on over/underflow.
	* src/number-match.c (format_match_simple) : Ditto.

	* src/parser.y (yylex) : reset errno in the event of over/underflow.
	  test for 'e' as an indicator of flaoting point numbers.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/application.c (application_init) : Register a shrunken version
	  of the print preview.

	* src/workbook-control-gui.c (workbook_menu_file) : Use the new
	  shrunken print preview icon.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-control-gui.c (cb_cancel_input) : renamed from
	  cancel_input, and return focus to the sheet.
	(cb_accept_input) : renamed from accept_input, and return focus
	  to the sheet.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_popup_menu) : Use the MENU versions of
	  the stock pixmaps.

2000-10-31  Morten Welinder  <terra@diku.dk>

	* src/analysis-tools.c (get_data_groupped_by_columns): Properly
 	offset col.  Constify.
	(get_data_groupped_by_rows): Properly offset row.  Constify.

2000-10-31  Jon K Hellan  <hellan@acm.org>

	* src/io-context.c (gnumeric_io_error_system): Added it.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-view.c (wb_view_auto_expr) : Set LC_MONETARY and
	  LC_NUMERIC.
	* src/xml-io.c (xml_workbook_write) : Ditto.
	(xml_workbook_read) : Ditto.

2000-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/*.[ch] : WorkbookControlGUI is now required for gui
	  operations.  A WorkbookView is required to know which sheet is the
	  current.

	* src/xml-io.c : We now load/save WorkbookViews.

	* src/xml-io-autoft.c : Adjust to signature changes.

	* src/workbook.c : Split the View into WorkbookView.
	  Abstract the Controler interface, and move the GUI specific
	  implementation of the Controler into WorkbookControlGUI.

	* src/workbook-view.c : Complete rewrite with correct semantics.

	* src/workbook-private.h : Move all the GUI specific stuff into
	  WorkbookControlGUI were it belongs.

	* src/workbook-private.c (workbook_private_class_init) : Fix typo.

	* src/workbook-edit.c : These are now WorkbookControlGUI specific.
	  We should rename the functions eventually.
	* src/workbook-format-toolbar.c : Ditto.
	* src/workbook-object-toolbar.c : Ditto.

	* src/workbook-cmd-format.c : Adjust to signature changes.
	  and use WorkbookControlGUI were necessary.

	* src/style.c (style_font_new_from) : Delete dead code.

	* src/solver-lp.c : Adjust to signature changes.
	* src/sort.c : Ditto.
	* src/stf.c : Ditto. Make dialog conditional on gui-ness.

	* src/sheet.c (sheet_new_sheet_view) : IS_SHEET checks for NULL.
	(sheet_detach_sheet_view) : renamed from sheet_destroy_sheet_view
	  and only take a SheetView as argument.
	(sheet_new) : Do not create a view by default.
	(sheet_update_zoom_controls) : foreach control.
	(sheet_update_editpos) : ditto.
	(sheet_update) : handle multiple views and controls.

	* src/sheet-view.c : Commands take WorkbookControls rather than
	  CommandContexts.

	* src/sheet-object-widget.c : Most things take WorkbookControlGUI
	  rather than Workbooks.

	* src/sheet-object-container.c (sheet_object_container_new_view) :
	  Use the uic from the WorkbookControlGUI.

	* src/sheet-control.c : New file. Unused so far.
	  cp sheet-view.c sheet-control.c
	  s/SheetView/SheetControl/

	* src/print.c : Make the GUI dependency explicit.
	  At some point the setup dialog should be split out of here.

	* src/main.c (gnumeric_main) : Explicitly create a WorkbookControlGUI
	  only adding sheets if nothing was loaded.  Improve handing of exit
	  request while loading.

	* src/item-grid.c (item_grid_draw) : Filter the edit cell from here
	  because we know which control to use.
	(context_menu_hander) : Switch to WorkbookControlGUI.
	(item_grid_popup_menu) : Ditto.

	* src/item-edit.c : Everything takes a WorkbookControlGUI inplace of a
	  Workbook now.

	* src/item-cursor.c (item_cursor_target_region_ok) : dialog_run takes
	  a WorkbookControlGUI.
	(item_cursor_do_action) : All the commands take WorkbookControls.

	* src/item-bar.c (item_bar_event) : item_grid_popup_menu takes a
	  SheetView now.

	* src/history.c : Take WorkbookControlGUI.
	  Update all controls for each workbook.

	* src/gui-clipboard.c : Use 'unsigned char'

	* src/gnumeric.xml : More work to split commands from layout.

	* src/gnumeric-util.c (gnumeric_no_modify_array_notice) : Delete.
	(gnumeric_notice) : Take a WorkbookControlGUI.
	(gnumeric_wb_dialog_run) : Ditto.
	(gnumeric_dialog_run) : Ditto.
	(gnumeric_dialog_show) : Ditto.
	(gnumeric_set_transient) : Ditto.
	(gnumeric_glade_xml_new) : Ditto.
	(gnumeric_non_modal_dialog) : Ditto.
	(gnumeric_inject_widget_into_bonoboui) : Ditto.

	* src/gnumeric-sheet.c : SheetView now has a WorkbookControlGUI member
	  to keep track of which control it is associated with. Use it.

	* src/file.c : Adjust to lots of signature changes.
	  We now load/save WorkbookView rather than Workbook.
	  Add a placeholder struct IOContext so that we can consider doing
	  smarter import/export and dealing with warnings and missing things
	  smoothly.

	* src/eval.c (workbook_recalc_all) : After a recalc update all views.

	* src/commands.c (undo_redo_menu_labels) : foreach control.
	(command_undo) : ditto.
	(command_redo) : ditto.
	(command_push_undo) : change signature.  The workbookcontrol
	  now acts as the command context.

	* src/cmd-edit.c : Adjust to signature changes.

	* src/clipboard.c : split the gui specific X handlers out into a new
	  file.
	* src/gui-clipboard.c :  here.

	* src/cell-draw.c (cell_draw) : Do not test the sheet for whether or
	  not to we are editing.  That is at the control level.  Test it in
	  the rendering loop.

	* src/bonobo-io.c : FIXME. adjusted to signature changes.  Totatly
	  broken for now.  This needs a View rather than a Model and should be
	  associated with something.

	* src/application.c (application_workbook_list_add) : New function.
	(application_workbook_list_remove) : New function.
	(application_workbook_list) : New function.
	(application_clipboard_copy) : foreach control.
	(application_clipboard_cut) : foreach control.
	(application_clipboard_clear) : foreach control.
	(application_workbook_foreach) : renamed from workbook_foreach.
	(application_set_selected_sheet) : FIXME. Disabled for now.

	* src/about.c (cb_closed) : Associated the flag with the control
	  directly.
	(dialog_about) : dialogs are associated with gui-controls.

	* src/analysis-tools.c : change all dialog signatures to handle MVC
	  split of workbook.

2000-10-30  Jody Goldberg <jgoldberg@home.com>

	* src/Makefile.am : Add new command-context,  io-context,
	  workbook-view, workbook-control, workbook-control-gui files.
	  Remove old command-context-gui, command-context-corba, and disable
	  corba-* for now.

2000-10-29  Jody Goldberg <jgoldberg@home.com>

	* idl/gnumeric-graphs.idl : Remove studdly caps.  I wish people would
	  make up their minds.

	* idl/Gnumeric.idl : Remove Workbook::show.

2000-10-29  Jody Goldberg <jgoldberg@home.com>

	* BUGS : Update.
	* NEWS : Update.
	* TODO : Update.

2000-10-30  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-math.c (gnumeric_sumproduct): Plug leak.

2000-10-29  Almer S. Tigelaar  <almer1@dds.nl>

	* src/commands.h, src/commands.c:
	(cmd_autoformat_undo): New, undo for the autoformat.
	(cmd_autoformat_redo): New, redo for the autoformat.
	(cmd_autoformat_destroy): Part of undo/redo.
	(cmd_autoformat): Idem.

	* src/format-template.h: Correct outdated comment.

	* src/format-template.h, src/format-template.c:
	(format_template_member_clone): New, clone a templatemember.
	(format_template_clone): New, clone a format template.
	(cb_format_sheet_style): Insert extra checks.
	(cb_format_sheet_border): Idem.
	(format_template_apply_to_sheet_selection): Renamed.
	(format_template_apply_to_sheet_sheet_regions): Modification of the
	above function, now accept a separate list of regions.

	* src/dialogs/dialog-autoformat.c:
	(dialog_autoformat): Modify so it calls upon routines which record
	undo/redo information.

2000-10-28  Michael Meeks  <michael@helixcode.com>

	* configure.in (Configuration): add scary message about Gnome Basic.

2000-10-28  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (gnumeric_bonobo_{read|write}_workbook):
	Forgot to tell: Also replaced vfs storage, which no longer exists
	in Bonobo, with efs, which does. It doesn't seem to work, but
	that's a different matter.

2000-10-28  Almer S. Tigelaar  <almer1@dds.nl>

	* src/clipboard.c:
	(x_selection_to_cell_region): Correct 'char' into 'unsigned char' so the eror
	message will display the correct ASCII decimal.

	* src/stf.c:
	(stf_read_workbook): Idem.

2000-10-28  Jon K Hellan  <hellan@acm.org>

	* configure.in: Require Bonobo >= 0.26.

	* src/bonobo-io.c (write_stream_to_storage,
	gnumeric_bonobo_write_workbook): Switch from
	Bonobo_Storage_create_stream (which no longer exists) to
	Bonobo_Storage_open_stream
	(gnumeric_bonobo_obj_write, read_stream_from_storage,
	gnumeric_bonobo_write_workbook, gnumeric_bonobo_read_workbook):
	Use BONOBO_EX macro for clarity.

2000-10-26  Michael Meeks  <michael@helixcode.com>

	* configure.in: Depend on gb-0.0.14 (CVS)

2000-10-24  Michael Meeks  <michael@helixcode.com>

	* src/sheet-object-bonobo.c: Remove #ifdef ENABLE_BONOBO's
	(open_cb, sheet_object_bonobo_populate_menu): impl.
	(sheet_object_bonobo_class_init): hook in.
	(sheet_object_bonobo_load_from_file): upd.

	* src/sheet-object-container.c (sheet_object_container_new_file): upd.

2000-10-24  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml: Start to separate out cmds / widgets, a very
	long and tedious job, s/Menu_Open/Open/ etc.

2000-10-22  Jon K Hellan  <hellan@acm.org>

	* src/workbook-format-toolbar.c (workbook_format_toolbar []): Now
	also for non bonobo case: Add button to replace font and size
	selectors in vertical mode.
	(workbook_format_toolbar_orient): Show/hide font button mentioned
	above.
	(workbook_create_format_toolbar): Hide font button.

	* src/workbook-format-toolbar.h: Update all toolbar item indexes.

2000-10-21  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (selection_to_list) : delete.
	(selection_get_ranges) : implement  allow_intersection.
	(selection_apply) : change the signature of the callback.

2000-10-21  Michael Meeks  <michael@helixcode.com>

	* src/sheet-object-container.c: include bonobo-object-directory.h

	* configure.in: depend on gb >= 0.0.13 and libole >= 0.1.7

	* README: update to reflect this.

2000-10-21  Jon K Hellan  <hellan@acm.org>

	* src/gnumeric.xml: Add tips for toolbar undo and redo.  Correct
	tip for menu PrintPreview.  Add tip to toolbar zoom.  Don't
	display it when vertical.  Add tips to toolbar font name and font
	size controls. Replace them with a button in vertical mode. (2
	controls -> 1 button.)  It invokes the font page of the format
	dialog. Add tips to toolbar border, background and foreground
	selectors.

	* src/workbook-format-toolbar.c (font_select_cmd): New
	command. Pop up cell format dialog at font page.
	(workbook_feedback_set): Remove warning by not defining toolbar
	variable for bonobo.
	(workbook_format_toolbar_orient): Remove warning by undefining
	this for bonobo.

	* src/workbook.c (format_cells_cmd): Call dialog_cell_format
	with new parameter pageno = FD_CURRENT.

	* src/item-grid.c (context_menu_hander): Ditto

2000-10-21  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml.h: commit to CVS.

2000-10-20  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (do_render_number) : Brown paper bag.  Bug 29068.
	  I HATE global variables.
	(fmt_general_float) : Rewrite to rationalize and catch some corner
	  cases.

2000-10-19  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml: don't display the zoom control when vertical.

2000-10-19  Michael Meeks  <michael@helixcode.com>

	* configure.in (gnumeric_executable): check for (CVS) Bonobo 0.24

	* src/file.c (do_load_from): split from (workbook_load_from): upd.
	(workbook_try_read): use do_load_from to kill (empty) message box.

	* src/bonobo-io.c (gnumeric_bonobo_io_probe): remove annoying warning.

	* src/sheet-object-container.c (sheet_object_container_new_file):
	move this ugly code into bonobo and clean; make D&D components work again.

	* src/bonobo-io.c (gnumeric_bonobo_write_workbook): update for HEAD
	Bonobo.
	(gnumeric_bonobo_read_workbook): ditto.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_load_from_file): upd.

2000-10-18  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (format_value) : Only format doubles as ints if they
	  fit in an integer.
	(fmt_general_int) : improve handling of log (0).
	(fmt_general_float) : ditto.  Increase (temporarily) the width of a
	  decimal point.

2000-10-18  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (fmt_general_float) : clamp the precision at DBL_PREC.

	* src/rendered-value.c (rendered_value_new_ext) : Don't forget the
	  intercharacter spacing when approximating the width of a character.

	* src/str.c (string_get_nocopy) : new function.

	* src/cell.c (cell_set_value) : Use it.

2000-10-16  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_new_ext) : fix some leaks.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_paste_region) : no need to clear the
	  formats.  We are going to be pasting over them later.  This means
	  that we don't rerender everything in the region then replace it.

	* src/rendered-value.c (rendered_value_new_ext) : Pass colwidth as a
	  float to get beter resolution.
	* src/format.c (format_value) : Ditto.

	* src/format.c (fmt_general_float) : More tuning.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_update) : RE_RENDER when a span calc is forced.
	  This is a bit brute force for now, but is necessary to force the
	  re-rendering of values that may have width dependent formats.
	  I've noted a possible future enhancement that would remove this req
	  at the cost of some complexity.

	* src/format.c (fmt_general_float) : new function.
	(fmt_general_int) : new function.
	(format_value) : Use the new routines.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_set_value) : Re-render the entered text to handle
	  width dependent formats.

2000-10-14  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_overflow) : improve drawing of hash marks.
	* src/cell-draw.c (draw_overflow) : to always draw at least one hash.

	* src/rendered-value.c (rendered_value_new_ext) : pass in approx
	  column width in characters for use by general.

2000-10-14  Chema Celorio  <chema@celorio.com>

	* src/workbook.c (workbook_sheet_get_free_name): remove g_assert not
	reached, as it was reached when duplicating sheets with names like :
	"Sales (1995)". If we have a sheet with a number in parenthesis and
	the number is > 1000. Duplicate it with the name "Name (numer) (2)".

2000-10-13  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_new) : Handle the unrefing of
	  the local style here.
	(rendered_value_new_ext) : rather than here.
	(rendered_value_calc_size) : handke the unrefing of the local style
	  here.
	(rendered_value_calc_size_ext) : rather than here.

	* src/preview-grid-controller.c (cb_grid_get_cell) : Adjust the
	  semantics of the rendered_value_*_ext methods so that they don't
	  unref the styles.

2000-10-13  Jody Goldberg <jgoldberg@home.com>

	* src/position.c (parse_pos_init) : Relax the restrictions.

	* src/workbook.c : Improve wording of Names->Define.

	* src/gnumeric.xml : fix typo with Insert->Names->Define

2000-10-12  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_destroy) : Move the destruction of
	  the tip here.
	(item_cursor_drag_event) : from here.  do not destroy the cursor.
	(item_cursor_do_action) : destroy the cursor here.
	(item_cursor_do_drop) : and sometimes here.

2000-10-12  Jon K Hellan  <hellan@acm.org>

	* configure.in: Require bonobo >= 0.21. We now use
	bonobo_ui_util_encode_str - added since 0.20.

	* src/gnumeric.xml: Bonobo no longer supports placeholder
	delimit="both". Use "top" and a separator instead. Indicate
	separators by <separator/> instead <menuitem/>. Change last
	remaining descr to _tip.

	* src/history.c (history_menu_insert_items): Bonobo changed
	again. We fix.
	(file_history_cmd): Use "tip" instead of "descr"

2000-10-12  Jody Goldberg <jgoldberg@home.com>

	* src/main.c (gnumeric_main) : manually init the corba factories after
	  the support subsystems are initialized, but before the workbooks are
	  created.  This needs some serious cleaning.

	* src/embeddable-grid.c (EmbeddableGridFactory_init) : return a flag
	  for later use.
	(grid_view_activate) : focus on the widget not the containing object.

	* src/corba-args.c (gnumeric_arg_parse) : Do not init the corba
	  factories yet.  they were getting called before the application was
	  ready.

2000-10-11  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-util.c (gnumeric_create_popup_menu) : Generalized and
	  moved from item-grid.c

2000-10-11  Jon K Hellan  <hellan@acm.org>

	* src/history.c (file_history_cmd): Removed yet another vestige of
	the old Bonobo UI Handler code: Changed `BonoboUIHandler *uih' to
	`BonoboUIComponent *uic.

2000-10-11  Martin Baulig  <baulig@suse.de>

	Removed the last bits of the old Bonobo UI Handler code.

	* src/workbook-private.h (WorkbookPrivate): Changed `BonoboUIHandler *uih'
	to `BonoboUIComponent *uic'.
	* src/workbook.c (workbook_new): Create the BonoboUIComponent here.

2000-10-10  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-util.c (run_popup_menu) : Delete.
	(popup_menu_item_activated) : Delete.
	(gtk_radio_button_select) : Delete.

	* src/item-cursor.c (item_cursor_do_drop) : Use item_grid_popup_menu.

	* src/sheet-object.c (display_object_menu) : Rename from create_popup_menu
	  and display the menu.
	(control_point_handle_event) : simplify with display_object_menu.
	(sheet_object_canvas_event) : simplify with display_object_menu.

	* src/gnumeric-util.c (gnumeric_popup_menu) : Do not pass the button
	  number from the event that is poping up the menu.  That disables the
	  ability to select a menu item via a different button.

2000-10-10  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-private.c (workbook_private_init) : Init the
	  updating_toolbar flag.

	* src/workbook-format-toolbar.c (set_selection_halign) : Use the
	  updating toolbar flag so that the bonobo version (which does not
	  disable the callbacks) works correctly.
	(change_selection_font) : Ditto.
	(workbook_format_toolbutton_update) : Remove the hackish static and use a real flag.

	* src/gnumeric.xml : Update for the new bonobo.

	* configure.in (AM_INIT_AUTOMAKE) : follow new protocol and bump
	  version immediately after release rather than before.
