2000-10-30  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-math.c (gnumeric_sumproduct): Plug leak.

2000-10-29  Almer S. Tigelaar  <almer1@dds.nl>

	* src/commands.h, src/commands.c:
	(cmd_autoformat_undo): New, undo for the autoformat.
	(cmd_autoformat_redo): New, redo for the autoformat.
	(cmd_autoformat_destroy): Part of undo/redo.
	(cmd_autoformat): Idem.
	
	* src/format-template.h: Correct outdated comment.
	
	* src/format-template.h, src/format-template.c:
	(format_template_member_clone): New, clone a templatemember.
	(format_template_clone): New, clone a format template.
	(cb_format_sheet_style): Insert extra checks.
	(cb_format_sheet_border): Idem.
	(format_template_apply_to_sheet_selection): Renamed.
	(format_template_apply_to_sheet_sheet_regions): Modification of the
	above function, now accept a separate list of regions.

	* src/dialogs/dialog-autoformat.c:
	(dialog_autoformat): Modify so it calls upon routines which record
	undo/redo information.

2000-10-28  Michael Meeks  <michael@helixcode.com>

	* configure.in (Configuration): add scary message about Gnome Basic.

2000-10-28  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (gnumeric_bonobo_{read|write}_workbook): 
	Forgot to tell: Also replaced vfs storage, which no longer exists
	in Bonobo, with efs, which does. It doesn't seem to work, but
	that's a different matter.

2000-10-28  Almer S. Tigelaar  <almer1@dds.nl>

	* src/clipboard.c:
	(x_selection_to_cell_region): Correct 'char' into 'unsigned char' so the eror
	message will display the correct ASCII decimal.

	* src/stf.c:
	(stf_read_workbook): Idem.

2000-10-28  Jon K Hellan  <hellan@acm.org>

	* configure.in: Require Bonobo >= 0.26.

	* src/bonobo-io.c (write_stream_to_storage,
	gnumeric_bonobo_write_workbook): Switch from
	Bonobo_Storage_create_stream (which no longer exists) to
	Bonobo_Storage_open_stream
	(gnumeric_bonobo_obj_write, read_stream_from_storage,
	gnumeric_bonobo_write_workbook, gnumeric_bonobo_read_workbook):
	Use BONOBO_EX macro for clarity.

2000-10-26  Michael Meeks  <michael@helixcode.com>

	* configure.in: Depend on gb-0.0.14 (CVS)

2000-10-24  Michael Meeks  <michael@helixcode.com>

	* src/sheet-object-bonobo.c: Remove #ifdef ENABLE_BONOBO's
	(open_cb, sheet_object_bonobo_populate_menu): impl.
	(sheet_object_bonobo_class_init): hook in.
	(sheet_object_bonobo_load_from_file): upd.

	* src/sheet-object-container.c (sheet_object_container_new_file): upd.

2000-10-24  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml: Start to separate out cmds / widgets, a very
	long and tedious job, s/Menu_Open/Open/ etc.

2000-10-22  Jon K Hellan  <hellan@acm.org>

	* src/workbook-format-toolbar.c (workbook_format_toolbar []): Now
	also for non bonobo case: Add button to replace font and size
	selectors in vertical mode.
	(workbook_format_toolbar_orient): Show/hide font button mentioned
	above.
	(workbook_create_format_toolbar): Hide font button.

	* src/workbook-format-toolbar.h: Update all toolbar item indexes.

2000-10-21  Michael Meeks  <michael@helixcode.com>

	* src/sheet-object-container.c: include bonobo-object-directory.h

	* configure.in: depend on gb >= 0.0.13 and libole >= 0.1.7

	* README: update to reflect this.

2000-10-21  Jon K Hellan  <hellan@acm.org>

	* src/gnumeric.xml: Add tips for toolbar undo and redo.  Correct
	tip for menu PrintPreview.  Add tip to toolbar zoom.  Don't
	display it when vertical.  Add tips to toolbar font name and font
	size controls. Replace them with a button in vertical mode. (2
	controls -> 1 button.)  It invokes the font page of the format
	dialog. Add tips to toolbar border, background and foreground
	selectors.

	* src/workbook-format-toolbar.c (font_select_cmd): New
	command. Pop up cell format dialog at font page.
	(workbook_feedback_set): Remove warning by not defining toolbar
	variable for bonobo.
	(workbook_format_toolbar_orient): Remove warning by undefining
	this for bonobo.

	* src/workbook.c (format_cells_cmd): Call dialog_cell_format
	with new parameter pageno = FD_CURRENT.

	* src/item-grid.c (context_menu_hander): Ditto

2000-10-21  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml.h: commit to CVS.

2000-10-20  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (do_render_number) : Brown paper bag.  Bug 29068.
	  I HATE global variables.
	(fmt_general_float) : Rewrite to rationalize and catch some corner
	  cases.

2000-10-19  Michael Meeks  <michael@helixcode.com>

	* src/gnumeric.xml: don't display the zoom control when vertical.

2000-10-19  Michael Meeks  <michael@helixcode.com>

	* configure.in (gnumeric_executable): check for (CVS) Bonobo 0.24

	* src/file.c (do_load_from): split from (workbook_load_from): upd.
	(workbook_try_read): use do_load_from to kill (empty) message box.

	* src/bonobo-io.c (gnumeric_bonobo_io_probe): remove annoying warning.

	* src/sheet-object-container.c (sheet_object_container_new_file):
	move this ugly code into bonobo and clean; make D&D components work again.

	* src/bonobo-io.c (gnumeric_bonobo_write_workbook): update for HEAD
	Bonobo.
	(gnumeric_bonobo_read_workbook): ditto.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_load_from_file): upd.

2000-10-18  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (format_value) : Only format doubles as ints if they
	  fit in an integer.
	(fmt_general_int) : improve handling of log (0).
	(fmt_general_float) : ditto.  Increase (temporarily) the width of a
	  decimal point.

2000-10-18  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (fmt_general_float) : clamp the precision at DBL_PREC.

	* src/rendered-value.c (rendered_value_new_ext) : Don't forget the
	  intercharacter spacing when approximating the width of a character.

	* src/str.c (string_get_nocopy) : new function.

	* src/cell.c (cell_set_value) : Use it.

2000-10-16  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_new_ext) : fix some leaks.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_paste_region) : no need to clear the
	  formats.  We are going to be pasting over them later.  This means
	  that we don't rerender everything in the region then replace it.

	* src/rendered-value.c (rendered_value_new_ext) : Pass colwidth as a
	  float to get beter resolution.
	* src/format.c (format_value) : Ditto.

	* src/format.c (fmt_general_float) : More tuning.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_update) : RE_RENDER when a span calc is forced.
	  This is a bit brute force for now, but is necessary to force the
	  re-rendering of values that may have width dependent formats.
	  I've noted a possible future enhancement that would remove this req
	  at the cost of some complexity.

	* src/format.c (fmt_general_float) : new function.
	(fmt_general_int) : new function.
	(format_value) : Use the new routines.

2000-10-15  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_set_value) : Re-render the entered text to handle
	  width dependent formats.

2000-10-14  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_overflow) : improve drawing of hash marks.
	* src/cell-draw.c (draw_overflow) : to always draw at least one hash.

	* src/rendered-value.c (rendered_value_new_ext) : pass in approx
	  column width in characters for use by general.

2000-10-14  Chema Celorio  <chema@celorio.com>

	* src/workbook.c (workbook_sheet_get_free_name): remove g_assert not
	reached, as it was reached when duplicating sheets with names like :
	"Sales (1995)". If we have a sheet with a number in parenthesis and
	the number is > 1000. Duplicate it with the name "Name (numer) (2)".

2000-10-13  Jody Goldberg <jgoldberg@home.com>

	* src/rendered-value.c (rendered_value_new) : Handle the unrefing of
	  the local style here.
	(rendered_value_new_ext) : rather than here.
	(rendered_value_calc_size) : handke the unrefing of the local style
	  here.
	(rendered_value_calc_size_ext) : rather than here.

	* src/preview-grid-controller.c (cb_grid_get_cell) : Adjust the
	  semantics of the rendered_value_*_ext methods so that they don't
	  unref the styles.

2000-10-13  Jody Goldberg <jgoldberg@home.com>

	* src/position.c (parse_pos_init) : Relax the restrictions.

	* src/workbook.c : Improve wording of Names->Define.

	* src/gnumeric.xml : fix typo with Insert->Names->Define

2000-10-12  Jody Goldberg <jgoldberg@home.com>

	* src/item-cursor.c (item_cursor_destroy) : Move the destruction of
	  the tip here.
	(item_cursor_drag_event) : from here.  do not destroy the cursor.
	(item_cursor_do_action) : destroy the cursor here.
	(item_cursor_do_drop) : and sometimes here.

2000-10-12  Jon K Hellan  <hellan@acm.org>

	* configure.in: Require bonobo >= 0.21. We now use
	bonobo_ui_util_encode_str - added since 0.20.

	* src/gnumeric.xml: Bonobo no longer supports placeholder
	delimit="both". Use "top" and a separator instead. Indicate
	separators by <separator/> instead <menuitem/>. Change last
	remaining descr to _tip.

	* src/history.c (history_menu_insert_items): Bonobo changed
	again. We fix.
	(file_history_cmd): Use "tip" instead of "descr"

2000-10-12  Jody Goldberg <jgoldberg@home.com>

	* src/main.c (gnumeric_main) : manually init the corba factories after
	  the support subsystems are initialized, but before the workbooks are
	  created.  This needs some serious cleaning.

	* src/embeddable-grid.c (EmbeddableGridFactory_init) : return a flag
	  for later use.
	(grid_view_activate) : focus on the widget not the containing object.

	* src/corba-args.c (gnumeric_arg_parse) : Do not init the corba
	  factories yet.  they were getting called before the application was
	  ready.

2000-10-11  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-util.c (gnumeric_create_popup_menu) : Generalized and
	  moved from item-grid.c

2000-10-11  Jon K Hellan  <hellan@acm.org>

	* src/history.c (file_history_cmd): Removed yet another vestige of
	the old Bonobo UI Handler code: Changed `BonoboUIHandler *uih' to
	`BonoboUIComponent *uic.

2000-10-11  Martin Baulig  <baulig@suse.de>

	Removed the last bits of the old Bonobo UI Handler code.

	* src/workbook-private.h (WorkbookPrivate): Changed `BonoboUIHandler *uih'
	to `BonoboUIComponent *uic'.
	* src/workbook.c (workbook_new): Create the BonoboUIComponent here.

2000-10-10  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-util.c (run_popup_menu) : Delete.
	(popup_menu_item_activated) : Delete.
	(gtk_radio_button_select) : Delete.

	* src/item-cursor.c (item_cursor_do_drop) : Use item_grid_popup_menu.

	* src/sheet-object.c (display_object_menu) : Rename from create_popup_menu
	  and display the menu.
	(control_point_handle_event) : simplify with display_object_menu.
	(sheet_object_canvas_event) : simplify with display_object_menu.

	* src/gnumeric-util.c (gnumeric_popup_menu) : Do not pass the button
	  number from the event that is poping up the menu.  That disables the
	  ability to select a menu item via a different button.

2000-10-10  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-private.c (workbook_private_init) : Init the
	  updating_toolbar flag.

	* src/workbook-format-toolbar.c (set_selection_halign) : Use the
	  updating toolbar flag so that the bonobo version (which does not
	  disable the callbacks) works correctly.
	(change_selection_font) : Ditto.
	(workbook_format_toolbutton_update) : Remove the hackish static and use a real flag.

	* src/gnumeric.xml : Update for the new bonobo.

	* configure.in (AM_INIT_AUTOMAKE) : follow new protocol and bump
	  version immediately after release rather than before.
